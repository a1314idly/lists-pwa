{"id":"LRxU","dependencies":[{"name":"/Users/chloechen/Desktop/lists-pwa/package.json","includedInParent":true,"mtime":1614062779998},{"name":"/Users/chloechen/Desktop/lists-pwa/node_modules/@firebase/firestore/package.json","includedInParent":true,"mtime":1614053660203},{"name":"@firebase/logger","loc":{"line":1,"column":43},"parent":"/Users/chloechen/Desktop/lists-pwa/node_modules/@firebase/firestore/dist/esm5/prebuilt-67479dbf-318e5a2c.js","resolved":"/Users/chloechen/Desktop/lists-pwa/node_modules/@firebase/logger/dist/index.esm.js"},{"name":"@firebase/util","loc":{"line":3,"column":134},"parent":"/Users/chloechen/Desktop/lists-pwa/node_modules/@firebase/firestore/dist/esm5/prebuilt-67479dbf-318e5a2c.js","resolved":"/Users/chloechen/Desktop/lists-pwa/node_modules/@firebase/util/dist/index.esm.js"},{"name":"@firebase/webchannel-wrapper","loc":{"line":5,"column":156},"parent":"/Users/chloechen/Desktop/lists-pwa/node_modules/@firebase/firestore/dist/esm5/prebuilt-67479dbf-318e5a2c.js","resolved":"/Users/chloechen/Desktop/lists-pwa/node_modules/@firebase/webchannel-wrapper/dist/index.esm.js"},{"name":"tslib","loc":{"line":7,"column":86},"parent":"/Users/chloechen/Desktop/lists-pwa/node_modules/@firebase/firestore/dist/esm5/prebuilt-67479dbf-318e5a2c.js","resolved":"/Users/chloechen/Desktop/lists-pwa/node_modules/tslib/tslib.es6.js"},{"name":"process","parent":"/Users/chloechen/Desktop/lists-pwa/node_modules/@firebase/firestore/dist/esm5/prebuilt-67479dbf-318e5a2c.js","resolved":"/Users/chloechen/Desktop/lists-pwa/node_modules/process/browser.js"}],"generated":{"js":"var process = require(\"process\");\nvar t=require(\"process\");Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.W=lc,exports.b=Dc,exports.u=kc,exports.t=exports.s=exports.o=exports.j=exports.i=exports.e=exports.c=exports.a=exports.Z=exports.Y=exports.X=exports.U=exports.Q=exports.L=exports.K=exports.H=exports.G=void 0;var e=require(\"@firebase/logger\"),n=require(\"@firebase/util\"),r=require(\"@firebase/webchannel-wrapper\"),i=require(\"tslib\");function o(t){return(o=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&\"function\"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?\"symbol\":typeof t})(t)}var u=function(t,e,n,r,i,o){this.t=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i,this.i=o},s=function(){function t(t,e){this.projectId=t,this.database=e||\"(default)\"}return Object.defineProperty(t.prototype,\"o\",{get:function(){return\"(default)\"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t}(),a=new e.Logger(\"@firebase/firestore\");function c(){return a.logLevel}function h(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];if(a.logLevel<=e.LogLevel.DEBUG){var o=n.map(p);a.debug.apply(a,(0,i.__spreadArrays)([\"Firestore (8.2.9): \"+t],o))}}function f(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];if(a.logLevel<=e.LogLevel.ERROR){var o=n.map(p);a.error.apply(a,(0,i.__spreadArrays)([\"Firestore (8.2.9): \"+t],o))}}function l(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];if(a.logLevel<=e.LogLevel.WARN){var o=n.map(p);a.warn.apply(a,(0,i.__spreadArrays)([\"Firestore (8.2.9): \"+t],o))}}function p(t){if(\"string\"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function d(t){void 0===t&&(t=\"Unexpected state\");var e=\"FIRESTORE (8.2.9) INTERNAL ASSERTION FAILED: \"+t;throw f(e),new Error(e)}function v(t,e){t||d()}function y(t,e){return t}function g(t){var e=\"undefined\"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&\"function\"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var m=function(){function t(){}return t.u=function(){for(var t=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\",e=Math.floor(256/t.length)*t.length,n=\"\";n.length<20;)for(var r=g(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function _(t,e){return t<e?-1:t>e?1:0}function w(t,e,n){return t.length===e.length&&t.every(function(t,r){return n(t,e[r])})}function b(t){return t+\"\\0\"}var I=function(){function t(t){this.h=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e=\"\",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return t=this.h,btoa(t);var t},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.h)},t.prototype.l=function(){return 2*this.h.length},t.prototype._=function(t){return _(this.h,t.h)},t.prototype.isEqual=function(t){return this.h===t.h},t}();I.T=new I(\"\");var E={OK:\"ok\",CANCELLED:\"cancelled\",UNKNOWN:\"unknown\",INVALID_ARGUMENT:\"invalid-argument\",DEADLINE_EXCEEDED:\"deadline-exceeded\",NOT_FOUND:\"not-found\",ALREADY_EXISTS:\"already-exists\",PERMISSION_DENIED:\"permission-denied\",UNAUTHENTICATED:\"unauthenticated\",RESOURCE_EXHAUSTED:\"resource-exhausted\",FAILED_PRECONDITION:\"failed-precondition\",ABORTED:\"aborted\",OUT_OF_RANGE:\"out-of-range\",UNIMPLEMENTED:\"unimplemented\",INTERNAL:\"internal\",UNAVAILABLE:\"unavailable\",DATA_LOSS:\"data-loss\"},T=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name=\"FirebaseError\",r.toString=function(){return r.name+\": [code=\"+r.code+\"]: \"+r.message},r}return(0,i.__extends)(e,t),e}(Error),x=function(){function t(t){this.I=t}return t.fromBase64String=function(e){try{return new t(I.fromBase64String(e))}catch(e){throw new T(E.INVALID_ARGUMENT,\"Failed to construct data from Base64 string: \"+e)}},t.fromUint8Array=function(e){return new t(I.fromUint8Array(e))},t.prototype.toBase64=function(){return this.I.toBase64()},t.prototype.toUint8Array=function(){return this.I.toUint8Array()},t.prototype.toString=function(){return\"Bytes(base64: \"+this.toBase64()+\")\"},t.prototype.isEqual=function(t){return this.I.isEqual(t.I)},t}(),N=function(){function t(t){this.uid=t}return t.prototype.m=function(){return null!=this.uid},t.prototype.A=function(){return this.m()?\"uid:\"+this.uid:\"anonymous-user\"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();N.UNAUTHENTICATED=new N(null),N.R=new N(\"google-credentials-uid\"),N.P=new N(\"first-party-uid\");var A=function(t,e){this.user=e,this.type=\"OAuth\",this.g={},this.g.Authorization=\"Bearer \"+t},S=function(){function t(){this.V=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.p=function(){},t.prototype.v=function(t){this.V=t,t(N.UNAUTHENTICATED)},t.prototype.S=function(){this.V=null},t}(),D=function(){function t(t){var e=this;this.D=null,this.currentUser=N.UNAUTHENTICATED,this.C=!1,this.N=0,this.V=null,this.forceRefresh=!1,this.D=function(){e.N++,e.currentUser=e.$(),e.C=!0,e.V&&e.V(e.currentUser)},this.N=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.D):(this.D(null),t.get().then(function(t){e.auth=t,e.D&&e.auth.addAuthTokenListener(e.D)},function(){}))}return t.prototype.getToken=function(){var t=this,e=this.N,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(function(n){return t.N!==e?(h(\"FirebaseCredentialsProvider\",\"getToken aborted due to token change.\"),t.getToken()):n?(v(\"string\"==typeof n.accessToken),new A(n.accessToken,t.currentUser)):null}):Promise.resolve(null)},t.prototype.p=function(){this.forceRefresh=!0},t.prototype.v=function(t){this.V=t,this.C&&t(this.currentUser)},t.prototype.S=function(){this.auth&&this.auth.removeAuthTokenListener(this.D),this.D=null,this.V=null},t.prototype.$=function(){var t=this.auth&&this.auth.getUid();return v(null===t||\"string\"==typeof t),new N(t)},t}(),k=function(){function t(t,e){this.F=t,this.O=e,this.type=\"FirstParty\",this.user=N.P}return Object.defineProperty(t.prototype,\"g\",{get:function(){var t={\"X-Goog-AuthUser\":this.O},e=this.F.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!1,configurable:!0}),t}(),O=function(){function t(t,e){this.F=t,this.O=e}return t.prototype.getToken=function(){return Promise.resolve(new k(this.F,this.O))},t.prototype.v=function(t){t(N.P)},t.prototype.S=function(){},t.prototype.p=function(){},t}(),P=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.k=function(t){return n.M(t)},this.L=function(t){return e.B(t)})}return t.prototype.M=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.L&&this.L(t),t},t}();P.q=-1;var V=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new T(E.INVALID_ARGUMENT,\"Timestamp nanoseconds out of range: \"+e);if(e>=1e9)throw new T(E.INVALID_ARGUMENT,\"Timestamp nanoseconds out of range: \"+e);if(t<-62135596800)throw new T(E.INVALID_ARGUMENT,\"Timestamp seconds out of range: \"+t);if(t>=253402300800)throw new T(E.INVALID_ARGUMENT,\"Timestamp seconds out of range: \"+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,1e6*(e-1e3*n))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype.U=function(t){return this.seconds===t.seconds?_(this.nanoseconds,t.nanoseconds):_(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return\"Timestamp(seconds=\"+this.seconds+\", nanoseconds=\"+this.nanoseconds+\")\"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,\"0\")+\".\"+String(this.nanoseconds).padStart(9,\"0\")},t}(),L=function(){function t(t){this.timestamp=t}return t.K=function(e){return new t(e)},t.min=function(){return new t(new V(0,0))},t.prototype._=function(t){return this.timestamp.U(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.W=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return\"SnapshotVersion(\"+this.timestamp.toString()+\")\"},t.prototype.j=function(){return this.timestamp},t}(),C=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&d(),void 0===n?n=t.length-e:n>t.length-e&&d(),this.segments=t,this.offset=e,this.G=n}return Object.defineProperty(t.prototype,\"length\",{get:function(){return this.G},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.H(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach(function(t){n.push(t)}):n.push(e),this.J(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.Y=function(t){return t=void 0===t?1:t,this.J(this.segments,this.offset+t,this.length-t)},t.prototype.X=function(){return this.J(this.segments,this.offset,this.length-1)},t.prototype.Z=function(){return this.segments[this.offset]},t.prototype.tt=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.et=function(){return 0===this.length},t.prototype.nt=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.st=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.it=function(){return this.segments.slice(this.offset,this.limit())},t.H=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),R=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),e.prototype.J=function(t,n,r){return new e(t,n,r)},e.prototype.rt=function(){return this.it().join(\"/\")},e.prototype.toString=function(){return this.rt()},e.ot=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=[],i=0,o=t;i<o.length;i++){var u=o[i];if(u.indexOf(\"//\")>=0)throw new T(E.INVALID_ARGUMENT,\"Invalid segment (\"+u+\"). Paths must not contain // in them.\");r.push.apply(r,u.split(\"/\").filter(function(t){return t.length>0}))}return new e(r)},e.ct=function(){return new e([])},e}(C),U=/^[_a-zA-Z][_a-zA-Z0-9]*$/,M=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),e.prototype.J=function(t,n,r){return new e(t,n,r)},e.at=function(t){return U.test(t)},e.prototype.rt=function(){return this.it().map(function(t){return t=t.replace(/\\\\/g,\"\\\\\\\\\").replace(/`/g,\"\\\\`\"),e.at(t)||(t=\"`\"+t+\"`\"),t}).join(\".\")},e.prototype.toString=function(){return this.rt()},e.prototype.ut=function(){return 1===this.length&&\"__name__\"===this.get(0)},e.ht=function(){return new e([\"__name__\"])},e.lt=function(t){for(var n=[],r=\"\",i=0,o=function(){if(0===r.length)throw new T(E.INVALID_ARGUMENT,\"Invalid field path (\"+t+\"). Paths must not be empty, begin with '.', end with '.', or contain '..'\");n.push(r),r=\"\"},u=!1;i<t.length;){var s=t[i];if(\"\\\\\"===s){if(i+1===t.length)throw new T(E.INVALID_ARGUMENT,\"Path has trailing escape character: \"+t);var a=t[i+1];if(\"\\\\\"!==a&&\".\"!==a&&\"`\"!==a)throw new T(E.INVALID_ARGUMENT,\"Path has invalid escape sequence: \"+t);r+=a,i+=2}else\"`\"===s?(u=!u,i++):\".\"!==s||u?(r+=s,i++):(o(),i++)}if(o(),u)throw new T(E.INVALID_ARGUMENT,\"Unterminated ` in path: \"+t);return new e(n)},e.ct=function(){return new e([])},e}(C),q=function(){function t(t){this.path=t}return t._t=function(e){return new t(R.ot(e))},t.ft=function(e){return new t(R.ot(e).Y(5))},t.prototype.dt=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===R.H(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.H=function(t,e){return R.H(t.path,e.path)},t.wt=function(t){return t.length%2==0},t.Et=function(e){return new t(new R(e.slice()))},t}();function F(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function j(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function z(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}exports.K=V;var G=function(){function t(t){this.fields=t,t.sort(M.H)}return t.prototype.Tt=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].nt(t))return!0;return!1},t.prototype.isEqual=function(t){return w(this.fields,t.fields,function(t,e){return t.isEqual(e)})},t}(),B=new RegExp(/^\\d{4}-\\d\\d-\\d\\dT\\d\\d:\\d\\d:\\d\\d(?:\\.(\\d+))?Z$/);function Q(t){if(v(!!t),\"string\"==typeof t){var e=0,n=B.exec(t);if(v(!!n),n[1]){var r=n[1];r=(r+\"000000000\").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:Y(t.seconds),nanos:Y(t.nanos)}}function Y(t){return\"number\"==typeof t?t:\"string\"==typeof t?Number(t):0}function H(t){return\"string\"==typeof t?I.fromBase64String(t):I.fromUint8Array(t)}function K(t){var e,n;return\"server_timestamp\"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function X(t){var e=t.mapValue.fields.__previous_value__;return K(e)?X(e):e}function W(t){var e=Q(t.mapValue.fields.__local_write_time__.timestampValue);return new V(e.seconds,e.nanos)}function Z(t){return null==t}function J(t){return 0===t&&1/t==-1/0}function $(t){return\"number\"==typeof t&&Number.isInteger(t)&&!J(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}function tt(t){return\"nullValue\"in t?0:\"booleanValue\"in t?1:\"integerValue\"in t||\"doubleValue\"in t?2:\"timestampValue\"in t?3:\"stringValue\"in t?5:\"bytesValue\"in t?6:\"referenceValue\"in t?7:\"geoPointValue\"in t?8:\"arrayValue\"in t?9:\"mapValue\"in t?K(t)?4:10:d()}function et(t,e){var n=tt(t);if(n!==tt(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return W(t).isEqual(W(e));case 3:return function(t,e){if(\"string\"==typeof t.timestampValue&&\"string\"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=Q(t.timestampValue),r=Q(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return H(t.bytesValue).isEqual(H(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Y(t.geoPointValue.latitude)===Y(e.geoPointValue.latitude)&&Y(t.geoPointValue.longitude)===Y(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if(\"integerValue\"in t&&\"integerValue\"in e)return Y(t.integerValue)===Y(e.integerValue);if(\"doubleValue\"in t&&\"doubleValue\"in e){var n=Y(t.doubleValue),r=Y(e.doubleValue);return n===r?J(n)===J(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return w(t.arrayValue.values||[],e.arrayValue.values||[],et);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(F(n)!==F(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!et(n[i],r[i])))return!1;return!0}(t,e);default:return d()}}function nt(t,e){return void 0!==(t.values||[]).find(function(t){return et(t,e)})}function rt(t,e){var n=tt(t),r=tt(e);if(n!==r)return _(n,r);switch(n){case 0:return 0;case 1:return _(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=Y(t.integerValue||t.doubleValue),r=Y(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return it(t.timestampValue,e.timestampValue);case 4:return it(W(t),W(e));case 5:return _(t.stringValue,e.stringValue);case 6:return function(t,e){var n=H(t),r=H(e);return n._(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split(\"/\"),r=e.split(\"/\"),i=0;i<n.length&&i<r.length;i++){var o=_(n[i],r[i]);if(0!==o)return o}return _(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=_(Y(t.latitude),Y(e.latitude));return 0!==n?n:_(Y(t.longitude),Y(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=rt(n[i],r[i]);if(o)return o}return _(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var u=0;u<r.length&&u<o.length;++u){var s=_(r[u],o[u]);if(0!==s)return s;var a=rt(n[r[u]],i[o[u]]);if(0!==a)return a}return _(r.length,o.length)}(t.mapValue,e.mapValue);default:throw d()}}function it(t,e){if(\"string\"==typeof t&&\"string\"==typeof e&&t.length===e.length)return _(t,e);var n=Q(t),r=Q(e),i=_(n.seconds,r.seconds);return 0!==i?i:_(n.nanos,r.nanos)}function ot(t){return ut(t)}function ut(t){return\"nullValue\"in t?\"null\":\"booleanValue\"in t?\"\"+t.booleanValue:\"integerValue\"in t?\"\"+t.integerValue:\"doubleValue\"in t?\"\"+t.doubleValue:\"timestampValue\"in t?function(t){var e=Q(t);return\"time(\"+e.seconds+\",\"+e.nanos+\")\"}(t.timestampValue):\"stringValue\"in t?t.stringValue:\"bytesValue\"in t?H(t.bytesValue).toBase64():\"referenceValue\"in t?(n=t.referenceValue,q.ft(n).toString()):\"geoPointValue\"in t?\"geo(\"+(e=t.geoPointValue).latitude+\",\"+e.longitude+\")\":\"arrayValue\"in t?function(t){for(var e=\"[\",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=\",\",e+=ut(i[r]);return e+\"]\"}(t.arrayValue):\"mapValue\"in t?function(t){for(var e=\"{\",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=\",\",e+=o+\":\"+ut(t.fields[o])}return e+\"}\"}(t.mapValue):d();var e,n}function st(t,e){return{referenceValue:\"projects/\"+t.projectId+\"/databases/\"+t.database+\"/documents/\"+e.path.rt()}}function at(t){return!!t&&\"integerValue\"in t}function ct(t){return!!t&&\"arrayValue\"in t}function ht(t){return!!t&&\"nullValue\"in t}function ft(t){return!!t&&\"doubleValue\"in t&&isNaN(Number(t.doubleValue))}function lt(t){return!!t&&\"mapValue\"in t}var pt=function(){function t(t){this.proto=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(t){if(t.et())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!lt(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.tt()])||null},t.prototype.isEqual=function(t){return et(this.proto,t.proto)},t}(),dt=function(){function t(t){void 0===t&&(t=pt.empty()),this.It=t,this.At=new Map}return t.prototype.set=function(t,e){return this.Rt(t,e),this},t.prototype.delete=function(t){return this.Rt(t,null),this},t.prototype.Rt=function(t,e){for(var n=this.At,r=0;r<t.length-1;++r){var i=t.get(r),o=n.get(i);o instanceof Map?n=o:o&&10===tt(o)?(o=new Map(Object.entries(o.mapValue.fields||{})),n.set(i,o),n=o):(o=new Map,n.set(i,o),n=o)}n.set(t.tt(),e)},t.prototype.Pt=function(){var t=this.yt(M.ct(),this.At);return null!=t?new pt(t):this.It},t.prototype.yt=function(t,e){var n=this,r=!1,i=this.It.field(t),o=lt(i)?Object.assign({},i.mapValue.fields):{};return e.forEach(function(e,i){if(e instanceof Map){var u=n.yt(t.child(i),e);null!=u&&(o[i]=u,r=!0)}else null!==e?(o[i]=e,r=!0):o.hasOwnProperty(i)&&(delete o[i],r=!0)}),r?{mapValue:{fields:o}}:null},t}();function vt(t){var e=[];return j(t.fields||{},function(t,n){var r=new M([t]);if(lt(n)){var i=vt(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,u=i;o<u.length;o++){var s=u[o];e.push(r.child(s))}}else e.push(r)}),new G(e)}var yt=function(t,e){this.key=t,this.version=e},gt=function(t){function e(e,n,r,i){var o=this;return(o=t.call(this,e,n)||this).gt=r,o.Vt=!!i.Vt,o.hasCommittedMutations=!!i.hasCommittedMutations,o}return(0,i.__extends)(e,t),e.prototype.field=function(t){return this.gt.field(t)},e.prototype.data=function(){return this.gt},e.prototype.bt=function(){return this.gt.proto},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.Vt===t.Vt&&this.hasCommittedMutations===t.hasCommittedMutations&&this.gt.isEqual(t.gt)},e.prototype.toString=function(){return\"Document(\"+this.key+\", \"+this.version+\", \"+this.gt.toString()+\", {hasLocalMutations: \"+this.Vt+\"}), {hasCommittedMutations: \"+this.hasCommittedMutations+\"})\"},Object.defineProperty(e.prototype,\"hasPendingWrites\",{get:function(){return this.Vt||this.hasCommittedMutations},enumerable:!1,configurable:!0}),e}(yt),mt=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n)||this).hasCommittedMutations=!(!r||!r.hasCommittedMutations),i}return(0,i.__extends)(e,t),e.prototype.toString=function(){return\"NoDocument(\"+this.key+\", \"+this.version+\")\"},Object.defineProperty(e.prototype,\"hasPendingWrites\",{get:function(){return this.hasCommittedMutations},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(yt),_t=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),e.prototype.toString=function(){return\"UnknownDocument(\"+this.key+\", \"+this.version+\")\"},Object.defineProperty(e.prototype,\"hasPendingWrites\",{get:function(){return!0},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(yt),wt=function(t,e,n,r,i,o,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=u,this.vt=null};function bt(t,e,n,r,i,o,u){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===u&&(u=null),new wt(t,e,n,r,i,o,u)}function It(t){var e=y(t);if(null===e.vt){var n=e.path.rt();null!==e.collectionGroup&&(n+=\"|cg:\"+e.collectionGroup),n+=\"|f:\",n+=e.filters.map(function(t){return function(t){return t.field.rt()+t.op.toString()+ot(t.value)}(t)}).join(\",\"),n+=\"|ob:\",n+=e.orderBy.map(function(t){return function(t){return t.field.rt()+t.dir}(t)}).join(\",\"),Z(e.limit)||(n+=\"|l:\",n+=e.limit),e.startAt&&(n+=\"|lb:\",n+=Ct(e.startAt)),e.endAt&&(n+=\"|ub:\",n+=Ct(e.endAt)),e.vt=n}return e.vt}function Et(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!Ut(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if(i=t.filters[r],o=e.filters[r],i.op!==o.op||!i.field.isEqual(o.field)||!et(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!qt(t.startAt,e.startAt)&&qt(t.endAt,e.endAt)}function Tt(t){return q.wt(t.path)&&null===t.collectionGroup&&0===t.filters.length}var xt=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return(0,i.__extends)(e,t),e.create=function(t,n,r){return t.ut()?\"in\"===n||\"not-in\"===n?this.St(t,n,r):new Nt(t,n,r):\"array-contains\"===n?new kt(t,r):\"in\"===n?new Ot(t,r):\"not-in\"===n?new Pt(t,r):\"array-contains-any\"===n?new Vt(t,r):new e(t,n,r)},e.St=function(t,e,n){return\"in\"===e?new At(t,n):new St(t,n)},e.prototype.matches=function(t){var e=t.field(this.field);return\"!=\"===this.op?null!==e&&this.Dt(rt(e,this.value)):null!==e&&tt(this.value)===tt(e)&&this.Dt(rt(e,this.value))},e.prototype.Dt=function(t){switch(this.op){case\"<\":return t<0;case\"<=\":return t<=0;case\"==\":return 0===t;case\"!=\":return 0!==t;case\">\":return t>0;case\">=\":return t>=0;default:return d()}},e.prototype.Ct=function(){return[\"<\",\"<=\",\">\",\">=\",\"!=\",\"not-in\"].indexOf(this.op)>=0},e}(function(){}),Nt=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=q.ft(r.referenceValue),i}return(0,i.__extends)(e,t),e.prototype.matches=function(t){var e=q.H(t.key,this.key);return this.Dt(e)},e}(xt),At=function(t){function e(e,n){var r=this;return(r=t.call(this,e,\"in\",n)||this).keys=Dt(\"in\",n),r}return(0,i.__extends)(e,t),e.prototype.matches=function(t){return this.keys.some(function(e){return e.isEqual(t.key)})},e}(xt),St=function(t){function e(e,n){var r=this;return(r=t.call(this,e,\"not-in\",n)||this).keys=Dt(\"not-in\",n),r}return(0,i.__extends)(e,t),e.prototype.matches=function(t){return!this.keys.some(function(e){return e.isEqual(t.key)})},e}(xt);function Dt(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(function(t){return q.ft(t.referenceValue)})}var kt=function(t){function e(e,n){return t.call(this,e,\"array-contains\",n)||this}return(0,i.__extends)(e,t),e.prototype.matches=function(t){var e=t.field(this.field);return ct(e)&&nt(e.arrayValue,this.value)},e}(xt),Ot=function(t){function e(e,n){return t.call(this,e,\"in\",n)||this}return(0,i.__extends)(e,t),e.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&nt(this.value.arrayValue,e)},e}(xt),Pt=function(t){function e(e,n){return t.call(this,e,\"not-in\",n)||this}return(0,i.__extends)(e,t),e.prototype.matches=function(t){if(nt(this.value.arrayValue,{nullValue:\"NULL_VALUE\"}))return!1;var e=t.field(this.field);return null!==e&&!nt(this.value.arrayValue,e)},e}(xt),Vt=function(t){function e(e,n){return t.call(this,e,\"array-contains-any\",n)||this}return(0,i.__extends)(e,t),e.prototype.matches=function(t){var e=this,n=t.field(this.field);return!(!ct(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(t){return nt(e.value.arrayValue,t)})},e}(xt),Lt=function(t,e){this.position=t,this.before=e};function Ct(t){return(t.before?\"b\":\"a\")+\":\"+t.position.map(function(t){return ot(t)}).join(\",\")}var Rt=function(t,e){void 0===e&&(e=\"asc\"),this.field=t,this.dir=e};function Ut(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function Mt(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],u=t.position[i];if(r=o.field.ut()?q.H(q.ft(u.referenceValue),n.key):rt(u,n.field(o.field)),\"desc\"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function qt(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!et(t.position[n],e.position[n]))return!1;return!0}var Ft=function(t,e,n,r,i,o,u,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=\"F\"),void 0===u&&(u=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.xt=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=u,this.endAt=s,this.Nt=null,this.$t=null,this.startAt,this.endAt};function jt(t,e,n,r,i,o,u,s){return new Ft(t,e,n,r,i,o,u,s)}function zt(t){return new Ft(t)}function Gt(t){return!Z(t.limit)&&\"F\"===t.limitType}function Bt(t){return!Z(t.limit)&&\"L\"===t.limitType}function Qt(t){return t.xt.length>0?t.xt[0].field:null}function Yt(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.Ct())return r.field}return null}function Ht(t){return null!==t.collectionGroup}function Kt(t){var e=y(t);if(null===e.Nt){e.Nt=[];var n=Yt(e),r=Qt(e);if(null!==n&&null===r)n.ut()||e.Nt.push(new Rt(n)),e.Nt.push(new Rt(M.ht(),\"asc\"));else{for(var i=!1,o=0,u=e.xt;o<u.length;o++){var s=u[o];e.Nt.push(s),s.field.ut()&&(i=!0)}if(!i){var a=e.xt.length>0?e.xt[e.xt.length-1].dir:\"asc\";e.Nt.push(new Rt(M.ht(),a))}}}return e.Nt}function Xt(t){var e=y(t);if(!e.$t)if(\"F\"===e.limitType)e.$t=bt(e.path,e.collectionGroup,Kt(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=Kt(e);r<i.length;r++){var o=i[r],u=\"desc\"===o.dir?\"asc\":\"desc\";n.push(new Rt(o.field,u))}var s=e.endAt?new Lt(e.endAt.position,!e.endAt.before):null,a=e.startAt?new Lt(e.startAt.position,!e.startAt.before):null;e.$t=bt(e.path,e.collectionGroup,n,e.filters,e.limit,s,a)}return e.$t}function Wt(t,e,n){return new Ft(t.path,t.collectionGroup,t.xt.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Zt(t,e){return Et(Xt(t),Xt(e))&&t.limitType===e.limitType}function Jt(t){return It(Xt(t))+\"|lt:\"+t.limitType}function $t(t){return\"Query(target=\"+function(t){var e=t.path.rt();return null!==t.collectionGroup&&(e+=\" collectionGroup=\"+t.collectionGroup),t.filters.length>0&&(e+=\", filters: [\"+t.filters.map(function(t){return(e=t).field.rt()+\" \"+e.op+\" \"+ot(e.value);var e}).join(\", \")+\"]\"),Z(t.limit)||(e+=\", limit: \"+t.limit),t.orderBy.length>0&&(e+=\", orderBy: [\"+t.orderBy.map(function(t){return function(t){return t.field.rt()+\" (\"+t.dir+\")\"}(t)}).join(\", \")+\"]\"),t.startAt&&(e+=\", startAt: \"+Ct(t.startAt)),t.endAt&&(e+=\", endAt: \"+Ct(t.endAt)),\"Target(\"+e+\")\"}(Xt(t))+\"; limitType=\"+t.limitType+\")\"}function te(t,e){return function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.dt(t.collectionGroup)&&t.path.nt(n):q.wt(t.path)?t.path.isEqual(n):t.path.st(n)}(t,e)&&function(t,e){for(var n=0,r=t.xt;n<r.length;n++){var i=r[n];if(!i.field.ut()&&null===e.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!Mt(t.startAt,Kt(t),e)||t.endAt&&Mt(t.endAt,Kt(t),e))}(t,e)}function ee(t){return function(e,n){for(var r=!1,i=0,o=Kt(t);i<o.length;i++){var u=o[i],s=ne(u,e,n);if(0!==s)return s;r=r||u.field.ut()}return 0}}function ne(t,e,n){var r=t.field.ut()?q.H(e.key,n.key):function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?rt(r,i):d()}(t.field,e,n);switch(t.dir){case\"asc\":return r;case\"desc\":return-1*r;default:return d()}}var re=function(){function t(t,e,n,r,i,o,u){void 0===i&&(i=L.min()),void 0===o&&(o=L.min()),void 0===u&&(u=I.T),this.target=t,this.targetId=e,this.Ft=n,this.sequenceNumber=r,this.Ot=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=u}return t.prototype.kt=function(e){return new t(this.target,this.targetId,this.Ft,e,this.Ot,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.Mt=function(e,n){return new t(this.target,this.targetId,this.Ft,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.Lt=function(e){return new t(this.target,this.targetId,this.Ft,this.sequenceNumber,this.Ot,e,this.resumeToken)},t}();function ie(t,e){if(t.Bt){if(isNaN(e))return{doubleValue:\"NaN\"};if(e===1/0)return{doubleValue:\"Infinity\"};if(e===-1/0)return{doubleValue:\"-Infinity\"}}return{doubleValue:J(e)?\"-0\":e}}function oe(t){return{integerValue:\"\"+t}}function ue(t,e){return $(e)?oe(e):ie(t,e)}var se=function(){this.qt=void 0};function ae(t,e,n){return t instanceof fe?function(t,e){var n={fields:{__type__:{stringValue:\"server_timestamp\"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof le?pe(t,e):t instanceof de?ve(t,e):function(t,e){var n=he(t,e),r=ge(n)+ge(t.Ut);return at(n)&&at(t.Ut)?oe(r):ie(t.Qt,r)}(t,e)}function ce(t,e,n){return t instanceof le?pe(t,e):t instanceof de?ve(t,e):n}function he(t,e){return t instanceof ye?at(n=e)||n&&\"doubleValue\"in n?e:{integerValue:0}:null;var n}var fe=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),e}(se),le=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return(0,i.__extends)(e,t),e}(se);function pe(t,e){for(var n=me(e),r=function(t){n.some(function(e){return et(e,t)})||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var de=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return(0,i.__extends)(e,t),e}(se);function ve(t,e){for(var n=me(e),r=function(t){n=n.filter(function(e){return!et(e,t)})},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var ye=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Qt=e,r.Ut=n,r}return(0,i.__extends)(e,t),e}(se);function ge(t){return Y(t.integerValue||t.doubleValue)}function me(t){return ct(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var _e=function(t,e){this.field=t,this.transform=e},we=function(t,e){this.version=t,this.transformResults=e},be=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.Kt=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,\"Wt\",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function Ie(t,e){return void 0!==t.updateTime?e instanceof gt&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof gt}var Ee=function(){};function Te(t,e,n){return t instanceof De?function(t,e,n){var r=t.value;if(n.transformResults){var i=Pe(t.fieldTransforms,e,n.transformResults);r=Le(t.fieldTransforms,r,i)}return new gt(t.key,n.version,r,{hasCommittedMutations:!0})}(t,e,n):t instanceof ke?function(t,e,n){if(!Ie(t.jt,e))return new _t(t.key,n.version);var r=Oe(t,e,n.transformResults?Pe(t.fieldTransforms,e,n.transformResults):[]);return new gt(t.key,n.version,r,{hasCommittedMutations:!0})}(t,e,n):function(t,e,n){return new mt(t.key,n.version,{hasCommittedMutations:!0})}(t,0,n)}function xe(t,e,n){return t instanceof De?function(t,e,n){if(!Ie(t.jt,e))return e;var r=t.value,i=Ve(t.fieldTransforms,n,e);r=Le(t.fieldTransforms,r,i);var o=Se(e);return new gt(t.key,o,r,{Vt:!0})}(t,e,n):t instanceof ke?function(t,e,n){if(!Ie(t.jt,e))return e;var r=Se(e),i=Oe(t,e,Ve(t.fieldTransforms,n,e));return new gt(t.key,r,i,{Vt:!0})}(t,e,n):function(t,e){return Ie(t.jt,e)?new mt(t.key,L.min()):e}(t,e)}function Ne(t,e){return function(t,e){for(var n=null,r=0,i=t;r<i.length;r++){var o=i[r],u=e instanceof gt?e.field(o.field):void 0,s=he(o.transform,u||null);null!=s&&(n=null==n?(new dt).set(o.field,s):n.set(o.field,s))}return n?n.Pt():null}(t.fieldTransforms,e)}function Ae(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.jt.isEqual(e.jt)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&w(t,e,function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof le&&e instanceof le||t instanceof de&&e instanceof de?w(t.elements,e.elements,et):t instanceof ye&&e instanceof ye?et(t.Ut,e.Ut):t instanceof fe&&e instanceof fe}(t.transform,e.transform)}(t,e)})}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.Gt.isEqual(e.Gt))}function Se(t){return t instanceof gt?t.version:L.min()}var De=function(t){function e(e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=t.call(this)||this).key=e,o.value=n,o.jt=r,o.fieldTransforms=i,o.type=0,o}return(0,i.__extends)(e,t),e}(Ee),ke=function(t){function e(e,n,r,i,o){void 0===o&&(o=[]);var u=this;return(u=t.call(this)||this).key=e,u.data=n,u.Gt=r,u.jt=i,u.fieldTransforms=o,u.type=1,u}return(0,i.__extends)(e,t),e}(Ee);function Oe(t,e,n){var r;return r=function(t,e){var n=new dt(e);return t.Gt.fields.forEach(function(e){if(!e.et()){var r=t.data.field(e);null!==r?n.set(e,r):n.delete(e)}}),n.Pt()}(t,r=e instanceof gt?e.data():pt.empty()),Le(t.fieldTransforms,r,n)}function Pe(t,e,n){var r=[];v(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],u=o.transform,s=null;e instanceof gt&&(s=e.field(o.field)),r.push(ce(u,s,n[i]))}return r}function Ve(t,e,n){for(var r=[],i=0,o=t;i<o.length;i++){var u=o[i],s=u.transform,a=null;n instanceof gt&&(a=n.field(u.field)),r.push(ae(s,a,e))}return r}function Le(t,e,n){for(var r=new dt(e),i=0;i<t.length;i++){var o=t[i];r.set(o.field,n[i])}return r.Pt()}var Ce,Re,Ue=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.jt=n,r.type=2,r.fieldTransforms=[],r}return(0,i.__extends)(e,t),e}(Ee),Me=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.jt=n,r.type=3,r.fieldTransforms=[],r}return(0,i.__extends)(e,t),e}(Ee),qe=function(t){this.count=t};function Fe(t){switch(t){case E.OK:return d();case E.CANCELLED:case E.UNKNOWN:case E.DEADLINE_EXCEEDED:case E.RESOURCE_EXHAUSTED:case E.INTERNAL:case E.UNAVAILABLE:case E.UNAUTHENTICATED:return!1;case E.INVALID_ARGUMENT:case E.NOT_FOUND:case E.ALREADY_EXISTS:case E.PERMISSION_DENIED:case E.FAILED_PRECONDITION:case E.ABORTED:case E.OUT_OF_RANGE:case E.UNIMPLEMENTED:case E.DATA_LOSS:return!0;default:return d()}}function je(t){if(void 0===t)return f(\"GRPC error has no .code\"),E.UNKNOWN;switch(t){case Ce.OK:return E.OK;case Ce.CANCELLED:return E.CANCELLED;case Ce.UNKNOWN:return E.UNKNOWN;case Ce.DEADLINE_EXCEEDED:return E.DEADLINE_EXCEEDED;case Ce.RESOURCE_EXHAUSTED:return E.RESOURCE_EXHAUSTED;case Ce.INTERNAL:return E.INTERNAL;case Ce.UNAVAILABLE:return E.UNAVAILABLE;case Ce.UNAUTHENTICATED:return E.UNAUTHENTICATED;case Ce.INVALID_ARGUMENT:return E.INVALID_ARGUMENT;case Ce.NOT_FOUND:return E.NOT_FOUND;case Ce.ALREADY_EXISTS:return E.ALREADY_EXISTS;case Ce.PERMISSION_DENIED:return E.PERMISSION_DENIED;case Ce.FAILED_PRECONDITION:return E.FAILED_PRECONDITION;case Ce.ABORTED:return E.ABORTED;case Ce.OUT_OF_RANGE:return E.OUT_OF_RANGE;case Ce.UNIMPLEMENTED:return E.UNIMPLEMENTED;case Ce.DATA_LOSS:return E.DATA_LOSS;default:return d()}}(Re=Ce||(Ce={}))[Re.OK=0]=\"OK\",Re[Re.CANCELLED=1]=\"CANCELLED\",Re[Re.UNKNOWN=2]=\"UNKNOWN\",Re[Re.INVALID_ARGUMENT=3]=\"INVALID_ARGUMENT\",Re[Re.DEADLINE_EXCEEDED=4]=\"DEADLINE_EXCEEDED\",Re[Re.NOT_FOUND=5]=\"NOT_FOUND\",Re[Re.ALREADY_EXISTS=6]=\"ALREADY_EXISTS\",Re[Re.PERMISSION_DENIED=7]=\"PERMISSION_DENIED\",Re[Re.UNAUTHENTICATED=16]=\"UNAUTHENTICATED\",Re[Re.RESOURCE_EXHAUSTED=8]=\"RESOURCE_EXHAUSTED\",Re[Re.FAILED_PRECONDITION=9]=\"FAILED_PRECONDITION\",Re[Re.ABORTED=10]=\"ABORTED\",Re[Re.OUT_OF_RANGE=11]=\"OUT_OF_RANGE\",Re[Re.UNIMPLEMENTED=12]=\"UNIMPLEMENTED\",Re[Re.INTERNAL=13]=\"INTERNAL\",Re[Re.UNAVAILABLE=14]=\"UNAVAILABLE\",Re[Re.DATA_LOSS=15]=\"DATA_LOSS\";var ze=function(){function t(t,e){this.H=t,this.root=e||Be.EMPTY}return t.prototype.zt=function(e,n){return new t(this.H,this.root.zt(e,n,this.H).copy(null,null,Be.Ht,null,null))},t.prototype.remove=function(e){return new t(this.H,this.root.remove(e,this.H).copy(null,null,Be.Ht,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.et();){var n=this.H(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.et();){var r=this.H(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.et=function(){return this.root.et()},Object.defineProperty(t.prototype,\"size\",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.Jt=function(){return this.root.Jt()},t.prototype.Yt=function(){return this.root.Yt()},t.prototype.Xt=function(t){return this.root.Xt(t)},t.prototype.forEach=function(t){this.Xt(function(e,n){return t(e,n),!1})},t.prototype.toString=function(){var t=[];return this.Xt(function(e,n){return t.push(e+\":\"+n),!1}),\"{\"+t.join(\", \")+\"}\"},t.prototype.Zt=function(t){return this.root.Zt(t)},t.prototype.te=function(){return new Ge(this.root,null,this.H,!1)},t.prototype.ee=function(t){return new Ge(this.root,t,this.H,!1)},t.prototype.ne=function(){return new Ge(this.root,null,this.H,!0)},t.prototype.se=function(t){return new Ge(this.root,t,this.H,!0)},t}(),Ge=function(){function t(t,e,n,r){this.ie=r,this.re=[];for(var i=1;!t.et();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.ie?t.left:t.right;else{if(0===i){this.re.push(t);break}this.re.push(t),t=this.ie?t.right:t.left}}return t.prototype.oe=function(){var t=this.re.pop(),e={key:t.key,value:t.value};if(this.ie)for(t=t.left;!t.et();)this.re.push(t),t=t.right;else for(t=t.right;!t.et();)this.re.push(t),t=t.left;return e},t.prototype.ce=function(){return this.re.length>0},t.prototype.ae=function(){if(0===this.re.length)return null;var t=this.re[this.re.length-1];return{key:t.key,value:t.value}},t}(),Be=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.et=function(){return!1},t.prototype.Xt=function(t){return this.left.Xt(t)||t(this.key,this.value)||this.right.Xt(t)},t.prototype.Zt=function(t){return this.right.Zt(t)||t(this.key,this.value)||this.left.Zt(t)},t.prototype.min=function(){return this.left.et()?this:this.left.min()},t.prototype.Jt=function(){return this.min().key},t.prototype.Yt=function(){return this.right.et()?this.key:this.right.Yt()},t.prototype.zt=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.zt(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.zt(t,e,n))).ue()},t.prototype.he=function(){if(this.left.et())return t.EMPTY;var e=this;return e.left.le()||e.left.left.le()||(e=e._e()),(e=e.copy(null,null,null,e.left.he(),null)).ue()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.et()||i.left.le()||i.left.left.le()||(i=i._e()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.le()&&(i=i.fe()),i.right.et()||i.right.le()||i.right.left.le()||(i=i.de()),0===n(e,i.key)){if(i.right.et())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.he())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.ue()},t.prototype.le=function(){return this.color},t.prototype.ue=function(){var t=this;return t.right.le()&&!t.left.le()&&(t=t.we()),t.left.le()&&t.left.left.le()&&(t=t.fe()),t.left.le()&&t.right.le()&&(t=t.Ee()),t},t.prototype._e=function(){var t=this.Ee();return t.right.left.le()&&(t=(t=(t=t.copy(null,null,null,null,t.right.fe())).we()).Ee()),t},t.prototype.de=function(){var t=this.Ee();return t.left.left.le()&&(t=(t=t.fe()).Ee()),t},t.prototype.we=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.fe=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.Ee=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.Te=function(){var t=this.Ie();return Math.pow(2,t)<=this.size+1},t.prototype.Ie=function(){if(this.le()&&this.left.le())throw d();if(this.right.le())throw d();var t=this.left.Ie();if(t!==this.right.Ie())throw d();return t+(this.le()?0:1)},t}();Be.EMPTY=null,Be.RED=!0,Be.Ht=!1,Be.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,\"key\",{get:function(){throw d()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"value\",{get:function(){throw d()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"color\",{get:function(){throw d()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"left\",{get:function(){throw d()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"right\",{get:function(){throw d()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.zt=function(t,e,n){return new Be(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.et=function(){return!0},t.prototype.Xt=function(t){return!1},t.prototype.Zt=function(t){return!1},t.prototype.Jt=function(){return null},t.prototype.Yt=function(){return null},t.prototype.le=function(){return!1},t.prototype.Te=function(){return!0},t.prototype.Ie=function(){return 0},t}());var Qe=function(){function t(t){this.H=t,this.data=new ze(this.H)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.Jt()},t.prototype.last=function(){return this.data.Yt()},Object.defineProperty(t.prototype,\"size\",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.Xt(function(e,n){return t(e),!1})},t.prototype.me=function(t,e){for(var n=this.data.ee(t[0]);n.ce();){var r=n.oe();if(this.H(r.key,t[1])>=0)return;e(r.key)}},t.prototype.Ae=function(t,e){var n;for(n=void 0!==e?this.data.ee(e):this.data.te();n.ce();)if(!t(n.oe().key))return},t.prototype.Re=function(t){var e=this.data.ee(t);return e.ce()?e.oe().key:null},t.prototype.te=function(){return new Ye(this.data.te())},t.prototype.ee=function(t){return new Ye(this.data.ee(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).zt(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.et=function(){return this.data.et()},t.prototype.Pe=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.te(),r=e.data.te();n.ce();){var i=n.oe().key,o=r.oe().key;if(0!==this.H(i,o))return!1}return!0},t.prototype.it=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},t.prototype.toString=function(){var t=[];return this.forEach(function(e){return t.push(e)}),\"SortedSet(\"+t.toString()+\")\"},t.prototype.copy=function(e){var n=new t(this.H);return n.data=e,n},t}(),Ye=function(){function t(t){this.ye=t}return t.prototype.oe=function(){return this.ye.oe().key},t.prototype.ce=function(){return this.ye.ce()},t}(),He=new ze(q.H);function Ke(){return He}function Xe(){return Ke()}var We=new ze(q.H);function Ze(){return We}var Je=new ze(q.H);function $e(){return Je}var tn=new Qe(q.H);function en(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=tn,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var nn=new Qe(_);function rn(){return nn}var on=function(){function t(t){this.H=t?function(e,n){return t(e,n)||q.H(e.key,n.key)}:function(t,e){return q.H(t.key,e.key)},this.ge=Ze(),this.Ve=new ze(this.H)}return t.pe=function(e){return new t(e.H)},t.prototype.has=function(t){return null!=this.ge.get(t)},t.prototype.get=function(t){return this.ge.get(t)},t.prototype.first=function(){return this.Ve.Jt()},t.prototype.last=function(){return this.Ve.Yt()},t.prototype.et=function(){return this.Ve.et()},t.prototype.indexOf=function(t){var e=this.ge.get(t);return e?this.Ve.indexOf(e):-1},Object.defineProperty(t.prototype,\"size\",{get:function(){return this.Ve.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.Ve.Xt(function(e,n){return t(e),!1})},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.ge.zt(t.key,t),e.Ve.zt(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.ge.remove(t),this.Ve.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.Ve.te(),r=e.Ve.te();n.ce();){var i=n.oe().key,o=r.oe().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach(function(e){t.push(e.toString())}),0===t.length?\"DocumentSet ()\":\"DocumentSet (\\n  \"+t.join(\"  \\n\")+\"\\n)\"},t.prototype.copy=function(e,n){var r=new t;return r.H=this.H,r.ge=e,r.Ve=n,r},t}(),un=function(){function t(){this.be=new ze(q.H)}return t.prototype.track=function(t){var e=t.doc.key,n=this.be.get(e);n?0!==t.type&&3===n.type?this.be=this.be.zt(e,t):3===t.type&&1!==n.type?this.be=this.be.zt(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.be=this.be.zt(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.be=this.be.zt(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.be=this.be.remove(e):1===t.type&&2===n.type?this.be=this.be.zt(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.be=this.be.zt(e,{type:2,doc:t.doc}):d():this.be=this.be.zt(e,t)},t.prototype.ve=function(){var t=[];return this.be.Xt(function(e,n){t.push(n)}),t},t}(),sn=function(){function t(t,e,n,r,i,o,u,s){this.query=t,this.docs=e,this.Se=n,this.docChanges=r,this.De=i,this.fromCache=o,this.Ce=u,this.xe=s}return t.Ne=function(e,n,r,i){var o=[];return n.forEach(function(t){o.push({type:0,doc:t})}),new t(e,n,on.pe(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,\"hasPendingWrites\",{get:function(){return!this.De.et()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.Ce===t.Ce&&this.De.isEqual(t.De)&&Zt(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.Se.isEqual(t.Se)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),an=function(){function t(t,e,n,r,i){this.Ot=t,this.$e=e,this.Fe=n,this.Oe=r,this.ke=i}return t.Me=function(e,n){var r=new Map;return r.set(e,cn.Le(e,n)),new t(L.min(),r,rn(),Ke(),en())},t}(),cn=function(){function t(t,e,n,r,i){this.resumeToken=t,this.Be=e,this.qe=n,this.Ue=r,this.Qe=i}return t.Le=function(e,n){return new t(I.T,n,en(),en(),en())},t}(),hn=function(t,e,n,r){this.Ke=t,this.removedTargetIds=e,this.key=n,this.We=r},fn=function(t,e){this.targetId=t,this.je=e},ln=function(t,e,n,r){void 0===n&&(n=I.T),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},pn=function(){function t(){this.Ge=0,this.ze=yn(),this.He=I.T,this.Je=!1,this.Ye=!0}return Object.defineProperty(t.prototype,\"Be\",{get:function(){return this.Je},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"resumeToken\",{get:function(){return this.He},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"Xe\",{get:function(){return 0!==this.Ge},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"Ze\",{get:function(){return this.Ye},enumerable:!1,configurable:!0}),t.prototype.tn=function(t){t.l()>0&&(this.Ye=!0,this.He=t)},t.prototype.en=function(){var t=en(),e=en(),n=en();return this.ze.forEach(function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:d()}}),new cn(this.He,this.Je,t,e,n)},t.prototype.nn=function(){this.Ye=!1,this.ze=yn()},t.prototype.sn=function(t,e){this.Ye=!0,this.ze=this.ze.zt(t,e)},t.prototype.rn=function(t){this.Ye=!0,this.ze=this.ze.remove(t)},t.prototype.on=function(){this.Ge+=1},t.prototype.cn=function(){this.Ge-=1},t.prototype.an=function(){this.Ye=!0,this.Je=!0},t}(),dn=function(){function t(t){this.un=t,this.hn=new Map,this.ln=Ke(),this._n=vn(),this.fn=new Qe(_)}return t.prototype.dn=function(t){for(var e=0,n=t.Ke;e<n.length;e++){var r=n[e];t.We instanceof gt?this.wn(r,t.We):t.We instanceof mt&&this.En(r,t.key,t.We)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.En(r,t.key,t.We)},t.prototype.Tn=function(t){var e=this;this.In(t,function(n){var r=e.mn(n);switch(t.state){case 0:e.An(n)&&r.tn(t.resumeToken);break;case 1:r.cn(),r.Xe||r.nn(),r.tn(t.resumeToken);break;case 2:r.cn(),r.Xe||e.removeTarget(n);break;case 3:e.An(n)&&(r.an(),r.tn(t.resumeToken));break;case 4:e.An(n)&&(e.Rn(n),r.tn(t.resumeToken));break;default:d()}})},t.prototype.In=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.hn.forEach(function(t,r){n.An(r)&&e(r)})},t.prototype.Pn=function(t){var e=t.targetId,n=t.je.count,r=this.yn(e);if(r){var i=r.target;if(Tt(i))if(0===n){var o=new q(i.path);this.En(e,o,new mt(o,L.min()))}else v(1===n);else this.gn(e)!==n&&(this.Rn(e),this.fn=this.fn.add(e))}},t.prototype.Vn=function(t){var e=this,n=new Map;this.hn.forEach(function(r,i){var o=e.yn(i);if(o){if(r.Be&&Tt(o.target)){var u=new q(o.target.path);null!==e.ln.get(u)||e.pn(i,u)||e.En(i,u,new mt(u,t))}r.Ze&&(n.set(i,r.en()),r.nn())}});var r=en();this._n.forEach(function(t,n){var i=!0;n.Ae(function(t){var n=e.yn(t);return!n||2===n.Ft||(i=!1,!1)}),i&&(r=r.add(t))});var i=new an(t,n,this.fn,this.ln,r);return this.ln=Ke(),this._n=vn(),this.fn=new Qe(_),i},t.prototype.wn=function(t,e){if(this.An(t)){var n=this.pn(t,e.key)?2:0;this.mn(t).sn(e.key,n),this.ln=this.ln.zt(e.key,e),this._n=this._n.zt(e.key,this.bn(e.key).add(t))}},t.prototype.En=function(t,e,n){if(this.An(t)){var r=this.mn(t);this.pn(t,e)?r.sn(e,1):r.rn(e),this._n=this._n.zt(e,this.bn(e).delete(t)),n&&(this.ln=this.ln.zt(e,n))}},t.prototype.removeTarget=function(t){this.hn.delete(t)},t.prototype.gn=function(t){var e=this.mn(t).en();return this.un.vn(t).size+e.qe.size-e.Qe.size},t.prototype.on=function(t){this.mn(t).on()},t.prototype.mn=function(t){var e=this.hn.get(t);return e||(e=new pn,this.hn.set(t,e)),e},t.prototype.bn=function(t){var e=this._n.get(t);return e||(e=new Qe(_),this._n=this._n.zt(t,e)),e},t.prototype.An=function(t){var e=null!==this.yn(t);return e||h(\"WatchChangeAggregator\",\"Detected inactive target\",t),e},t.prototype.yn=function(t){var e=this.hn.get(t);return e&&e.Xe?null:this.un.Sn(t)},t.prototype.Rn=function(t){var e=this;this.hn.set(t,new pn),this.un.vn(t).forEach(function(n){e.En(t,n,null)})},t.prototype.pn=function(t,e){return this.un.vn(t).has(e)},t}();function vn(){return new ze(q.H)}function yn(){return new ze(q.H)}var gn={asc:\"ASCENDING\",desc:\"DESCENDING\"},mn={\"<\":\"LESS_THAN\",\"<=\":\"LESS_THAN_OR_EQUAL\",\">\":\"GREATER_THAN\",\">=\":\"GREATER_THAN_OR_EQUAL\",\"==\":\"EQUAL\",\"!=\":\"NOT_EQUAL\",\"array-contains\":\"ARRAY_CONTAINS\",in:\"IN\",\"not-in\":\"NOT_IN\",\"array-contains-any\":\"ARRAY_CONTAINS_ANY\"},_n=function(t,e){this.t=t,this.Bt=e};function wn(t,e){return t.Bt?new Date(1e3*e.seconds).toISOString().replace(/\\.\\d*/,\"\").replace(\"Z\",\"\")+\".\"+(\"000000000\"+e.nanoseconds).slice(-9)+\"Z\":{seconds:\"\"+e.seconds,nanos:e.nanoseconds}}function bn(t,e){return t.Bt?e.toBase64():e.toUint8Array()}function In(t,e){return wn(t,e.j())}function En(t){return v(!!t),L.K(function(t){var e=Q(t);return new V(e.seconds,e.nanos)}(t))}function Tn(t,e){return function(t){return new R([\"projects\",t.projectId,\"databases\",t.database])}(t).child(\"documents\").child(e).rt()}function xn(t){var e=R.ot(t);return v(Xn(e)),e}function Nn(t,e){return Tn(t.t,e.path)}function An(t,e){var n=xn(e);if(n.get(1)!==t.t.projectId)throw new T(E.INVALID_ARGUMENT,\"Tried to deserialize key from different project: \"+n.get(1)+\" vs \"+t.t.projectId);if(n.get(3)!==t.t.database)throw new T(E.INVALID_ARGUMENT,\"Tried to deserialize key from different database: \"+n.get(3)+\" vs \"+t.t.database);return new q(On(n))}function Sn(t,e){return Tn(t.t,e)}function Dn(t){var e=xn(t);return 4===e.length?R.ct():On(e)}function kn(t){return new R([\"projects\",t.t.projectId,\"databases\",t.t.database]).rt()}function On(t){return v(t.length>4&&\"documents\"===t.get(4)),t.Y(5)}function Pn(t,e,n){return{name:Nn(t,e),fields:n.proto.mapValue.fields}}function Vn(t,e,n){var r=An(t,e.name),i=En(e.updateTime),o=new pt({mapValue:{fields:e.fields}});return new gt(r,i,o,{hasCommittedMutations:!!n})}function Ln(t,e){var n;if(e instanceof De)n={update:Pn(t,e.key,e.value)};else if(e instanceof Ue)n={delete:Nn(t,e.key)};else if(e instanceof ke)n={update:Pn(t,e.key,e.data),updateMask:Kn(e.Gt)};else{if(!(e instanceof Me))return d();n={verify:Nn(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(function(t){return function(t,e){var n=e.transform;if(n instanceof fe)return{fieldPath:e.field.rt(),setToServerValue:\"REQUEST_TIME\"};if(n instanceof le)return{fieldPath:e.field.rt(),appendMissingElements:{values:n.elements}};if(n instanceof de)return{fieldPath:e.field.rt(),removeAllFromArray:{values:n.elements}};if(n instanceof ye)return{fieldPath:e.field.rt(),increment:n.Ut};throw d()}(0,t)})),e.jt.Wt||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:In(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:d()}(t,e.jt)),n}function Cn(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?be.updateTime(En(t.updateTime)):void 0!==t.exists?be.exists(t.exists):be.Kt()}(e.currentDocument):be.Kt(),r=e.updateTransforms?e.updateTransforms.map(function(e){return function(t,e){var n=null;if(\"setToServerValue\"in e)v(\"REQUEST_TIME\"===e.setToServerValue),n=new fe;else if(\"appendMissingElements\"in e){var r=e.appendMissingElements.values||[];n=new le(r)}else if(\"removeAllFromArray\"in e){var i=e.removeAllFromArray.values||[];n=new de(i)}else\"increment\"in e?n=new ye(t,e.increment):d();var o=M.lt(e.fieldPath);return new _e(o,n)}(t,e)}):[];if(e.update){e.update.name;var i=An(t,e.update.name),o=new pt({mapValue:{fields:e.update.fields}});if(e.updateMask){var u=function(t){var e=t.fieldPaths||[];return new G(e.map(function(t){return M.lt(t)}))}(e.updateMask);return new ke(i,o,u,n,r)}return new De(i,o,n,r)}if(e.delete){var s=An(t,e.delete);return new Ue(s,n)}if(e.verify){var a=An(t,e.verify);return new Me(a,n)}return d()}function Rn(t,e){return{documents:[Sn(t,e.path)]}}function Un(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=Sn(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Sn(t,r.X()),n.structuredQuery.from=[{collectionId:r.tt()}]);var i=function(t){if(0!==t.length){var e=t.map(function(t){return function(t){if(\"==\"===t.op){if(ft(t.value))return{unaryFilter:{field:Bn(t.field),op:\"IS_NAN\"}};if(ht(t.value))return{unaryFilter:{field:Bn(t.field),op:\"IS_NULL\"}}}else if(\"!=\"===t.op){if(ft(t.value))return{unaryFilter:{field:Bn(t.field),op:\"IS_NOT_NAN\"}};if(ht(t.value))return{unaryFilter:{field:Bn(t.field),op:\"IS_NOT_NULL\"}}}return{fieldFilter:{field:Bn(t.field),op:Gn(t.op),value:t.value}}}(t)});return 1===e.length?e[0]:{compositeFilter:{op:\"AND\",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map(function(t){return function(t){return{field:Bn(t.field),direction:zn(t.dir)}}(t)})}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var u=function(t,e){return t.Bt||Z(e)?e:{value:e}}(t,e.limit);return null!==u&&(n.structuredQuery.limit=u),e.startAt&&(n.structuredQuery.startAt=Fn(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Fn(e.endAt)),n}function Mn(t){var e=Dn(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){v(1===r);var u=n.from[0];u.allDescendants?i=u.collectionId:e=e.child(u.collectionId)}var s=[];n.where&&(s=qn(n.where));var a=[];n.orderBy&&(a=n.orderBy.map(function(t){return function(t){return new Rt(Qn(t.field),function(t){switch(t){case\"ASCENDING\":return\"asc\";case\"DESCENDING\":return\"desc\";default:return}}(t.direction))}(t)}));var c=null;n.limit&&(c=function(t){var e;return Z(e=\"object\"==o(t)?t.value:t)?null:e}(n.limit));var h=null;n.startAt&&(h=jn(n.startAt));var f=null;return n.endAt&&(f=jn(n.endAt)),jt(e,i,a,s,c,\"F\",h,f)}function qn(t){return t?void 0!==t.unaryFilter?[Hn(t)]:void 0!==t.fieldFilter?[Yn(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return qn(t)}).reduce(function(t,e){return t.concat(e)}):d():[]}function Fn(t){return{before:t.before,values:t.position}}function jn(t){var e=!!t.before,n=t.values||[];return new Lt(n,e)}function zn(t){return gn[t]}function Gn(t){return mn[t]}function Bn(t){return{fieldPath:t.rt()}}function Qn(t){return M.lt(t.fieldPath)}function Yn(t){return xt.create(Qn(t.fieldFilter.field),function(t){switch(t){case\"EQUAL\":return\"==\";case\"NOT_EQUAL\":return\"!=\";case\"GREATER_THAN\":return\">\";case\"GREATER_THAN_OR_EQUAL\":return\">=\";case\"LESS_THAN\":return\"<\";case\"LESS_THAN_OR_EQUAL\":return\"<=\";case\"ARRAY_CONTAINS\":return\"array-contains\";case\"IN\":return\"in\";case\"NOT_IN\":return\"not-in\";case\"ARRAY_CONTAINS_ANY\":return\"array-contains-any\";case\"OPERATOR_UNSPECIFIED\":default:return d()}}(t.fieldFilter.op),t.fieldFilter.value)}function Hn(t){switch(t.unaryFilter.op){case\"IS_NAN\":var e=Qn(t.unaryFilter.field);return xt.create(e,\"==\",{doubleValue:NaN});case\"IS_NULL\":var n=Qn(t.unaryFilter.field);return xt.create(n,\"==\",{nullValue:\"NULL_VALUE\"});case\"IS_NOT_NAN\":var r=Qn(t.unaryFilter.field);return xt.create(r,\"!=\",{doubleValue:NaN});case\"IS_NOT_NULL\":var i=Qn(t.unaryFilter.field);return xt.create(i,\"!=\",{nullValue:\"NULL_VALUE\"});case\"OPERATOR_UNSPECIFIED\":default:return d()}}function Kn(t){var e=[];return t.fields.forEach(function(t){return e.push(t.rt())}),{fieldPaths:e}}function Xn(t){return t.length>=4&&\"projects\"===t.get(0)&&\"databases\"===t.get(2)}var Wn=function(){var t=this;this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})},Zn=function(){function t(t){var e=this;this.Dn=null,this.Cn=null,this.result=void 0,this.error=void 0,this.xn=!1,this.Nn=!1,t(function(t){e.xn=!0,e.result=t,e.Dn&&e.Dn(t)},function(t){e.xn=!0,e.error=t,e.Cn&&e.Cn(t)})}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.Nn&&d(),this.Nn=!0,this.xn?this.error?this.$n(n,this.error):this.Fn(e,this.result):new t(function(t,i){r.Dn=function(n){r.Fn(e,n).next(t,i)},r.Cn=function(e){r.$n(n,e).next(t,i)}})},t.prototype.On=function(){var t=this;return new Promise(function(e,n){t.next(e,n)})},t.prototype.kn=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.Fn=function(e,n){return e?this.kn(function(){return e(n)}):t.resolve(n)},t.prototype.$n=function(e,n){return e?this.kn(function(){return e(n)}):t.reject(n)},t.resolve=function(e){return new t(function(t,n){t(e)})},t.reject=function(e){return new t(function(t,n){n(e)})},t.Mn=function(e){return new t(function(t,n){var r=0,i=0,o=!1;e.forEach(function(e){++r,e.next(function(){++i,o&&i===r&&t()},function(t){return n(t)})}),o=!0,i===r&&t()})},t.Ln=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next(function(n){return n?t.resolve(n):e()})},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach(function(t,i){r.push(e.call(n,t,i))}),this.Mn(r)},t}(),Jn=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.Bn=new Wn,this.transaction.oncomplete=function(){n.Bn.resolve()},this.transaction.onabort=function(){e.error?n.Bn.reject(new er(t,e.error)):n.Bn.resolve()},this.transaction.onerror=function(e){var r=ur(e.target.error);n.Bn.reject(new er(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(e){throw new er(n,e)}},Object.defineProperty(t.prototype,\"qn\",{get:function(){return this.Bn.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.Bn.reject(t),this.aborted||(h(\"SimpleDb\",\"Aborting transaction:\",t?t.message:\"Client-initiated abort\"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new rr(e)},t}(),$n=function(){function e(t,r,i){this.name=t,this.version=r,this.Un=i,12.2===e.Qn((0,n.getUA)())&&f(\"Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.\")}return e.delete=function(t){return h(\"SimpleDb\",\"Removing database:\",t),ir(window.indexedDB.deleteDatabase(t)).On()},e.Kn=function(){if(\"undefined\"==typeof indexedDB)return!1;if(e.Wn())return!0;var t=(0,n.getUA)(),r=e.Qn(t),i=0<r&&r<10,o=e.jn(t),u=0<o&&o<4.5;return!(t.indexOf(\"MSIE \")>0||t.indexOf(\"Trident/\")>0||t.indexOf(\"Edge/\")>0||i||u)},e.Wn=function(){var e;return void 0!==t&&\"YES\"===(null===(e=t.env)||void 0===e?void 0:e.Gn)},e.zn=function(t,e){return t.store(e)},e.Qn=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\\d_]+)/i),n=e?e[1].split(\"_\").slice(0,2).join(\".\"):\"-1\";return Number(n)},e.jn=function(t){var e=t.match(/Android ([\\d.]+)/i),n=e?e[1].split(\".\").slice(0,2).join(\".\"):\"-1\";return Number(n)},e.prototype.Hn=function(t){return(0,i.__awaiter)(this,void 0,void 0,function(){var e,n=this;return(0,i.__generator)(this,function(r){switch(r.label){case 0:return this.db?[3,2]:(h(\"SimpleDb\",\"Opening database:\",this.name),e=this,[4,new Promise(function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){var n=t.target.result;e(n)},i.onblocked=function(){r(new er(t,\"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed.\"))},i.onerror=function(e){var n=e.target.error;\"VersionError\"===n.name?r(new T(E.FAILED_PRECONDITION,\"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.\")):r(new er(t,n))},i.onupgradeneeded=function(t){h(\"SimpleDb\",'Database \"'+n.name+'\" requires upgrade from version:',t.oldVersion);var e=t.target.result;n.Un.Jn(e,i.transaction,t.oldVersion,n.version).next(function(){h(\"SimpleDb\",\"Database upgrade to version \"+n.version+\" complete\")})}})]);case 1:e.db=r.sent(),r.label=2;case 2:return[2,(this.Yn&&(this.db.onversionchange=function(t){return n.Yn(t)}),this.db)]}})})},e.prototype.Xn=function(t){this.Yn=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},e.prototype.runTransaction=function(t,e,n,r){return(0,i.__awaiter)(this,void 0,void 0,function(){var u,s,a,c,f;return(0,i.__generator)(this,function(l){switch(l.label){case 0:u=\"readonly\"===e,s=0,a=function(){var e,o,a,f,l;return(0,i.__generator)(this,function(i){switch(i.label){case 0:++s,i.label=1;case 1:return i.trys.push([1,4,,5]),[4,c.Hn(t)];case 2:return c.db=i.sent(),e=Jn.open(c.db,t,u?\"readonly\":\"readwrite\",n),o=r(e).catch(function(t){return e.abort(t),Zn.reject(t)}).On(),a={},o.catch(function(){}),[4,e.qn];case 3:return[2,(a.value=(i.sent(),o),a)];case 4:return f=i.sent(),l=\"FirebaseError\"!==f.name&&s<3,h(\"SimpleDb\",\"Transaction failed with error:\",f.message,\"Retrying:\",l),c.close(),l?[3,5]:[2,{value:Promise.reject(f)}];case 5:return[2]}})},c=this,l.label=1;case 1:return[5,a()];case 2:if(\"object\"==o(f=l.sent()))return[2,f.value];l.label=3;case 3:return[3,1];case 4:return[2]}})})},e.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},e}(),tr=function(){function t(t){this.Zn=t,this.ts=!1,this.es=null}return Object.defineProperty(t.prototype,\"xn\",{get:function(){return this.ts},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"ns\",{get:function(){return this.es},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"cursor\",{set:function(t){this.Zn=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.ts=!0},t.prototype.ss=function(t){this.es=t},t.prototype.delete=function(){return ir(this.Zn.delete())},t}(),er=function(t){function e(e,n){var r=this;return(r=t.call(this,E.UNAVAILABLE,\"IndexedDB transaction '\"+e+\"' failed: \"+n)||this).name=\"IndexedDbTransactionError\",r}return(0,i.__extends)(e,t),e}(T);function nr(t){return\"IndexedDbTransactionError\"===t.name}var rr=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(h(\"SimpleDb\",\"PUT\",this.store.name,t,e),n=this.store.put(e,t)):(h(\"SimpleDb\",\"PUT\",this.store.name,\"<auto-key>\",t),n=this.store.put(t)),ir(n)},t.prototype.add=function(t){return h(\"SimpleDb\",\"ADD\",this.store.name,t,t),ir(this.store.add(t))},t.prototype.get=function(t){var e=this;return ir(this.store.get(t)).next(function(n){return void 0===n&&(n=null),h(\"SimpleDb\",\"GET\",e.store.name,t,n),n})},t.prototype.delete=function(t){return h(\"SimpleDb\",\"DELETE\",this.store.name,t),ir(this.store.delete(t))},t.prototype.count=function(){return h(\"SimpleDb\",\"COUNT\",this.store.name),ir(this.store.count())},t.prototype.rs=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.os(n,function(t,e){r.push(e)}).next(function(){return r})},t.prototype.cs=function(t,e){h(\"SimpleDb\",\"DELETE ALL\",this.store.name);var n=this.options(t,e);n.us=!1;var r=this.cursor(n);return this.os(r,function(t,e,n){return n.delete()})},t.prototype.hs=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.os(r,e)},t.prototype.ls=function(t){var e=this.cursor({});return new Zn(function(n,r){e.onerror=function(t){var e=ur(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next(function(t){t?r.continue():n()}):n()}})},t.prototype.os=function(t,e){var n=[];return new Zn(function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new tr(i),u=e(i.primaryKey,i.value,o);if(u instanceof Zn){var s=u.catch(function(t){return o.done(),Zn.reject(t)});n.push(s)}o.xn?r():null===o.ns?i.continue():i.continue(o.ns)}else r()}}).next(function(){return Zn.Mn(n)})},t.prototype.options=function(t,e){var n;return void 0!==t&&(\"string\"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e=\"next\";if(t.reverse&&(e=\"prev\"),t.index){var n=this.store.index(t.index);return t.us?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function ir(t){return new Zn(function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){var e=ur(t.target.error);n(e)}})}var or=!1;function ur(t){var e=$n.Qn((0,n.getUA)());if(e>=12.2&&e<13){var r=\"An internal error was encountered in the Indexed Database server\";if(t.message.indexOf(r)>=0){var i=new T(\"internal\",\"IOS_INDEXEDDB_BUG1: IndexedDb has thrown '\"+r+\"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.\");return or||(or=!0,setTimeout(function(){throw i},0)),i}}return t}var sr=function(){function t(t,e,n,r,i){this._s=t,this.fs=e,this.ds=n,this.op=r,this.ws=i,this.Es=new Wn,this.then=this.Es.promise.then.bind(this.Es.promise),this.Es.promise.catch(function(t){})}return t.Ts=function(e,n,r,i,o){var u=new t(e,n,Date.now()+r,i,o);return u.start(r),u},t.prototype.start=function(t){var e=this;this.Is=setTimeout(function(){return e.As()},t)},t.prototype.Rs=function(){return this.As()},t.prototype.cancel=function(t){null!==this.Is&&(this.clearTimeout(),this.Es.reject(new T(E.CANCELLED,\"Operation cancelled\"+(t?\": \"+t:\"\"))))},t.prototype.As=function(){var t=this;this._s.Ps(function(){return null!==t.Is?(t.clearTimeout(),t.op().then(function(e){return t.Es.resolve(e)})):Promise.resolve()})},t.prototype.clearTimeout=function(){null!==this.Is&&(this.ws(this),clearTimeout(this.Is),this.Is=null)},t}();function ar(t,e){if(f(\"AsyncQueue\",e+\": \"+t),nr(t))return new T(E.UNAVAILABLE,e+\": \"+t);throw t}var cr=\"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.\",hr=function(){function t(){this.ys=[]}return t.prototype.gs=function(t){this.ys.push(t)},t.prototype.Vs=function(){this.ys.forEach(function(t){return t()})},t}();function fr(t){for(var e=\"\",n=0;n<t.length;n++)e.length>0&&(e=pr(e)),e=lr(t.get(n),e);return pr(e)}function lr(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case\"\\0\":n+=\"\u0001\u0010\";break;case\"\u0001\":n+=\"\u0001\u0011\";break;default:n+=o}}return n}function pr(t){return t+\"\u0001\u0001\"}function dr(t){var e=t.length;if(v(e>=2),2===e)return v(\"\u0001\"===t.charAt(0)&&\"\u0001\"===t.charAt(1)),R.ct();for(var n=e-2,r=[],i=\"\",o=0;o<e;){var u=t.indexOf(\"\u0001\",o);switch((u<0||u>n)&&d(),t.charAt(u+1)){case\"\u0001\":var s=t.substring(o,u),a=void 0;0===i.length?a=s:(a=i+=s,i=\"\"),r.push(a);break;case\"\u0010\":i+=t.substring(o,u),i+=\"\\0\";break;case\"\u0011\":i+=t.substring(o,u+1);break;default:d()}o=u+2}return new R(r)}var vr=function(t,e){this.seconds=t,this.nanoseconds=e},yr=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};yr.store=\"owner\",yr.key=\"owner\";var gr=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};gr.store=\"mutationQueues\",gr.keyPath=\"userId\";var mr=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};mr.store=\"mutations\",mr.keyPath=\"batchId\",mr.userMutationsIndex=\"userMutationsIndex\",mr.userMutationsKeyPath=[\"userId\",\"batchId\"];var _r=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,fr(e)]},t.key=function(t,e,n){return[t,fr(e),n]},t}();_r.store=\"documentMutations\",_r.PLACEHOLDER=new _r;var wr=function(t,e){this.path=t,this.readTime=e},br=function(t,e){this.path=t,this.version=e},Ir=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Ir.store=\"remoteDocuments\",Ir.readTimeIndex=\"readTimeIndex\",Ir.readTimeIndexPath=\"readTime\",Ir.collectionReadTimeIndex=\"collectionReadTimeIndex\",Ir.collectionReadTimeIndexPath=[\"parentPath\",\"readTime\"];var Er=function(t){this.byteSize=t};Er.store=\"remoteDocumentGlobal\",Er.key=\"remoteDocumentGlobalKey\";var Tr=function(t,e,n,r,i,o,u){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=u};Tr.store=\"targets\",Tr.keyPath=\"targetId\",Tr.queryTargetsIndexName=\"queryTargetsIndex\",Tr.queryTargetsKeyPath=[\"canonicalId\",\"targetId\"];var xr=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};xr.store=\"targetDocuments\",xr.keyPath=[\"targetId\",\"path\"],xr.documentTargetsIndex=\"documentTargetsIndex\",xr.documentTargetsKeyPath=[\"path\",\"targetId\"];var Nr=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Nr.key=\"targetGlobalKey\",Nr.store=\"targetGlobal\";var Ar=function(t,e){this.collectionId=t,this.parent=e};Ar.store=\"collectionParents\",Ar.keyPath=[\"collectionId\",\"parent\"];var Sr=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};Sr.store=\"clientMetadata\",Sr.keyPath=\"clientId\";var Dr=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};Dr.store=\"bundles\",Dr.keyPath=\"bundleId\";var kr=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};kr.store=\"namedQueries\",kr.keyPath=\"name\";var Or=(0,i.__spreadArrays)((0,i.__spreadArrays)((0,i.__spreadArrays)((0,i.__spreadArrays)([gr.store,mr.store,_r.store,Ir.store,Tr.store,yr.store,Nr.store,xr.store],[Sr.store]),[Er.store]),[Ar.store]),[Dr.store,kr.store]),Pr=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).ps=e,r.bs=n,r}return(0,i.__extends)(e,t),e}(hr);function Vr(t,e){var n=y(t);return $n.zn(n.ps,e)}var Lr=function(){function t(t,e,n,r){this.batchId=t,this.vs=e,this.baseMutations=n,this.mutations=r}return t.prototype.Ss=function(t,e,n){for(var r=n.Ds,i=0;i<this.mutations.length;i++){var o=this.mutations[i];o.key.isEqual(t)&&(e=Te(o,e,r[i]))}return e},t.prototype.Cs=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++)(u=r[n]).key.isEqual(t)&&(e=xe(u,e,this.vs));for(var i=0,o=this.mutations;i<o.length;i++){var u;(u=o[i]).key.isEqual(t)&&(e=xe(u,e,this.vs))}return e},t.prototype.xs=function(t){var e=this,n=t;return this.mutations.forEach(function(r){var i=e.Cs(r.key,t.get(r.key));i&&(n=n.zt(r.key,i))}),n},t.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},en())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&w(this.mutations,t.mutations,function(t,e){return Ae(t,e)})&&w(this.baseMutations,t.baseMutations,function(t,e){return Ae(t,e)})},t}(),Cr=function(){function t(t,e,n,r){this.batch=t,this.Ns=e,this.Ds=n,this.$s=r}return t.from=function(e,n,r){v(e.mutations.length===r.length);for(var i=$e(),o=e.mutations,u=0;u<o.length;u++)i=i.zt(o[u].key,r[u].version);return new t(e,n,r,i)},t}(),Rr=function(t){this.Fs=t};function Ur(t,e){if(e.document)return Vn(t.Fs,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=q.Et(e.noDocument.path),r=zr(e.noDocument.readTime);return new mt(n,r,{hasCommittedMutations:!!e.hasCommittedMutations})}if(e.unknownDocument){var i=q.Et(e.unknownDocument.path);return r=zr(e.unknownDocument.version),new _t(i,r)}return d()}function Mr(t,e,n){var r=qr(n),i=e.key.path.X().it();if(e instanceof gt){var o=function(t,e){return{name:Nn(t,e.key),fields:e.bt().mapValue.fields,updateTime:wn(t,e.version.j())}}(t.Fs,e),u=e.hasCommittedMutations;return new Ir(null,null,o,u,r,i)}if(e instanceof mt){var s=e.key.path.it(),a=jr(e.version);return u=e.hasCommittedMutations,new Ir(null,new wr(s,a),null,u,r,i)}if(e instanceof _t){var c=e.key.path.it(),h=jr(e.version);return new Ir(new br(c,h),null,null,!0,r,i)}return d()}function qr(t){var e=t.j();return[e.seconds,e.nanoseconds]}function Fr(t){var e=new V(t[0],t[1]);return L.K(e)}function jr(t){var e=t.j();return new vr(e.seconds,e.nanoseconds)}function zr(t){var e=new V(t.seconds,t.nanoseconds);return L.K(e)}function Gr(t,e){for(var n=(e.baseMutations||[]).map(function(e){return Cn(t.Fs,e)}),r=0;r<e.mutations.length-1;++r){var i=e.mutations[r];if(r+1<e.mutations.length&&void 0!==e.mutations[r+1].transform){var o=e.mutations[r+1];i.updateTransforms=o.transform.fieldTransforms,e.mutations.splice(r+1,1),++r}}var u=e.mutations.map(function(e){return Cn(t.Fs,e)}),s=V.fromMillis(e.localWriteTimeMs);return new Lr(e.batchId,s,n,u)}function Br(t){var e,n,r=zr(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?zr(t.lastLimboFreeSnapshotVersion):L.min();return void 0!==t.query.documents?(v(1===(n=t.query).documents.length),e=Xt(zt(Dn(n.documents[0])))):e=function(t){return Xt(Mn(t))}(t.query),new re(e,t.targetId,0,t.lastListenSequenceNumber,r,i,I.fromBase64String(t.resumeToken))}function Qr(t,e){var n,r=jr(e.Ot),i=jr(e.lastLimboFreeSnapshotVersion);n=Tt(e.target)?Rn(t.Fs,e.target):Un(t.Fs,e.target);var o=e.resumeToken.toBase64();return new Tr(e.targetId,It(e.target),r,o,e.sequenceNumber,i,n)}function Yr(t){var e=Mn({parent:t.parent,structuredQuery:t.structuredQuery});return\"LAST\"===t.limitType?Wt(e,e.limit,\"L\"):e}var Hr=function(){function t(){}return t.prototype.Os=function(t,e){return Kr(t).get(e).next(function(t){if(t)return{id:(e=t).bundleId,createTime:zr(e.createTime),version:e.version};var e})},t.prototype.ks=function(t,e){return Kr(t).put({bundleId:(n=e).id,createTime:jr(En(n.createTime)),version:n.version});var n},t.prototype.Ms=function(t,e){return Xr(t).get(e).next(function(t){if(t)return{name:(e=t).name,query:Yr(e.bundledQuery),readTime:zr(e.readTime)};var e})},t.prototype.Ls=function(t,e){return Xr(t).put(function(t){return{name:t.name,readTime:jr(En(t.readTime)),bundledQuery:t.bundledQuery}}(e))},t}();function Kr(t){return Vr(t,Dr.store)}function Xr(t){return Vr(t,kr.store)}var Wr=function(){function t(){this.Bs=new Zr}return t.prototype.qs=function(t,e){return this.Bs.add(e),Zn.resolve()},t.prototype.Us=function(t,e){return Zn.resolve(this.Bs.getEntries(e))},t}(),Zr=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.tt(),n=t.X(),r=this.index[e]||new Qe(R.H),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.tt(),n=t.X(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new Qe(R.H)).it()},t}(),Jr=function(){function t(){this.Qs=new Zr}return t.prototype.qs=function(t,e){var n=this;if(!this.Qs.has(e)){var r=e.tt(),i=e.X();t.gs(function(){n.Qs.add(e)});var o={collectionId:r,parent:fr(i)};return $r(t).put(o)}return Zn.resolve()},t.prototype.Us=function(t,e){var n=[],r=IDBKeyRange.bound([e,\"\"],[b(e),\"\"],!1,!0);return $r(t).rs(r).next(function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(dr(o.parent))}return n})},t}();function $r(t){return Vr(t,Ar.store)}var ti={Ks:!1,Ws:0,js:0,Gs:0},ei=function(){function t(t,e,n){this.zs=t,this.Hs=e,this.Js=n}return t.Ys=function(e){return new t(e,t.Xs,t.Zs)},t}();function ni(t){return(0,i.__awaiter)(this,void 0,void 0,function(){return(0,i.__generator)(this,function(e){if(t.code!==E.FAILED_PRECONDITION||t.message!==cr)throw t;return h(\"LocalStore\",\"Unexpectedly lost primary lease\"),[2]})})}ei.Xs=10,ei.Zs=1e3,ei.ti=new ei(41943040,ei.Xs,ei.Zs),ei.ei=new ei(-1,0,0);var ri=function(){function t(t,e){this.ni=t,this.si=e,this.ii={}}return t.prototype.get=function(t){var e=this.ni(t),n=this.ii[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],u=o[0],s=o[1];if(this.si(u,t))return s}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.ni(t),r=this.ii[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.si(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.ii[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.ni(t),n=this.ii[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.si(n[r][0],t))return 1===n.length?delete this.ii[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){j(this.ii,function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],u=o[0],s=o[1];t(u,s)}})},t.prototype.et=function(){return z(this.ii)},t}(),ii=function(){function t(){this.ri=new ri(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.oi=!1}return t.prototype.ci=function(t){var e=this.ri.get(t);return e?e.readTime:L.min()},t.prototype.ai=function(t,e){this.ui(),this.ri.set(t.key,{hi:t,readTime:e})},t.prototype.li=function(t,e){void 0===e&&(e=null),this.ui(),this.ri.set(t,{hi:null,readTime:e})},t.prototype._i=function(t,e){this.ui();var n=this.ri.get(e);return void 0!==n?Zn.resolve(n.hi):this.fi(t,e)},t.prototype.getEntries=function(t,e){return this.di(t,e)},t.prototype.apply=function(t){return this.ui(),this.oi=!0,this.wi(t)},t.prototype.ui=function(){},t}();function oi(t,e,n){var r=t.store(mr.store),i=t.store(_r.store),o=[],u=IDBKeyRange.only(n.batchId),s=0,a=r.hs({range:u},function(t,e,n){return s++,n.delete()});o.push(a.next(function(){v(1===s)}));for(var c=[],h=0,f=n.mutations;h<f.length;h++){var l=f[h],p=_r.key(e,l.key.path,n.batchId);o.push(i.delete(p)),c.push(l.key)}return Zn.Mn(o).next(function(){return c})}function ui(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw d();e=t.noDocument}return JSON.stringify(e).length}var si=function(){function t(t,e,n,r){this.userId=t,this.Qt=e,this.Ei=n,this.Ti=r,this.Ii={}}return t.mi=function(e,n,r,i){return v(\"\"!==e.uid),new t(e.m()?e.uid:\"\",n,r,i)},t.prototype.Ai=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ci(t).hs({index:mr.userMutationsIndex,range:n},function(t,n,r){e=!1,r.done()}).next(function(){return e})},t.prototype.Ri=function(t,e,n,r){var i=this,o=hi(t),u=ci(t);return u.add({}).next(function(s){v(\"number\"==typeof s);for(var a=new Lr(s,e,n,r),c=function(t,e,n){var r=n.baseMutations.map(function(e){return Ln(t.Fs,e)}),i=n.mutations.map(function(e){return Ln(t.Fs,e)});return new mr(e,n.batchId,n.vs.toMillis(),r,i)}(i.Qt,i.userId,a),h=[],f=new Qe(function(t,e){return _(t.rt(),e.rt())}),l=0,p=r;l<p.length;l++){var d=p[l],y=_r.key(i.userId,d.key.path,s);f=f.add(d.key.path.X()),h.push(u.put(c)),h.push(o.put(y,_r.PLACEHOLDER))}return f.forEach(function(e){h.push(i.Ei.qs(t,e))}),t.gs(function(){i.Ii[s]=a.keys()}),Zn.Mn(h).next(function(){return a})})},t.prototype.Pi=function(t,e){var n=this;return ci(t).get(e).next(function(t){return t?(v(t.userId===n.userId),Gr(n.Qt,t)):null})},t.prototype.yi=function(t,e){var n=this;return this.Ii[e]?Zn.resolve(this.Ii[e]):this.Pi(t,e).next(function(t){if(t){var r=t.keys();return n.Ii[e]=r,r}return null})},t.prototype.gi=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return ci(t).hs({index:mr.userMutationsIndex,range:i},function(t,e,i){e.userId===n.userId&&(v(e.batchId>=r),o=Gr(n.Qt,e)),i.done()}).next(function(){return o})},t.prototype.Vi=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return ci(t).hs({index:mr.userMutationsIndex,range:e,reverse:!0},function(t,e,r){n=e.batchId,r.done()}).next(function(){return n})},t.prototype.pi=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ci(t).rs(mr.userMutationsIndex,n).next(function(t){return t.map(function(t){return Gr(e.Qt,t)})})},t.prototype.bi=function(t,e){var n=this,r=_r.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return hi(t).hs({range:i},function(r,i,u){var s=r[0],a=r[1],c=r[2],h=dr(a);if(s===n.userId&&e.path.isEqual(h))return ci(t).get(c).next(function(t){if(!t)throw d();v(t.userId===n.userId),o.push(Gr(n.Qt,t))});u.done()}).next(function(){return o})},t.prototype.vi=function(t,e){var n=this,r=new Qe(_),i=[];return e.forEach(function(e){var o=_r.prefixForPath(n.userId,e.path),u=IDBKeyRange.lowerBound(o),s=hi(t).hs({range:u},function(t,i,o){var u=t[0],s=t[1],a=t[2],c=dr(s);u===n.userId&&e.path.isEqual(c)?r=r.add(a):o.done()});i.push(s)}),Zn.Mn(i).next(function(){return n.Si(t,r)})},t.prototype.Di=function(t,e){var n=this,r=e.path,i=r.length+1,o=_r.prefixForPath(this.userId,r),u=IDBKeyRange.lowerBound(o),s=new Qe(_);return hi(t).hs({range:u},function(t,e,o){var u=t[0],a=t[1],c=t[2],h=dr(a);u===n.userId&&r.nt(h)?h.length===i&&(s=s.add(c)):o.done()}).next(function(){return n.Si(t,s)})},t.prototype.Si=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(ci(t).get(e).next(function(t){if(null===t)throw d();v(t.userId===n.userId),r.push(Gr(n.Qt,t))}))}),Zn.Mn(i).next(function(){return r})},t.prototype.Ci=function(t,e){var n=this;return oi(t.ps,this.userId,e).next(function(r){return t.gs(function(){n.xi(e.batchId)}),Zn.forEach(r,function(e){return n.Ti.Ni(t,e)})})},t.prototype.xi=function(t){delete this.Ii[t]},t.prototype.$i=function(t){var e=this;return this.Ai(t).next(function(n){if(!n)return Zn.resolve();var r=IDBKeyRange.lowerBound(_r.prefixForUser(e.userId)),i=[];return hi(t).hs({range:r},function(t,n,r){if(t[0]===e.userId){var o=dr(t[1]);i.push(o)}else r.done()}).next(function(){v(0===i.length)})})},t.prototype.Fi=function(t,e){return ai(t,this.userId,e)},t.prototype.Oi=function(t){var e=this;return fi(t).get(this.userId).next(function(t){return t||new gr(e.userId,-1,\"\")})},t}();function ai(t,e,n){var r=_r.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),u=!1;return hi(t).hs({range:o,us:!0},function(t,n,r){var o=t[0],s=t[1];t[2],o===e&&s===i&&(u=!0),r.done()}).next(function(){return u})}function ci(t){return Vr(t,mr.store)}function hi(t){return Vr(t,_r.store)}function fi(t){return Vr(t,gr.store)}var li=function(){function t(t){this.ki=t}return t.prototype.next=function(){return this.ki+=2,this.ki},t.Mi=function(){return new t(0)},t.Li=function(){return new t(-1)},t}(),pi=function(){function t(t,e){this.Ti=t,this.Qt=e}return t.prototype.Bi=function(t){var e=this;return this.qi(t).next(function(n){var r=new li(n.highestTargetId);return n.highestTargetId=r.next(),e.Ui(t,n).next(function(){return n.highestTargetId})})},t.prototype.Qi=function(t){return this.qi(t).next(function(t){return L.K(new V(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},t.prototype.Ki=function(t){return this.qi(t).next(function(t){return t.highestListenSequenceNumber})},t.prototype.Wi=function(t,e,n){var r=this;return this.qi(t).next(function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.j()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Ui(t,i)})},t.prototype.ji=function(t,e){var n=this;return this.Gi(t,e).next(function(){return n.qi(t).next(function(r){return r.targetCount+=1,n.zi(e,r),n.Ui(t,r)})})},t.prototype.Hi=function(t,e){return this.Gi(t,e)},t.prototype.Ji=function(t,e){var n=this;return this.Yi(t,e.targetId).next(function(){return di(t).delete(e.targetId)}).next(function(){return n.qi(t)}).next(function(e){return v(e.targetCount>0),e.targetCount-=1,n.Ui(t,e)})},t.prototype.Xi=function(t,e,n){var r=this,i=0,o=[];return di(t).hs(function(u,s){var a=Br(s);a.sequenceNumber<=e&&null===n.get(a.targetId)&&(i++,o.push(r.Ji(t,a)))}).next(function(){return Zn.Mn(o)}).next(function(){return i})},t.prototype.In=function(t,e){return di(t).hs(function(t,n){var r=Br(n);e(r)})},t.prototype.qi=function(t){return vi(t).get(Nr.key).next(function(t){return v(null!==t),t})},t.prototype.Ui=function(t,e){return vi(t).put(Nr.key,e)},t.prototype.Gi=function(t,e){return di(t).put(Qr(this.Qt,e))},t.prototype.zi=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.Zi=function(t){return this.qi(t).next(function(t){return t.targetCount})},t.prototype.tr=function(t,e){var n=It(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return di(t).hs({range:r,index:Tr.queryTargetsIndexName},function(t,n,r){var o=Br(n);Et(e,o.target)&&(i=o,r.done())}).next(function(){return i})},t.prototype.er=function(t,e,n){var r=this,i=[],o=yi(t);return e.forEach(function(e){var u=fr(e.path);i.push(o.put(new xr(n,u))),i.push(r.Ti.nr(t,n,e))}),Zn.Mn(i)},t.prototype.sr=function(t,e,n){var r=this,i=yi(t);return Zn.forEach(e,function(e){var o=fr(e.path);return Zn.Mn([i.delete([n,o]),r.Ti.ir(t,n,e)])})},t.prototype.Yi=function(t,e){var n=yi(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.rr=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=yi(t),i=en();return r.hs({range:n,us:!0},function(t,e,n){var r=dr(t[1]),o=new q(r);i=i.add(o)}).next(function(){return i})},t.prototype.Fi=function(t,e){var n=fr(e.path),r=IDBKeyRange.bound([n],[b(n)],!1,!0),i=0;return yi(t).hs({index:xr.documentTargetsIndex,us:!0,range:r},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return i>0})},t.prototype.Sn=function(t,e){return di(t).get(e).next(function(t){return t?Br(t):null})},t}();function di(t){return Vr(t,Tr.store)}function vi(t){return Vr(t,Nr.store)}function yi(t){return Vr(t,xr.store)}function gi(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],u=_(n,i);return 0===u?_(r,o):u}var mi=function(){function t(t){this.cr=t,this.buffer=new Qe(gi),this.ar=0}return t.prototype.ur=function(){return++this.ar},t.prototype.hr=function(t){var e=[t,this.ur()];if(this.buffer.size<this.cr)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();gi(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,\"maxValue\",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),_i=function(){function t(t,e){this.lr=t,this._s=e,this._r=!1,this.dr=null}return t.prototype.start=function(t){-1!==this.lr.params.zs&&this.wr(t)},t.prototype.stop=function(){this.dr&&(this.dr.cancel(),this.dr=null)},Object.defineProperty(t.prototype,\"Er\",{get:function(){return null!==this.dr},enumerable:!1,configurable:!0}),t.prototype.wr=function(t){var e=this,n=this._r?3e5:6e4;h(\"LruGarbageCollector\",\"Garbage collection scheduled in \"+n+\"ms\"),this.dr=this._s.Tr(\"lru_garbage_collection\",n,function(){return(0,i.__awaiter)(e,void 0,void 0,function(){var e;return(0,i.__generator)(this,function(n){switch(n.label){case 0:this.dr=null,this._r=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.Ir(this.lr)];case 2:return n.sent(),[3,7];case 3:return nr(e=n.sent())?(h(\"LruGarbageCollector\",\"Ignoring IndexedDB error during garbage collection: \",e),[3,6]):[3,4];case 4:return[4,ni(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.wr(t)];case 8:return n.sent(),[2]}})})})},t}(),wi=function(){function t(t,e){this.mr=t,this.params=e}return t.prototype.Ar=function(t,e){return this.mr.Rr(t).next(function(t){return Math.floor(e/100*t)})},t.prototype.Pr=function(t,e){var n=this;if(0===e)return Zn.resolve(P.q);var r=new mi(e);return this.mr.In(t,function(t){return r.hr(t.sequenceNumber)}).next(function(){return n.mr.yr(t,function(t){return r.hr(t)})}).next(function(){return r.maxValue})},t.prototype.Xi=function(t,e,n){return this.mr.Xi(t,e,n)},t.prototype.gr=function(t,e){return this.mr.gr(t,e)},t.prototype.Vr=function(t,e){var n=this;return-1===this.params.zs?(h(\"LruGarbageCollector\",\"Garbage collection skipped; disabled\"),Zn.resolve(ti)):this.pr(t).next(function(r){return r<n.params.zs?(h(\"LruGarbageCollector\",\"Garbage collection skipped; Cache size \"+r+\" is lower than threshold \"+n.params.zs),ti):n.br(t,e)})},t.prototype.pr=function(t){return this.mr.pr(t)},t.prototype.br=function(t,n){var r,i,o,u,s,a,f,l=this,p=Date.now();return this.Ar(t,this.params.Hs).next(function(e){return e>l.params.Js?(h(\"LruGarbageCollector\",\"Capping sequence numbers to collect down to the maximum of \"+l.params.Js+\" from \"+e),i=l.params.Js):i=e,u=Date.now(),l.Pr(t,i)}).next(function(e){return r=e,s=Date.now(),l.Xi(t,r,n)}).next(function(e){return o=e,a=Date.now(),l.gr(t,r)}).next(function(t){return f=Date.now(),c()<=e.LogLevel.DEBUG&&h(\"LruGarbageCollector\",\"LRU Garbage Collection\\n\\tCounted targets in \"+(u-p)+\"ms\\n\\tDetermined least recently used \"+i+\" in \"+(s-u)+\"ms\\n\\tRemoved \"+o+\" targets in \"+(a-s)+\"ms\\n\\tRemoved \"+t+\" documents in \"+(f-a)+\"ms\\nTotal Duration: \"+(f-p)+\"ms\"),Zn.resolve({Ks:!0,Ws:i,js:o,Gs:t})})},t}(),bi=function(){function t(t,e){this.db=t,this.lr=function(t,e){return new wi(t,e)}(this,e)}return t.prototype.Rr=function(t){var e=this.vr(t);return this.db.Sr().Zi(t).next(function(t){return e.next(function(e){return t+e})})},t.prototype.vr=function(t){var e=0;return this.yr(t,function(t){e++}).next(function(){return e})},t.prototype.In=function(t,e){return this.db.Sr().In(t,e)},t.prototype.yr=function(t,e){return this.Dr(t,function(t,n){return e(n)})},t.prototype.nr=function(t,e,n){return Ii(t,n)},t.prototype.ir=function(t,e,n){return Ii(t,n)},t.prototype.Xi=function(t,e,n){return this.db.Sr().Xi(t,e,n)},t.prototype.Ni=function(t,e){return Ii(t,e)},t.prototype.Cr=function(t,e){return function(t,e){var n=!1;return fi(t).ls(function(r){return ai(t,r,e).next(function(t){return t&&(n=!0),Zn.resolve(!t)})}).next(function(){return n})}(t,e)},t.prototype.gr=function(t,e){var n=this,r=this.db.$r().Nr(),i=[],o=0;return this.Dr(t,function(u,s){if(s<=e){var a=n.Cr(t,u).next(function(e){if(!e)return o++,r._i(t,u).next(function(){return r.li(u),yi(t).delete([0,fr(u.path)])})});i.push(a)}}).next(function(){return Zn.Mn(i)}).next(function(){return r.apply(t)}).next(function(){return o})},t.prototype.removeTarget=function(t,e){var n=e.kt(t.bs);return this.db.Sr().Hi(t,n)},t.prototype.Fr=function(t,e){return Ii(t,e)},t.prototype.Dr=function(t,e){var n,r=yi(t),i=P.q;return r.hs({index:xr.documentTargetsIndex},function(t,r){var o=t[0],u=(t[1],r.path),s=r.sequenceNumber;0===o?(i!==P.q&&e(new q(dr(n)),i),i=s,n=u):i=P.q}).next(function(){i!==P.q&&e(new q(dr(n)),i)})},t.prototype.pr=function(t){return this.db.$r().Or(t)},t}();function Ii(t,e){return yi(t).put(function(t,e){return new xr(0,fr(t.path),e)}(e,t.bs))}var Ei=function(){function t(t,e){this.Qt=t,this.Ei=e}return t.prototype.ai=function(t,e,n){return Ni(t).put(Ai(e),n)},t.prototype.li=function(t,e){var n=Ni(t),r=Ai(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next(function(r){return r.byteSize+=e,n.kr(t,r)})},t.prototype._i=function(t,e){var n=this;return Ni(t).get(Ai(e)).next(function(t){return n.Mr(t)})},t.prototype.Lr=function(t,e){var n=this;return Ni(t).get(Ai(e)).next(function(t){var e=n.Mr(t);return e?{hi:e,size:ui(t)}:null})},t.prototype.getEntries=function(t,e){var n=this,r=Xe();return this.Br(t,e,function(t,e){var i=n.Mr(e);r=r.zt(t,i)}).next(function(){return r})},t.prototype.qr=function(t,e){var n=this,r=Xe(),i=new ze(q.H);return this.Br(t,e,function(t,e){var o=n.Mr(e);o?(r=r.zt(t,o),i=i.zt(t,ui(e))):(r=r.zt(t,null),i=i.zt(t,0))}).next(function(){return{Ur:r,Qr:i}})},t.prototype.Br=function(t,e,n){if(e.et())return Zn.resolve();var r=IDBKeyRange.bound(e.first().path.it(),e.last().path.it()),i=e.te(),o=i.oe();return Ni(t).hs({range:r},function(t,e,r){for(var u=q.Et(t);o&&q.H(o,u)<0;)n(o,null),o=i.oe();o&&o.isEqual(u)&&(n(o,e),o=i.ce()?i.oe():null),o?r.ss(o.path.it()):r.done()}).next(function(){for(;o;)n(o,null),o=i.ce()?i.oe():null})},t.prototype.Kr=function(t,e,n){var r=this,i=Ze(),o=e.path.length+1,u={};if(n.isEqual(L.min())){var s=e.path.it();u.range=IDBKeyRange.lowerBound(s)}else{var a=e.path.it(),c=qr(n);u.range=IDBKeyRange.lowerBound([a,c],!0),u.index=Ir.collectionReadTimeIndex}return Ni(t).hs(u,function(t,n,u){if(t.length===o){var s=Ur(r.Qt,n);e.path.nt(s.key.path)?s instanceof gt&&te(e,s)&&(i=i.zt(s.key,s)):u.done()}}).next(function(){return i})},t.prototype.Nr=function(t){return new Ti(this,!!t&&t.Wr)},t.prototype.Or=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},t.prototype.getMetadata=function(t){return xi(t).get(Er.key).next(function(t){return v(!!t),t})},t.prototype.kr=function(t,e){return xi(t).put(Er.key,e)},t.prototype.Mr=function(t){if(t){var e=Ur(this.Qt,t);return e instanceof mt&&e.version.isEqual(L.min())?null:e}return null},t}(),Ti=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).jr=e,r.Wr=n,r.Gr=new ri(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),r}return(0,i.__extends)(e,t),e.prototype.wi=function(t){var e=this,n=[],r=0,i=new Qe(function(t,e){return _(t.rt(),e.rt())});return this.ri.forEach(function(o,u){var s=e.Gr.get(o);if(u.hi){var a=Mr(e.jr.Qt,u.hi,e.ci(o));i=i.add(o.path.X());var c=ui(a);r+=c-s,n.push(e.jr.ai(t,o,a))}else if(r-=s,e.Wr){var h=Mr(e.jr.Qt,new mt(o,L.min()),e.ci(o));n.push(e.jr.ai(t,o,h))}else n.push(e.jr.li(t,o))}),i.forEach(function(r){n.push(e.jr.Ei.qs(t,r))}),n.push(this.jr.updateMetadata(t,r)),Zn.Mn(n)},e.prototype.fi=function(t,e){var n=this;return this.jr.Lr(t,e).next(function(t){return null===t?(n.Gr.set(e,0),null):(n.Gr.set(e,t.size),t.hi)})},e.prototype.di=function(t,e){var n=this;return this.jr.qr(t,e).next(function(t){var e=t.Ur;return t.Qr.forEach(function(t,e){n.Gr.set(t,e)}),e})},e}(ii);function xi(t){return Vr(t,Er.store)}function Ni(t){return Vr(t,Ir.store)}function Ai(t){return t.path.it()}var Si=function(){function t(t){this.Qt=t}return t.prototype.Jn=function(t,e,n,r){var i=this;v(n<r&&n>=0&&r<=11);var o=new Jn(\"createOrUpgrade\",e);n<1&&r>=1&&(function(t){t.createObjectStore(yr.store)}(t),function(t){t.createObjectStore(gr.store,{keyPath:gr.keyPath}),t.createObjectStore(mr.store,{keyPath:mr.keyPath,autoIncrement:!0}).createIndex(mr.userMutationsIndex,mr.userMutationsKeyPath,{unique:!0}),t.createObjectStore(_r.store)}(t),Di(t),function(t){t.createObjectStore(Ir.store)}(t));var u=Zn.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(xr.store),t.deleteObjectStore(Tr.store),t.deleteObjectStore(Nr.store)}(t),Di(t)),u=u.next(function(){return t=o.store(Nr.store),e=new Nr(0,0,L.min().j(),0),t.put(Nr.key,e);var t,e})),n<4&&r>=4&&(0!==n&&(u=u.next(function(){return function(t,e){return e.store(mr.store).rs().next(function(n){t.deleteObjectStore(mr.store),t.createObjectStore(mr.store,{keyPath:mr.keyPath,autoIncrement:!0}).createIndex(mr.userMutationsIndex,mr.userMutationsKeyPath,{unique:!0});var r=e.store(mr.store),i=n.map(function(t){return r.put(t)});return Zn.Mn(i)})}(t,o)})),u=u.next(function(){!function(t){t.createObjectStore(Sr.store,{keyPath:Sr.keyPath})}(t)})),n<5&&r>=5&&(u=u.next(function(){return i.zr(o)})),n<6&&r>=6&&(u=u.next(function(){return function(t){t.createObjectStore(Er.store)}(t),i.Hr(o)})),n<7&&r>=7&&(u=u.next(function(){return i.Jr(o)})),n<8&&r>=8&&(u=u.next(function(){return i.Yr(t,o)})),n<9&&r>=9&&(u=u.next(function(){!function(t){t.objectStoreNames.contains(\"remoteDocumentChanges\")&&t.deleteObjectStore(\"remoteDocumentChanges\")}(t),function(t){var e=t.objectStore(Ir.store);e.createIndex(Ir.readTimeIndex,Ir.readTimeIndexPath,{unique:!1}),e.createIndex(Ir.collectionReadTimeIndex,Ir.collectionReadTimeIndexPath,{unique:!1})}(e)})),n<10&&r>=10&&(u=u.next(function(){return i.Xr(o)})),n<11&&r>=11&&(u=u.next(function(){!function(t){t.createObjectStore(Dr.store,{keyPath:Dr.keyPath})}(t),function(t){t.createObjectStore(kr.store,{keyPath:kr.keyPath})}(t)})),u},t.prototype.Hr=function(t){var e=0;return t.store(Ir.store).hs(function(t,n){e+=ui(n)}).next(function(){var n=new Er(e);return t.store(Er.store).put(Er.key,n)})},t.prototype.zr=function(t){var e=this,n=t.store(gr.store),r=t.store(mr.store);return n.rs().next(function(n){return Zn.forEach(n,function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.rs(mr.userMutationsIndex,i).next(function(r){return Zn.forEach(r,function(r){v(r.userId===n.userId);var i=Gr(e.Qt,r);return oi(t,n.userId,i).next(function(){})})})})})},t.prototype.Jr=function(t){var e=t.store(xr.store),n=t.store(Ir.store);return t.store(Nr.store).get(Nr.key).next(function(t){var r=[];return n.hs(function(n,i){var o=new R(n),u=[0,fr(o)];r.push(e.get(u).next(function(n){return n?Zn.resolve():function(n){return e.put(new xr(0,fr(n),t.highestListenSequenceNumber))}(o)}))}).next(function(){return Zn.Mn(r)})})},t.prototype.Yr=function(t,e){t.createObjectStore(Ar.store,{keyPath:Ar.keyPath});var n=e.store(Ar.store),r=new Zr,i=function(t){if(r.add(t)){var e=t.tt(),i=t.X();return n.put({collectionId:e,parent:fr(i)})}};return e.store(Ir.store).hs({us:!0},function(t,e){var n=new R(t);return i(n.X())}).next(function(){return e.store(_r.store).hs({us:!0},function(t,e){t[0];var n=t[1],r=(t[2],dr(n));return i(r.X())})})},t.prototype.Xr=function(t){var e=this,n=t.store(Tr.store);return n.hs(function(t,r){var i=Br(r),o=Qr(e.Qt,i);return n.put(o)})},t}();function Di(t){t.createObjectStore(xr.store,{keyPath:xr.keyPath}).createIndex(xr.documentTargetsIndex,xr.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Tr.store,{keyPath:Tr.keyPath}).createIndex(Tr.queryTargetsIndexName,Tr.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Nr.store)}var ki=\"Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.\",Oi=function(){function t(e,n,r,i,o,u,s,a,c,h){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Zr=o,this.window=u,this.document=s,this.eo=c,this.no=h,this.so=null,this.io=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ro=null,this.inForeground=!1,this.oo=null,this.co=null,this.ao=Number.NEGATIVE_INFINITY,this.uo=function(t){return Promise.resolve()},!t.Kn())throw new T(E.UNIMPLEMENTED,\"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.\");this.Ti=new bi(this,i),this.ho=n+\"main\",this.Qt=new Rr(a),this.lo=new $n(this.ho,11,new Si(this.Qt)),this._o=new pi(this.Ti,this.Qt),this.Ei=new Jr,this.fo=function(t,e){return new Ei(t,e)}(this.Qt,this.Ei),this.wo=new Hr,this.window&&this.window.localStorage?this.Eo=this.window.localStorage:(this.Eo=null,!1===h&&f(\"IndexedDbPersistence\",\"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page.\"))}return t.prototype.start=function(){var t=this;return this.To().then(function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new T(E.FAILED_PRECONDITION,ki);return t.Io(),t.mo(),t.Ao(),t.runTransaction(\"getHighestListenSequenceNumber\",\"readonly\",function(e){return t._o.Ki(e)})}).then(function(e){t.so=new P(e,t.eo)}).then(function(){t.io=!0}).catch(function(e){return t.lo&&t.lo.close(),Promise.reject(e)})},t.prototype.Ro=function(t){var e=this;return this.uo=function(n){return(0,i.__awaiter)(e,void 0,void 0,function(){return(0,i.__generator)(this,function(e){return this.Er?[2,t(n)]:[2]})})},t(this.isPrimary)},t.prototype.Po=function(t){var e=this;this.lo.Xn(function(n){return(0,i.__awaiter)(e,void 0,void 0,function(){return(0,i.__generator)(this,function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})})},t.prototype.yo=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Zr.Ps(function(){return(0,i.__awaiter)(e,void 0,void 0,function(){return(0,i.__generator)(this,function(t){switch(t.label){case 0:return this.Er?[4,this.To()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},t.prototype.To=function(){var t=this;return this.runTransaction(\"updateClientMetadataAndTryBecomePrimary\",\"readwrite\",function(e){return Vi(e).put(new Sr(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next(function(){if(t.isPrimary)return t.Vo(e).next(function(e){e||(t.isPrimary=!1,t.Zr.po(function(){return t.uo(!1)}))})}).next(function(){return t.bo(e)}).next(function(n){return t.isPrimary&&!n?t.vo(e).next(function(){return!1}):!!n&&t.So(e).next(function(){return!0})})}).catch(function(e){if(nr(e))return h(\"IndexedDbPersistence\",\"Failed to extend owner lease: \",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return h(\"IndexedDbPersistence\",\"Releasing owner lease after error during lease refresh\",e),!1}).then(function(e){t.isPrimary!==e&&t.Zr.po(function(){return t.uo(e)}),t.isPrimary=e})},t.prototype.Vo=function(t){var e=this;return Pi(t).get(yr.key).next(function(t){return Zn.resolve(e.Do(t))})},t.prototype.Co=function(t){return Vi(t).delete(this.clientId)},t.prototype.xo=function(){return(0,i.__awaiter)(this,void 0,void 0,function(){var t,e,n,r,o=this;return(0,i.__generator)(this,function(i){switch(i.label){case 0:return!this.isPrimary||this.No(this.ao,18e5)?[3,2]:(this.ao=Date.now(),[4,this.runTransaction(\"maybeGarbageCollectMultiClientState\",\"readwrite-primary\",function(t){var e=Vr(t,Sr.store);return e.rs().next(function(t){var n=o.$o(t,18e5),r=t.filter(function(t){return-1===n.indexOf(t)});return Zn.forEach(r,function(t){return e.delete(t.clientId)}).next(function(){return r})})}).catch(function(){return[]})]);case 1:if(t=i.sent(),this.Eo)for(e=0,n=t;e<n.length;e++)r=n[e],this.Eo.removeItem(this.Fo(r.clientId));i.label=2;case 2:return[2]}})})},t.prototype.Ao=function(){var t=this;this.co=this.Zr.Tr(\"client_metadata_refresh\",4e3,function(){return t.To().then(function(){return t.xo()}).then(function(){return t.Ao()})})},t.prototype.Do=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.bo=function(t){var e=this;return this.no?Zn.resolve(!0):Pi(t).get(yr.key).next(function(n){if(null!==n&&e.No(n.leaseTimestampMs,5e3)&&!e.Oo(n.ownerId)){if(e.Do(n)&&e.networkEnabled)return!0;if(!e.Do(n)){if(!n.allowTabSynchronization)throw new T(E.FAILED_PRECONDITION,ki);return!1}}return!(!e.networkEnabled||!e.inForeground)||Vi(t).rs().next(function(t){return void 0===e.$o(t,5e3).find(function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1})})}).next(function(t){return e.isPrimary!==t&&h(\"IndexedDbPersistence\",\"Client \"+(t?\"is\":\"is not\")+\" eligible for a primary lease.\"),t})},t.prototype.ko=function(){return(0,i.__awaiter)(this,void 0,void 0,function(){var t=this;return(0,i.__generator)(this,function(e){switch(e.label){case 0:return this.io=!1,this.Mo(),this.co&&(this.co.cancel(),this.co=null),this.Lo(),this.Bo(),[4,this.lo.runTransaction(\"shutdown\",\"readwrite\",[yr.store,Sr.store],function(e){var n=new Pr(e,P.q);return t.vo(n).next(function(){return t.Co(n)})})];case 1:return e.sent(),this.lo.close(),this.qo(),[2]}})})},t.prototype.$o=function(t,e){var n=this;return t.filter(function(t){return n.No(t.updateTimeMs,e)&&!n.Oo(t.clientId)})},t.prototype.Uo=function(){var t=this;return this.runTransaction(\"getActiveClients\",\"readonly\",function(e){return Vi(e).rs().next(function(e){return t.$o(e,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(t.prototype,\"Er\",{get:function(){return this.io},enumerable:!1,configurable:!0}),t.prototype.Qo=function(t){return si.mi(t,this.Qt,this.Ei,this.Ti)},t.prototype.Sr=function(){return this._o},t.prototype.$r=function(){return this.fo},t.prototype.Ko=function(){return this.Ei},t.prototype.Wo=function(){return this.wo},t.prototype.runTransaction=function(t,e,n){var r=this;h(\"IndexedDbPersistence\",\"Starting transaction:\",t);var i,o=\"readonly\"===e?\"readonly\":\"readwrite\";return this.lo.runTransaction(t,o,Or,function(o){return i=new Pr(o,r.so?r.so.next():P.q),\"readwrite-primary\"===e?r.Vo(i).next(function(t){return!!t||r.bo(i)}).next(function(e){if(!e)throw f(\"Failed to obtain primary lease for action '\"+t+\"'.\"),r.isPrimary=!1,r.Zr.po(function(){return r.uo(!1)}),new T(E.FAILED_PRECONDITION,cr);return n(i)}).next(function(t){return r.So(i).next(function(){return t})}):r.jo(i).next(function(){return n(i)})}).then(function(t){return i.Vs(),t})},t.prototype.jo=function(t){var e=this;return Pi(t).get(yr.key).next(function(t){if(null!==t&&e.No(t.leaseTimestampMs,5e3)&&!e.Oo(t.ownerId)&&!e.Do(t)&&!(e.no||e.allowTabSynchronization&&t.allowTabSynchronization))throw new T(E.FAILED_PRECONDITION,ki)})},t.prototype.So=function(t){var e=new yr(this.clientId,this.allowTabSynchronization,Date.now());return Pi(t).put(yr.key,e)},t.Kn=function(){return $n.Kn()},t.prototype.vo=function(t){var e=this,n=Pi(t);return n.get(yr.key).next(function(t){return e.Do(t)?(h(\"IndexedDbPersistence\",\"Releasing primary lease.\"),n.delete(yr.key)):Zn.resolve()})},t.prototype.No=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(f(\"Detected an update time that is in the future: \"+t+\" > \"+n),1))},t.prototype.Io=function(){var t=this;null!==this.document&&\"function\"==typeof this.document.addEventListener&&(this.oo=function(){t.Zr.Ps(function(){return t.inForeground=\"visible\"===t.document.visibilityState,t.To()})},this.document.addEventListener(\"visibilitychange\",this.oo),this.inForeground=\"visible\"===this.document.visibilityState)},t.prototype.Lo=function(){this.oo&&(this.document.removeEventListener(\"visibilitychange\",this.oo),this.oo=null)},t.prototype.mo=function(){var t,e=this;\"function\"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.ro=function(){e.Mo(),e.Zr.Ps(function(){return e.ko()})},this.window.addEventListener(\"unload\",this.ro))},t.prototype.Bo=function(){this.ro&&(this.window.removeEventListener(\"unload\",this.ro),this.ro=null)},t.prototype.Oo=function(t){var e;try{var n=null!==(null===(e=this.Eo)||void 0===e?void 0:e.getItem(this.Fo(t)));return h(\"IndexedDbPersistence\",\"Client '\"+t+\"' \"+(n?\"is\":\"is not\")+\" zombied in LocalStorage\"),n}catch(t){return f(\"IndexedDbPersistence\",\"Failed to get zombied client id.\",t),!1}},t.prototype.Mo=function(){if(this.Eo)try{this.Eo.setItem(this.Fo(this.clientId),String(Date.now()))}catch(t){f(\"Failed to set zombie client id.\",t)}},t.prototype.qo=function(){if(this.Eo)try{this.Eo.removeItem(this.Fo(this.clientId))}catch(t){}},t.prototype.Fo=function(t){return\"firestore_zombie_\"+this.persistenceKey+\"_\"+t},t}();function Pi(t){return Vr(t,yr.store)}function Vi(t){return Vr(t,Sr.store)}function Li(t,e){var n=t.projectId;return t.o||(n+=\".\"+t.database),\"firestore/\"+e+\"/\"+n+\"/\"}var Ci=function(t,e){this.progress=t,this.Go=e},Ri=function(){function t(t,e,n){this.fo=t,this.zo=e,this.Ei=n}return t.prototype.Ho=function(t,e){var n=this;return this.zo.bi(t,e).next(function(r){return n.Jo(t,e,r)})},t.prototype.Jo=function(t,e,n){return this.fo._i(t,e).next(function(t){for(var r=0,i=n;r<i.length;r++)t=i[r].Cs(e,t);return t})},t.prototype.Yo=function(t,e,n){var r=Xe();return e.forEach(function(t,e){for(var i=0,o=n;i<o.length;i++)e=o[i].Cs(t,e);r=r.zt(t,e)}),r},t.prototype.Xo=function(t,e){var n=this;return this.fo.getEntries(t,e).next(function(e){return n.Zo(t,e)})},t.prototype.Zo=function(t,e){var n=this;return this.zo.vi(t,e).next(function(r){var i=n.Yo(t,e,r),o=Ke();return i.forEach(function(t,e){e||(e=new mt(t,L.min())),o=o.zt(t,e)}),o})},t.prototype.Kr=function(t,e,n){return function(t){return q.wt(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.tc(t,e.path):Ht(e)?this.ec(t,e,n):this.nc(t,e,n)},t.prototype.tc=function(t,e){return this.Ho(t,new q(e)).next(function(t){var e=Ze();return t instanceof gt&&(e=e.zt(t.key,t)),e})},t.prototype.ec=function(t,e,n){var r=this,i=e.collectionGroup,o=Ze();return this.Ei.Us(t,i).next(function(u){return Zn.forEach(u,function(u){var s=function(t,e){return new Ft(e,null,t.xt.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,u.child(i));return r.nc(t,s,n).next(function(t){t.forEach(function(t,e){o=o.zt(t,e)})})}).next(function(){return o})})},t.prototype.nc=function(t,e,n){var r,i,o=this;return this.fo.Kr(t,e,n).next(function(n){return r=n,o.zo.Di(t,e)}).next(function(e){return i=e,o.sc(t,i,r).next(function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],u=0,s=o.mutations;u<s.length;u++){var a=s[u],c=a.key,h=xe(a,r.get(c),o.vs);r=h instanceof gt?r.zt(c,h):r.remove(c)}})}).next(function(){return r.forEach(function(t,n){te(e,n)||(r=r.remove(t))}),r})},t.prototype.sc=function(t,e,n){for(var r=en(),i=0,o=e;i<o.length;i++)for(var u=0,s=o[i].mutations;u<s.length;u++){var a=s[u];a instanceof ke&&null===n.get(a.key)&&(r=r.add(a.key))}var c=n;return this.fo.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof gt&&(c=c.zt(t,e))}),c})},t}(),Ui=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.ic=n,this.rc=r}return t.oc=function(e,n){for(var r=en(),i=en(),o=0,u=n.docChanges;o<u.length;o++){var s=u[o];switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),Mi=function(){function t(){}return t.prototype.cc=function(t){this.ac=t},t.prototype.Kr=function(t,n,r,i){var o=this;return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.xt.length||1===t.xt.length&&t.xt[0].field.ut())}(n)||r.isEqual(L.min())?this.uc(t,n):this.ac.Xo(t,i).next(function(u){var s=o.hc(n,u);return(Gt(n)||Bt(n))&&o.lc(n.limitType,s,i,r)?o.uc(t,n):(c()<=e.LogLevel.DEBUG&&h(\"QueryEngine\",\"Re-using previous result from %s to execute query: %s\",r.toString(),$t(n)),o.ac.Kr(t,n,r).next(function(t){return s.forEach(function(e){t=t.zt(e.key,e)}),t}))})},t.prototype.hc=function(t,e){var n=new Qe(ee(t));return e.forEach(function(e,r){r instanceof gt&&te(t,r)&&(n=n.add(r))}),n},t.prototype.lc=function(t,e,n,r){if(n.size!==e.size)return!0;var i=\"F\"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version._(r)>0)},t.prototype.uc=function(t,n){return c()<=e.LogLevel.DEBUG&&h(\"QueryEngine\",\"Using full collection scan to execute query:\",$t(n)),this.ac.Kr(t,n,L.min())},t}(),qi=function(){function t(t,e,n,r){this.persistence=t,this._c=e,this.Qt=r,this.fc=new ze(_),this.dc=new ri(function(t){return It(t)},Et),this.wc=L.min(),this.zo=t.Qo(n),this.Ec=t.$r(),this._o=t.Sr(),this.Tc=new Ri(this.Ec,this.zo,this.persistence.Ko()),this.wo=t.Wo(),this._c.cc(this.Tc)}return t.prototype.Ir=function(t){var e=this;return this.persistence.runTransaction(\"Collect garbage\",\"readwrite-primary\",function(n){return t.Vr(n,e.fc)})},t}();function Fi(t,e,n,r){return new qi(t,e,n,r)}function ji(t,e){return(0,i.__awaiter)(this,void 0,void 0,function(){var n,r,o,u;return(0,i.__generator)(this,function(i){switch(i.label){case 0:return n=y(t),r=n.zo,o=n.Tc,[4,n.persistence.runTransaction(\"Handle user change\",\"readonly\",function(t){var i;return n.zo.pi(t).next(function(u){return i=u,r=n.persistence.Qo(e),o=new Ri(n.Ec,r,n.persistence.Ko()),r.pi(t)}).next(function(e){for(var n=[],r=[],u=en(),s=0,a=i;s<a.length;s++){var c=a[s];n.push(c.batchId);for(var h=0,f=c.mutations;h<f.length;h++){var l=f[h];u=u.add(l.key)}}for(var p=0,d=e;p<d.length;p++){var v=d[p];r.push(v.batchId);for(var y=0,g=v.mutations;y<g.length;y++){var m=g[y];u=u.add(m.key)}}return o.Xo(t,u).next(function(t){return{Ic:t,mc:n,Ac:r}})})})];case 1:return u=i.sent(),[2,(n.zo=r,n.Tc=o,n._c.cc(n.Tc),u)]}})})}function zi(t,e){var n=y(t);return n.persistence.runTransaction(\"Acknowledge batch\",\"readwrite-primary\",function(t){var r=e.batch.keys(),i=n.Ec.Nr({Wr:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),u=Zn.resolve();return o.forEach(function(t){u=u.next(function(){return r._i(e,t)}).next(function(e){var o=e,u=n.$s.get(t);v(null!==u),(!o||o.version._(u)<0)&&(o=i.Ss(t,o,n))&&r.ai(o,n.Ns)})}),u.next(function(){return t.zo.Ci(e,i)})}(n,t,e,i).next(function(){return i.apply(t)}).next(function(){return n.zo.$i(t)}).next(function(){return n.Tc.Xo(t,r)})})}function Gi(t){var e=y(t);return e.persistence.runTransaction(\"Get last remote snapshot version\",\"readonly\",function(t){return e._o.Qi(t)})}function Bi(t,e){var n=y(t),r=e.Ot,i=n.fc;return n.persistence.runTransaction(\"Apply remote event\",\"readwrite-primary\",function(t){var o=n.Ec.Nr({Wr:!0});i=n.fc;var u=[];e.$e.forEach(function(e,o){var s=i.get(o);if(s){u.push(n._o.sr(t,e.Qe,o).next(function(){return n._o.er(t,e.qe,o)}));var a=e.resumeToken;if(a.l()>0){var c=s.Mt(a,r).kt(t.bs);i=i.zt(o,c),function(t,e,n){return v(e.resumeToken.l()>0),0===t.resumeToken.l()||e.Ot.W()-t.Ot.W()>=3e8||n.qe.size+n.Ue.size+n.Qe.size>0}(s,c,e)&&u.push(n._o.Hi(t,c))}}});var s=Ke();if(e.Oe.forEach(function(r,i){e.ke.has(r)&&u.push(n.persistence.Ti.Fr(t,r))}),u.push(Qi(t,o,e.Oe,r,void 0).next(function(t){s=t})),!r.isEqual(L.min())){var a=n._o.Qi(t).next(function(e){return n._o.Wi(t,t.bs,r)});u.push(a)}return Zn.Mn(u).next(function(){return o.apply(t)}).next(function(){return n.Tc.Zo(t,s)})}).then(function(t){return n.fc=i,t})}function Qi(t,e,n,r,i){var o=en();return n.forEach(function(t){return o=o.add(t)}),e.getEntries(t,o).next(function(t){var o=Ke();return n.forEach(function(n,u){var s=t.get(n),a=(null==i?void 0:i.get(n))||r;u instanceof mt&&u.version.isEqual(L.min())?(e.li(n,a),o=o.zt(n,u)):null==s||u.version._(s.version)>0||0===u.version._(s.version)&&s.hasPendingWrites?(e.ai(u,a),o=o.zt(n,u)):h(\"LocalStore\",\"Ignoring outdated watch update for \",n,\". Current version:\",s.version,\" Watch version:\",u.version)}),o})}function Yi(t,e){var n=y(t);return n.persistence.runTransaction(\"Get next mutation batch\",\"readonly\",function(t){return void 0===e&&(e=-1),n.zo.gi(t,e)})}function Hi(t,e){var n=y(t);return n.persistence.runTransaction(\"Allocate target\",\"readwrite\",function(t){var r;return n._o.tr(t,e).next(function(i){return i?(r=i,Zn.resolve(r)):n._o.Bi(t).next(function(i){return r=new re(e,i,0,t.bs),n._o.ji(t,r).next(function(){return r})})})}).then(function(t){var r=n.fc.get(t.targetId);return(null===r||t.Ot._(r.Ot)>0)&&(n.fc=n.fc.zt(t.targetId,t),n.dc.set(e,t.targetId)),t})}function Ki(t,e,n){return(0,i.__awaiter)(this,void 0,void 0,function(){var r,o,u,s;return(0,i.__generator)(this,function(i){switch(i.label){case 0:r=y(t),o=r.fc.get(e),u=n?\"readwrite\":\"readwrite-primary\",i.label=1;case 1:return i.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction(\"Release target\",u,function(t){return r.persistence.Ti.removeTarget(t,o)})];case 2:i.sent(),i.label=3;case 3:return[3,5];case 4:if(!nr(s=i.sent()))throw s;return h(\"LocalStore\",\"Failed to update sequence numbers for target \"+e+\": \"+s),[3,5];case 5:return r.fc=r.fc.remove(e),r.dc.delete(o.target),[2]}})})}function Xi(t,e,n){var r=y(t),i=L.min(),o=en();return r.persistence.runTransaction(\"Execute query\",\"readonly\",function(t){return function(t,e,n){var r=y(t),i=r.dc.get(n);return void 0!==i?Zn.resolve(r.fc.get(i)):r._o.tr(e,n)}(r,t,Xt(e)).next(function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r._o.rr(t,e.targetId).next(function(t){o=t})}).next(function(){return r._c.Kr(t,e,n?i:L.min(),n?o:en())}).next(function(t){return{documents:t,Rc:o}})})}function Wi(t,e){var n=y(t),r=y(n._o),i=n.fc.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction(\"Get target data\",\"readonly\",function(t){return r.Sn(t,e).next(function(t){return t?t.target:null})})}function Zi(t){var e=y(t);return e.persistence.runTransaction(\"Get new document changes\",\"readonly\",function(t){return function(t,e,n){var r=y(t),i=Ke(),o=qr(n),u=Ni(e),s=IDBKeyRange.lowerBound(o,!0);return u.hs({index:Ir.readTimeIndex,range:s},function(t,e){var n=Ur(r.Qt,e);i=i.zt(n.key,n),o=e.readTime}).next(function(){return{Go:i,readTime:Fr(o)}})}(e.Ec,t,e.wc)}).then(function(t){var n=t.Go,r=t.readTime;return e.wc=r,n})}function Ji(t){return(0,i.__awaiter)(this,void 0,void 0,function(){var e;return(0,i.__generator)(this,function(n){return[2,(e=y(t)).persistence.runTransaction(\"Synchronize last document change read time\",\"readonly\",function(t){return function(t){var e=Ni(t),n=L.min();return e.hs({index:Ir.readTimeIndex,reverse:!0},function(t,e,r){e.readTime&&(n=Fr(e.readTime)),r.done()}).next(function(){return n})}(t)}).then(function(t){e.wc=t})]})})}function $i(t,e,n,r){return(0,i.__awaiter)(this,void 0,void 0,function(){var o,u,s,a,c,h,f,l,p,d;return(0,i.__generator)(this,function(i){switch(i.label){case 0:for(o=y(t),u=en(),s=Ke(),a=$e(),c=0,h=n;c<h.length;c++)f=h[c],l=e.Pc(f.metadata.name),f.document&&(u=u.add(l)),s=s.zt(l,e.yc(f)),a=a.zt(l,e.gc(f.metadata.readTime));return p=o.Ec.Nr({Wr:!0}),[4,Hi(o,function(t){return Xt(zt(R.ot(\"__bundle__/docs/\"+t)))}(r))];case 1:return d=i.sent(),[2,o.persistence.runTransaction(\"Apply bundle documents\",\"readwrite\",function(t){return Qi(t,p,s,L.min(),a).next(function(e){return p.apply(t),e}).next(function(e){return o._o.Yi(t,d.targetId).next(function(){return o._o.er(t,u,d.targetId)}).next(function(){return o.Tc.Zo(t,e)})})})]}})})}function to(t,e,n){return void 0===n&&(n=en()),(0,i.__awaiter)(this,void 0,void 0,function(){var r,o;return(0,i.__generator)(this,function(i){switch(i.label){case 0:return[4,Hi(t,Xt(Yr(e.bundledQuery)))];case 1:return r=i.sent(),[2,(o=y(t)).persistence.runTransaction(\"Save named query\",\"readwrite\",function(t){var i=En(e.readTime);if(r.Ot._(i)>=0)return o.wo.Ls(t,e);var u=r.Mt(I.T,i);return o.fc=o.fc.zt(u.targetId,u),o._o.Hi(t,u).next(function(){return o._o.Yi(t,r.targetId)}).next(function(){return o._o.er(t,n,r.targetId)}).next(function(){return o.wo.Ls(t,e)})})]}})})}var eo=function(){function t(t){this.Qt=t,this.Vc=new Map,this.bc=new Map}return t.prototype.Os=function(t,e){return Zn.resolve(this.Vc.get(e))},t.prototype.ks=function(t,e){var n;return this.Vc.set(e.id,{id:(n=e).id,version:n.version,createTime:En(n.createTime)}),Zn.resolve()},t.prototype.Ms=function(t,e){return Zn.resolve(this.bc.get(e))},t.prototype.Ls=function(t,e){return this.bc.set(e.name,function(t){return{name:t.name,query:Yr(t.bundledQuery),readTime:En(t.readTime)}}(e)),Zn.resolve()},t}(),no=function(){function t(){this.vc=new Qe(ro.Sc),this.Dc=new Qe(ro.Cc)}return t.prototype.et=function(){return this.vc.et()},t.prototype.nr=function(t,e){var n=new ro(t,e);this.vc=this.vc.add(n),this.Dc=this.Dc.add(n)},t.prototype.xc=function(t,e){var n=this;t.forEach(function(t){return n.nr(t,e)})},t.prototype.ir=function(t,e){this.Nc(new ro(t,e))},t.prototype.$c=function(t,e){var n=this;t.forEach(function(t){return n.ir(t,e)})},t.prototype.Fc=function(t){var e=this,n=new q(new R([])),r=new ro(n,t),i=new ro(n,t+1),o=[];return this.Dc.me([r,i],function(t){e.Nc(t),o.push(t.key)}),o},t.prototype.Oc=function(){var t=this;this.vc.forEach(function(e){return t.Nc(e)})},t.prototype.Nc=function(t){this.vc=this.vc.delete(t),this.Dc=this.Dc.delete(t)},t.prototype.kc=function(t){var e=new q(new R([])),n=new ro(e,t),r=new ro(e,t+1),i=en();return this.Dc.me([n,r],function(t){i=i.add(t.key)}),i},t.prototype.Fi=function(t){var e=new ro(t,0),n=this.vc.Re(e);return null!==n&&t.isEqual(n.key)},t}(),ro=function(){function t(t,e){this.key=t,this.Mc=e}return t.Sc=function(t,e){return q.H(t.key,e.key)||_(t.Mc,e.Mc)},t.Cc=function(t,e){return _(t.Mc,e.Mc)||q.H(t.key,e.key)},t}(),io=function(){function t(t,e){this.Ei=t,this.Ti=e,this.zo=[],this.Lc=1,this.Bc=new Qe(ro.Sc)}return t.prototype.Ai=function(t){return Zn.resolve(0===this.zo.length)},t.prototype.Ri=function(t,e,n,r){var i=this.Lc;this.Lc++,this.zo.length>0&&this.zo[this.zo.length-1];var o=new Lr(i,e,n,r);this.zo.push(o);for(var u=0,s=r;u<s.length;u++){var a=s[u];this.Bc=this.Bc.add(new ro(a.key,i)),this.Ei.qs(t,a.key.path.X())}return Zn.resolve(o)},t.prototype.Pi=function(t,e){return Zn.resolve(this.qc(e))},t.prototype.gi=function(t,e){var n=e+1,r=this.Uc(n),i=r<0?0:r;return Zn.resolve(this.zo.length>i?this.zo[i]:null)},t.prototype.Vi=function(){return Zn.resolve(0===this.zo.length?-1:this.Lc-1)},t.prototype.pi=function(t){return Zn.resolve(this.zo.slice())},t.prototype.bi=function(t,e){var n=this,r=new ro(e,0),i=new ro(e,Number.POSITIVE_INFINITY),o=[];return this.Bc.me([r,i],function(t){var e=n.qc(t.Mc);o.push(e)}),Zn.resolve(o)},t.prototype.vi=function(t,e){var n=this,r=new Qe(_);return e.forEach(function(t){var e=new ro(t,0),i=new ro(t,Number.POSITIVE_INFINITY);n.Bc.me([e,i],function(t){r=r.add(t.Mc)})}),Zn.resolve(this.Qc(r))},t.prototype.Di=function(t,e){var n=e.path,r=n.length+1,i=n;q.wt(i)||(i=i.child(\"\"));var o=new ro(new q(i),0),u=new Qe(_);return this.Bc.Ae(function(t){var e=t.key.path;return!!n.nt(e)&&(e.length===r&&(u=u.add(t.Mc)),!0)},o),Zn.resolve(this.Qc(u))},t.prototype.Qc=function(t){var e=this,n=[];return t.forEach(function(t){var r=e.qc(t);null!==r&&n.push(r)}),n},t.prototype.Ci=function(t,e){var n=this;v(0===this.Kc(e.batchId,\"removed\")),this.zo.shift();var r=this.Bc;return Zn.forEach(e.mutations,function(i){var o=new ro(i.key,e.batchId);return r=r.delete(o),n.Ti.Ni(t,i.key)}).next(function(){n.Bc=r})},t.prototype.xi=function(t){},t.prototype.Fi=function(t,e){var n=new ro(e,0),r=this.Bc.Re(n);return Zn.resolve(e.isEqual(r&&r.key))},t.prototype.$i=function(t){return this.zo.length,Zn.resolve()},t.prototype.Kc=function(t,e){return this.Uc(t)},t.prototype.Uc=function(t){return 0===this.zo.length?0:t-this.zo[0].batchId},t.prototype.qc=function(t){var e=this.Uc(t);return e<0||e>=this.zo.length?null:this.zo[e]},t}(),oo=function(){function t(t,e){this.Ei=t,this.Wc=e,this.docs=new ze(q.H),this.size=0}return t.prototype.ai=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,u=this.Wc(e);return this.docs=this.docs.zt(r,{hi:e,size:u,readTime:n}),this.size+=u-o,this.Ei.qs(t,r.path.X())},t.prototype.li=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype._i=function(t,e){var n=this.docs.get(e);return Zn.resolve(n?n.hi:null)},t.prototype.getEntries=function(t,e){var n=this,r=Xe();return e.forEach(function(t){var e=n.docs.get(t);r=r.zt(t,e?e.hi:null)}),Zn.resolve(r)},t.prototype.Kr=function(t,e,n){for(var r=Ze(),i=new q(e.path.child(\"\")),o=this.docs.ee(i);o.ce();){var u=o.oe(),s=u.key,a=u.value,c=a.hi,h=a.readTime;if(!e.path.nt(s.path))break;h._(n)<=0||c instanceof gt&&te(e,c)&&(r=r.zt(c.key,c))}return Zn.resolve(r)},t.prototype.jc=function(t,e){return Zn.forEach(this.docs,function(t){return e(t)})},t.prototype.Nr=function(t){return new uo(this)},t.prototype.Or=function(t){return Zn.resolve(this.size)},t}(),uo=function(t){function e(e){var n=this;return(n=t.call(this)||this).jr=e,n}return(0,i.__extends)(e,t),e.prototype.wi=function(t){var e=this,n=[];return this.ri.forEach(function(r,i){i&&i.hi?n.push(e.jr.ai(t,i.hi,e.ci(r))):e.jr.li(r)}),Zn.Mn(n)},e.prototype.fi=function(t,e){return this.jr._i(t,e)},e.prototype.di=function(t,e){return this.jr.getEntries(t,e)},e}(ii),so=function(){function t(t){this.persistence=t,this.Gc=new ri(function(t){return It(t)},Et),this.lastRemoteSnapshotVersion=L.min(),this.highestTargetId=0,this.zc=0,this.Hc=new no,this.targetCount=0,this.Jc=li.Mi()}return t.prototype.In=function(t,e){return this.Gc.forEach(function(t,n){return e(n)}),Zn.resolve()},t.prototype.Qi=function(t){return Zn.resolve(this.lastRemoteSnapshotVersion)},t.prototype.Ki=function(t){return Zn.resolve(this.zc)},t.prototype.Bi=function(t){return this.highestTargetId=this.Jc.next(),Zn.resolve(this.highestTargetId)},t.prototype.Wi=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.zc&&(this.zc=e),Zn.resolve()},t.prototype.Gi=function(t){this.Gc.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.Jc=new li(e),this.highestTargetId=e),t.sequenceNumber>this.zc&&(this.zc=t.sequenceNumber)},t.prototype.ji=function(t,e){return this.Gi(e),this.targetCount+=1,Zn.resolve()},t.prototype.Hi=function(t,e){return this.Gi(e),Zn.resolve()},t.prototype.Ji=function(t,e){return this.Gc.delete(e.target),this.Hc.Fc(e.targetId),this.targetCount-=1,Zn.resolve()},t.prototype.Xi=function(t,e,n){var r=this,i=0,o=[];return this.Gc.forEach(function(u,s){s.sequenceNumber<=e&&null===n.get(s.targetId)&&(r.Gc.delete(u),o.push(r.Yi(t,s.targetId)),i++)}),Zn.Mn(o).next(function(){return i})},t.prototype.Zi=function(t){return Zn.resolve(this.targetCount)},t.prototype.tr=function(t,e){var n=this.Gc.get(e)||null;return Zn.resolve(n)},t.prototype.er=function(t,e,n){return this.Hc.xc(e,n),Zn.resolve()},t.prototype.sr=function(t,e,n){this.Hc.$c(e,n);var r=this.persistence.Ti,i=[];return r&&e.forEach(function(e){i.push(r.Ni(t,e))}),Zn.Mn(i)},t.prototype.Yi=function(t,e){return this.Hc.Fc(e),Zn.resolve()},t.prototype.rr=function(t,e){var n=this.Hc.kc(e);return Zn.resolve(n)},t.prototype.Fi=function(t,e){return Zn.resolve(this.Hc.Fi(e))},t}(),ao=function(){function t(t,e){var n=this;this.Yc={},this.so=new P(0),this.io=!1,this.io=!0,this.Ti=t(this),this._o=new so(this),this.Ei=new Wr,this.fo=function(t,e){return new oo(t,function(t){return n.Ti.Xc(t)})}(this.Ei),this.Qt=new Rr(e),this.wo=new eo(this.Qt)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.ko=function(){return this.io=!1,Promise.resolve()},Object.defineProperty(t.prototype,\"Er\",{get:function(){return this.io},enumerable:!1,configurable:!0}),t.prototype.Po=function(){},t.prototype.yo=function(){},t.prototype.Ko=function(){return this.Ei},t.prototype.Qo=function(t){var e=this.Yc[t.A()];return e||(e=new io(this.Ei,this.Ti),this.Yc[t.A()]=e),e},t.prototype.Sr=function(){return this._o},t.prototype.$r=function(){return this.fo},t.prototype.Wo=function(){return this.wo},t.prototype.runTransaction=function(t,e,n){var r=this;h(\"MemoryPersistence\",\"Starting transaction:\",t);var i=new co(this.so.next());return this.Ti.Zc(),n(i).next(function(t){return r.Ti.ta(i).next(function(){return t})}).On().then(function(t){return i.Vs(),t})},t.prototype.ea=function(t,e){return Zn.Ln(Object.values(this.Yc).map(function(n){return function(){return n.Fi(t,e)}}))},t}(),co=function(t){function e(e){var n=this;return(n=t.call(this)||this).bs=e,n}return(0,i.__extends)(e,t),e}(hr),ho=function(){function t(t){this.persistence=t,this.na=new no,this.sa=null}return t.ia=function(e){return new t(e)},Object.defineProperty(t.prototype,\"ra\",{get:function(){if(this.sa)return this.sa;throw d()},enumerable:!1,configurable:!0}),t.prototype.nr=function(t,e,n){return this.na.nr(n,e),this.ra.delete(n.toString()),Zn.resolve()},t.prototype.ir=function(t,e,n){return this.na.ir(n,e),this.ra.add(n.toString()),Zn.resolve()},t.prototype.Ni=function(t,e){return this.ra.add(e.toString()),Zn.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.na.Fc(e.targetId).forEach(function(t){return n.ra.add(t.toString())});var r=this.persistence.Sr();return r.rr(t,e.targetId).next(function(t){t.forEach(function(t){return n.ra.add(t.toString())})}).next(function(){return r.Ji(t,e)})},t.prototype.Zc=function(){this.sa=new Set},t.prototype.ta=function(t){var e=this,n=this.persistence.$r().Nr();return Zn.forEach(this.ra,function(r){var i=q._t(r);return e.oa(t,i).next(function(t){t||n.li(i)})}).next(function(){return e.sa=null,n.apply(t)})},t.prototype.Fr=function(t,e){var n=this;return this.oa(t,e).next(function(t){t?n.ra.delete(e.toString()):n.ra.add(e.toString())})},t.prototype.Xc=function(t){return 0},t.prototype.oa=function(t,e){var n=this;return Zn.Ln([function(){return Zn.resolve(n.na.Fi(e))},function(){return n.persistence.Sr().Fi(t,e)},function(){return n.persistence.ea(t,e)}])},t}();function fo(t,e){return\"firestore_clients_\"+t+\"_\"+e}function lo(t,e,n){var r=\"firestore_mutations_\"+t+\"_\"+n;return e.m()&&(r+=\"_\"+e.uid),r}function po(t,e){return\"firestore_targets_\"+t+\"_\"+e}var vo=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.ca=function(e,n,r){var i,u=JSON.parse(r),s=\"object\"==o(u)&&-1!==[\"pending\",\"acknowledged\",\"rejected\"].indexOf(u.state)&&(void 0===u.error||\"object\"==o(u.error));return s&&u.error&&(s=\"string\"==typeof u.error.message&&\"string\"==typeof u.error.code)&&(i=new T(u.error.code,u.error.message)),s?new t(e,n,u.state,i):(f(\"SharedClientState\",\"Failed to parse mutation state for ID '\"+n+\"': \"+r),null)},t.prototype.aa=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),yo=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.ca=function(e,n){var r,i=JSON.parse(n),u=\"object\"==o(i)&&-1!==[\"not-current\",\"current\",\"rejected\"].indexOf(i.state)&&(void 0===i.error||\"object\"==o(i.error));return u&&i.error&&(u=\"string\"==typeof i.error.message&&\"string\"==typeof i.error.code)&&(r=new T(i.error.code,i.error.message)),u?new t(e,i.state,r):(f(\"SharedClientState\",\"Failed to parse target state for ID '\"+e+\"': \"+n),null)},t.prototype.aa=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),go=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.ca=function(e,n){for(var r=JSON.parse(n),i=\"object\"==o(r)&&r.activeTargetIds instanceof Array,u=rn(),s=0;i&&s<r.activeTargetIds.length;++s)i=$(r.activeTargetIds[s]),u=u.add(r.activeTargetIds[s]);return i?new t(e,u):(f(\"SharedClientState\",\"Failed to parse client data for instance '\"+e+\"': \"+n),null)},t}(),mo=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.ca=function(e){var n=JSON.parse(e);return\"object\"==o(n)&&-1!==[\"Unknown\",\"Online\",\"Offline\"].indexOf(n.onlineState)&&\"string\"==typeof n.clientId?new t(n.clientId,n.onlineState):(f(\"SharedClientState\",\"Failed to parse online state: \"+e),null)},t}(),_o=function(){function t(){this.activeTargetIds=rn()}return t.prototype.ua=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.ha=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.aa=function(){var t={activeTargetIds:this.activeTargetIds.it(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),wo=function(){function t(t,e,n,r,i){this.window=t,this.Zr=e,this.persistenceKey=n,this.la=r,this._a=null,this.fa=null,this.k=null,this.da=this.wa.bind(this),this.Ea=new ze(_),this.Er=!1,this.Ta=[];var o=n.replace(/[.*+?^${}()|[\\]\\\\]/g,\"\\\\$&\");this.storage=this.window.localStorage,this.currentUser=i,this.Ia=fo(this.persistenceKey,this.la),this.ma=function(t){return\"firestore_sequence_number_\"+t}(this.persistenceKey),this.Ea=this.Ea.zt(this.la,new _o),this.Aa=new RegExp(\"^firestore_clients_\"+o+\"_([^_]*)$\"),this.Ra=new RegExp(\"^firestore_mutations_\"+o+\"_(\\\\d+)(?:_(.*))?$\"),this.Pa=new RegExp(\"^firestore_targets_\"+o+\"_(\\\\d+)$\"),this.ya=function(t){return\"firestore_online_state_\"+t}(this.persistenceKey),this.ga=function(t){return\"firestore_bundle_loaded_\"+t}(this.persistenceKey),this.window.addEventListener(\"storage\",this.da)}return t.Kn=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return(0,i.__awaiter)(this,void 0,void 0,function(){var t,e,n,r,o,u,s,a,c,h,f,l=this;return(0,i.__generator)(this,function(i){switch(i.label){case 0:return[4,this._a.Uo()];case 1:for(t=i.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.la&&(o=this.getItem(fo(this.persistenceKey,r)))&&(u=go.ca(r,o))&&(this.Ea=this.Ea.zt(u.clientId,u));for(this.Va(),(s=this.storage.getItem(this.ya))&&(a=this.pa(s))&&this.ba(a),c=0,h=this.Ta;c<h.length;c++)f=h[c],this.wa(f);return this.Ta=[],this.window.addEventListener(\"unload\",function(){return l.ko()}),this.Er=!0,[2]}})})},t.prototype.B=function(t){this.setItem(this.ma,JSON.stringify(t))},t.prototype.va=function(){return this.Sa(this.Ea)},t.prototype.Da=function(t){var e=!1;return this.Ea.forEach(function(n,r){r.activeTargetIds.has(t)&&(e=!0)}),e},t.prototype.Ca=function(t){this.xa(t,\"pending\")},t.prototype.Na=function(t,e,n){this.xa(t,e,n),this.$a(t)},t.prototype.Fa=function(t){var e=\"not-current\";if(this.Da(t)){var n=this.storage.getItem(po(this.persistenceKey,t));if(n){var r=yo.ca(t,n);r&&(e=r.state)}}return this.Oa.ua(t),this.Va(),e},t.prototype.ka=function(t){this.Oa.ha(t),this.Va()},t.prototype.Ma=function(t){return this.Oa.activeTargetIds.has(t)},t.prototype.La=function(t){this.removeItem(po(this.persistenceKey,t))},t.prototype.Ba=function(t,e,n){this.qa(t,e,n)},t.prototype.Ua=function(t,e,n){var r=this;e.forEach(function(t){r.$a(t)}),this.currentUser=t,n.forEach(function(t){r.Ca(t)})},t.prototype.Qa=function(t){this.Ka(t)},t.prototype.Wa=function(){this.ja()},t.prototype.ko=function(){this.Er&&(this.window.removeEventListener(\"storage\",this.da),this.removeItem(this.Ia),this.Er=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return h(\"SharedClientState\",\"READ\",t,e),e},t.prototype.setItem=function(t,e){h(\"SharedClientState\",\"SET\",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){h(\"SharedClientState\",\"REMOVE\",t),this.storage.removeItem(t)},t.prototype.wa=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(h(\"SharedClientState\",\"EVENT\",n.key,n.newValue),n.key===this.Ia)return void f(\"Received WebStorage notification for local change. Another client might have garbage-collected our state\");this.Zr.po(function(){return(0,i.__awaiter)(e,void 0,void 0,function(){var t,e,r,o,u,s;return(0,i.__generator)(this,function(i){if(this.Er){if(null!==n.key)if(this.Aa.test(n.key)){if(null==n.newValue)return t=this.Ga(n.key),[2,this.za(t,null)];if(e=this.Ha(n.key,n.newValue))return[2,this.za(e.clientId,e)]}else if(this.Ra.test(n.key)){if(null!==n.newValue&&(r=this.Ja(n.key,n.newValue)))return[2,this.Ya(r)]}else if(this.Pa.test(n.key)){if(null!==n.newValue&&(o=this.Xa(n.key,n.newValue)))return[2,this.Za(o)]}else if(n.key===this.ya){if(null!==n.newValue&&(u=this.pa(n.newValue)))return[2,this.ba(u)]}else if(n.key===this.ma)(s=function(t){var e=P.q;if(null!=t)try{var n=JSON.parse(t);v(\"number\"==typeof n),e=n}catch(t){f(\"SharedClientState\",\"Failed to read sequence number from WebStorage\",t)}return e}(n.newValue))!==P.q&&this.k(s);else if(n.key===this.ga)return[2,this._a.tu()]}else this.Ta.push(n);return[2]})})})}},Object.defineProperty(t.prototype,\"Oa\",{get:function(){return this.Ea.get(this.la)},enumerable:!1,configurable:!0}),t.prototype.Va=function(){this.setItem(this.Ia,this.Oa.aa())},t.prototype.xa=function(t,e,n){var r=new vo(this.currentUser,t,e,n),i=lo(this.persistenceKey,this.currentUser,t);this.setItem(i,r.aa())},t.prototype.$a=function(t){var e=lo(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Ka=function(t){var e={clientId:this.la,onlineState:t};this.storage.setItem(this.ya,JSON.stringify(e))},t.prototype.qa=function(t,e,n){var r=po(this.persistenceKey,t),i=new yo(t,e,n);this.setItem(r,i.aa())},t.prototype.ja=function(){this.setItem(this.ga,\"value-not-used\")},t.prototype.Ga=function(t){var e=this.Aa.exec(t);return e?e[1]:null},t.prototype.Ha=function(t,e){var n=this.Ga(t);return go.ca(n,e)},t.prototype.Ja=function(t,e){var n=this.Ra.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return vo.ca(new N(i),r,e)},t.prototype.Xa=function(t,e){var n=this.Pa.exec(t),r=Number(n[1]);return yo.ca(r,e)},t.prototype.pa=function(t){return mo.ca(t)},t.prototype.Ya=function(t){return(0,i.__awaiter)(this,void 0,void 0,function(){return(0,i.__generator)(this,function(e){return t.user.uid===this.currentUser.uid?[2,this._a.eu(t.batchId,t.state,t.error)]:(h(\"SharedClientState\",\"Ignoring mutation for non-active user \"+t.user.uid),[2])})})},t.prototype.Za=function(t){return this._a.nu(t.targetId,t.state,t.error)},t.prototype.za=function(t,e){var n=this,r=e?this.Ea.zt(t,e):this.Ea.remove(t),i=this.Sa(this.Ea),o=this.Sa(r),u=[],s=[];return o.forEach(function(t){i.has(t)||u.push(t)}),i.forEach(function(t){o.has(t)||s.push(t)}),this._a.su(u,s).then(function(){n.Ea=r})},t.prototype.ba=function(t){this.Ea.get(t.clientId)&&this.fa(t.onlineState)},t.prototype.Sa=function(t){var e=rn();return t.forEach(function(t,n){e=e.Pe(n.activeTargetIds)}),e},t}(),bo=function(){function t(){this.iu=new _o,this.ru={},this.fa=null,this.k=null}return t.prototype.Ca=function(t){},t.prototype.Na=function(t,e,n){},t.prototype.Fa=function(t){return this.iu.ua(t),this.ru[t]||\"not-current\"},t.prototype.Ba=function(t,e,n){this.ru[t]=e},t.prototype.ka=function(t){this.iu.ha(t)},t.prototype.Ma=function(t){return this.iu.activeTargetIds.has(t)},t.prototype.La=function(t){delete this.ru[t]},t.prototype.va=function(){return this.iu.activeTargetIds},t.prototype.Da=function(t){return this.iu.activeTargetIds.has(t)},t.prototype.start=function(){return this.iu=new _o,Promise.resolve()},t.prototype.Ua=function(t,e,n){},t.prototype.Qa=function(t){},t.prototype.ko=function(){},t.prototype.B=function(t){},t.prototype.Wa=function(){},t}(),Io=function(){function t(){}return t.prototype.ou=function(t){},t.prototype.ko=function(){},t}(),Eo=function(){function t(){var t=this;this.cu=function(){return t.au()},this.uu=function(){return t.hu()},this.lu=[],this._u()}return t.prototype.ou=function(t){this.lu.push(t)},t.prototype.ko=function(){window.removeEventListener(\"online\",this.cu),window.removeEventListener(\"offline\",this.uu)},t.prototype._u=function(){window.addEventListener(\"online\",this.cu),window.addEventListener(\"offline\",this.uu)},t.prototype.au=function(){h(\"ConnectivityMonitor\",\"Network connectivity changed: AVAILABLE\");for(var t=0,e=this.lu;t<e.length;t++)(0,e[t])(0)},t.prototype.hu=function(){h(\"ConnectivityMonitor\",\"Network connectivity changed: UNAVAILABLE\");for(var t=0,e=this.lu;t<e.length;t++)(0,e[t])(1)},t.Kn=function(){return\"undefined\"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),To={BatchGetDocuments:\"batchGet\",Commit:\"commit\",RunQuery:\"runQuery\"},xo=function(){function t(t){this.fu=t.fu,this.du=t.du}return t.prototype.wu=function(t){this.Eu=t},t.prototype.Tu=function(t){this.Iu=t},t.prototype.onMessage=function(t){this.mu=t},t.prototype.close=function(){this.du()},t.prototype.send=function(t){this.fu(t)},t.prototype.Au=function(){this.Eu()},t.prototype.Ru=function(t){this.Iu(t)},t.prototype.Pu=function(t){this.mu(t)},t}(),No=function(t){function e(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.i=e.i,n}return(0,i.__extends)(e,t),e.prototype.Su=function(t,e,n,i){return new Promise(function(o,u){var s=new r.XhrIo;s.listenOnce(r.EventType.COMPLETE,function(){try{switch(s.getLastErrorCode()){case r.ErrorCode.NO_ERROR:var e=s.getResponseJson();h(\"Connection\",\"XHR received:\",JSON.stringify(e)),o(e);break;case r.ErrorCode.TIMEOUT:h(\"Connection\",'RPC \"'+t+'\" timed out'),u(new T(E.DEADLINE_EXCEEDED,\"Request time out\"));break;case r.ErrorCode.HTTP_ERROR:var n=s.getStatus();if(h(\"Connection\",'RPC \"'+t+'\" failed with status:',n,\"response text:\",s.getResponseText()),n>0){var i=s.getResponseJson().error;if(i&&i.status&&i.message){var a=function(t){var e=i.status.toLowerCase().replace(/_/g,\"-\");return Object.values(E).indexOf(e)>=0?e:E.UNKNOWN}();u(new T(a,i.message))}else u(new T(E.UNKNOWN,\"Server responded with status \"+s.getStatus()))}else u(new T(E.UNAVAILABLE,\"Connection failed.\"));break;default:d()}}finally{h(\"Connection\",'RPC \"'+t+'\" completed.')}});var a=JSON.stringify(i);s.send(e,\"POST\",a,n,15)})},e.prototype.Cu=function(t,e){var i=[this.gu,\"/\",\"google.firestore.v1.Firestore\",\"/\",t,\"/channel\"],o=(0,r.createWebChannelTransport)(),u=(0,r.getStatEventTarget)(),s={httpSessionIdParam:\"gsessionid\",initMessageHeaders:{},messageUrlParams:{database:\"projects/\"+this.t.projectId+\"/databases/\"+this.t.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.i};this.vu(s.initMessageHeaders,e),(0,n.isMobileCordova)()||(0,n.isReactNative)()||(0,n.isElectron)()||(0,n.isIE)()||(0,n.isUWP)()||(0,n.isBrowserExtension)()||(s.httpHeadersOverwriteParam=\"$httpHeaders\");var a=i.join(\"\");h(\"Connection\",\"Creating WebChannel: \"+a,s);var c=o.createWebChannel(a,s),f=!1,p=!1,d=new xo({fu:function(t){p?h(\"Connection\",\"Not sending because WebChannel is closed:\",t):(f||(h(\"Connection\",\"Opening WebChannel transport.\"),c.open(),f=!0),h(\"Connection\",\"WebChannel sending:\",t),c.send(t))},du:function(){return c.close()}}),y=function(t,e,n){t.listen(e,function(t){try{n(t)}catch(t){setTimeout(function(){throw t},0)}})};return y(c,r.WebChannel.EventType.OPEN,function(){p||h(\"Connection\",\"WebChannel transport opened.\")}),y(c,r.WebChannel.EventType.CLOSE,function(){p||(p=!0,h(\"Connection\",\"WebChannel transport closed\"),d.Ru())}),y(c,r.WebChannel.EventType.ERROR,function(t){p||(p=!0,l(\"Connection\",\"WebChannel transport errored:\",t),d.Ru(new T(E.UNAVAILABLE,\"The operation could not be completed\")))}),y(c,r.WebChannel.EventType.MESSAGE,function(t){var e;if(!p){var n=t.data[0];v(!!n);var r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){h(\"Connection\",\"WebChannel received error:\",i);var o=i.status,u=function(t){var e=Ce[o];if(void 0!==e)return je(e)}(),s=i.message;void 0===u&&(u=E.INTERNAL,s=\"Unknown error status: \"+o+\" with message \"+i.message),p=!0,d.Ru(new T(u,s)),c.close()}else h(\"Connection\",\"WebChannel received:\",n),d.Pu(n)}}),y(u,r.Event.STAT_EVENT,function(t){t.stat===r.Stat.PROXY?h(\"Connection\",\"Detected buffering proxy\"):t.stat===r.Stat.NOPROXY&&h(\"Connection\",\"Detected no buffering proxy\")}),setTimeout(function(){d.Au()},0),d},e}(function(){function t(t){this.yu=t,this.t=t.t;var e=t.ssl?\"https\":\"http\";this.gu=e+\"://\"+t.host,this.Vu=\"projects/\"+this.t.projectId+\"/databases/\"+this.t.database+\"/documents\"}return t.prototype.pu=function(t,e,n,r){var i=this.bu(t,e);h(\"RestConnection\",\"Sending: \",i,n);var o={};return this.vu(o,r),this.Su(t,i,o,n).then(function(t){return h(\"RestConnection\",\"Received: \",t),t},function(e){throw l(\"RestConnection\",t+\" failed with error: \",e,\"url: \",i,\"request:\",n),e})},t.prototype.Du=function(t,e,n,r){return this.pu(t,e,n,r)},t.prototype.vu=function(t,e){if(t[\"X-Goog-Api-Client\"]=\"gl-js/ fire/8.2.9\",t[\"Content-Type\"]=\"text/plain\",e)for(var n in e.g)e.g.hasOwnProperty(n)&&(t[n]=e.g[n])},t.prototype.bu=function(t,e){var n=To[t];return this.gu+\"/v1/\"+e+\":\"+n},t}());function Ao(){return\"undefined\"!=typeof window?window:null}function So(){return\"undefined\"!=typeof document?document:null}function Do(t){return new _n(t,!0)}var ko=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Zr=t,this.fs=e,this.xu=n,this.Nu=r,this.$u=i,this.Fu=0,this.Ou=null,this.ku=Date.now(),this.reset()}return t.prototype.reset=function(){this.Fu=0},t.prototype.Mu=function(){this.Fu=this.$u},t.prototype.Lu=function(t){var e=this;this.cancel();var n=Math.floor(this.Fu+this.Bu()),r=Math.max(0,Date.now()-this.ku),i=Math.max(0,n-r);i>0&&h(\"ExponentialBackoff\",\"Backing off for \"+i+\" ms (base delay: \"+this.Fu+\" ms, delay with jitter: \"+n+\" ms, last attempt: \"+r+\" ms ago)\"),this.Ou=this.Zr.Tr(this.fs,i,function(){return e.ku=Date.now(),t()}),this.Fu*=this.Nu,this.Fu<this.xu&&(this.Fu=this.xu),this.Fu>this.$u&&(this.Fu=this.$u)},t.prototype.qu=function(){null!==this.Ou&&(this.Ou.Rs(),this.Ou=null)},t.prototype.cancel=function(){null!==this.Ou&&(this.Ou.cancel(),this.Ou=null)},t.prototype.Bu=function(){return(Math.random()-.5)*this.Fu},t}(),Oo=function(){function t(t,e,n,r,i,o){this.Zr=t,this.Uu=n,this.Qu=r,this.Ku=i,this.listener=o,this.state=0,this.Wu=0,this.ju=null,this.stream=null,this.Gu=new ko(t,e)}return t.prototype.zu=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.Hu=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.Ju()},t.prototype.stop=function(){return(0,i.__awaiter)(this,void 0,void 0,function(){return(0,i.__generator)(this,function(t){switch(t.label){case 0:return this.zu()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.Yu=function(){this.state=0,this.Gu.reset()},t.prototype.Xu=function(){var t=this;this.Hu()&&null===this.ju&&(this.ju=this.Zr.Tr(this.Uu,6e4,function(){return t.Zu()}))},t.prototype.th=function(t){this.eh(),this.stream.send(t)},t.prototype.Zu=function(){return(0,i.__awaiter)(this,void 0,void 0,function(){return(0,i.__generator)(this,function(t){return this.Hu()?[2,this.close(0)]:[2]})})},t.prototype.eh=function(){this.ju&&(this.ju.cancel(),this.ju=null)},t.prototype.close=function(t,e){return(0,i.__awaiter)(this,void 0,void 0,function(){return(0,i.__generator)(this,function(n){switch(n.label){case 0:return this.eh(),this.Gu.cancel(),this.Wu++,3!==t?this.Gu.reset():e&&e.code===E.RESOURCE_EXHAUSTED?(f(e.toString()),f(\"Using maximum backoff delay to prevent overloading the backend.\"),this.Gu.Mu()):e&&e.code===E.UNAUTHENTICATED&&this.Ku.p(),null!==this.stream&&(this.nh(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Tu(e)];case 1:return n.sent(),[2]}})})},t.prototype.nh=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.sh(this.Wu),n=this.Wu;this.Ku.getToken().then(function(e){t.Wu===n&&t.ih(e)},function(n){e(function(){var e=new T(E.UNKNOWN,\"Fetching auth token failed: \"+n.message);return t.rh(e)})})},t.prototype.ih=function(t){var e=this,n=this.sh(this.Wu);this.stream=this.oh(t),this.stream.wu(function(){n(function(){return e.state=2,e.listener.wu()})}),this.stream.Tu(function(t){n(function(){return e.rh(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},t.prototype.Ju=function(){var t=this;this.state=4,this.Gu.Lu(function(){return(0,i.__awaiter)(t,void 0,void 0,function(){return(0,i.__generator)(this,function(t){return this.state=0,this.start(),[2]})})})},t.prototype.rh=function(t){return h(\"PersistentStream\",\"close with error: \"+t),this.stream=null,this.close(3,t)},t.prototype.sh=function(t){var e=this;return function(n){e.Zr.Ps(function(){return e.Wu===t?n():(h(\"PersistentStream\",\"stream callback skipped by getCloseGuardedDispatcher.\"),Promise.resolve())})}},t}(),Po=function(t){function e(e,n,r,i,o){var u=this;return(u=t.call(this,e,\"listen_stream_connection_backoff\",\"listen_stream_idle\",n,r,o)||this).Qt=i,u}return(0,i.__extends)(e,t),e.prototype.oh=function(t){return this.Qu.Cu(\"Listen\",t)},e.prototype.onMessage=function(t){this.Gu.reset();var e=function(t,e){var n;if(\"targetChange\"in e){e.targetChange;var r=function(t){return\"NO_CHANGE\"===t?0:\"ADD\"===t?1:\"REMOVE\"===t?2:\"CURRENT\"===t?3:\"RESET\"===t?4:d()}(e.targetChange.targetChangeType||\"NO_CHANGE\"),i=e.targetChange.targetIds||[],o=function(t,e){return t.Bt?(v(void 0===e||\"string\"==typeof e),I.fromBase64String(e||\"\")):(v(void 0===e||e instanceof Uint8Array),I.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),u=(s=e.targetChange.cause)&&function(t){var e=void 0===t.code?E.UNKNOWN:je(t.code);return new T(e,t.message||\"\")}(s);n=new ln(r,i,o,u||null)}else if(\"documentChange\"in e){e.documentChange,(r=e.documentChange).document,r.document.name,r.document.updateTime,i=An(t,r.document.name),o=En(r.document.updateTime);var s=new pt({mapValue:{fields:r.document.fields}}),a=(u=new gt(i,o,s,{}),r.targetIds||[]),c=r.removedTargetIds||[];n=new hn(a,c,u.key,u)}else if(\"documentDelete\"in e)e.documentDelete,(r=e.documentDelete).document,i=An(t,r.document),o=r.readTime?En(r.readTime):L.min(),s=new mt(i,o),u=r.removedTargetIds||[],n=new hn([],u,s.key,s);else if(\"documentRemove\"in e)e.documentRemove,(r=e.documentRemove).document,i=An(t,r.document),o=r.removedTargetIds||[],n=new hn([],o,i,null);else{if(!(\"filter\"in e))return d();e.filter;var h=e.filter;h.targetId,r=h.count||0,i=new qe(r),o=h.targetId,n=new fn(o,i)}return n}(this.Qt,t),n=function(t){if(!(\"targetChange\"in t))return L.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?L.min():e.readTime?En(e.readTime):L.min()}(t);return this.listener.ah(e,n)},e.prototype.uh=function(t){var e={};e.database=kn(this.Qt),e.addTarget=function(t,e){var n,r=e.target;return(n=Tt(r)?{documents:Rn(t,r)}:{query:Un(t,r)}).targetId=e.targetId,e.resumeToken.l()>0?n.resumeToken=bn(t,e.resumeToken):e.Ot._(L.min())>0&&(n.readTime=wn(t,e.Ot.j())),n}(this.Qt,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return\"existence-filter-mismatch\";case 2:return\"limbo-document\";default:return d()}}(0,e.Ft);return null==n?null:{\"goog-listen-tags\":n}}(this.Qt,t);n&&(e.labels=n),this.th(e)},e.prototype.hh=function(t){var e={};e.database=kn(this.Qt),e.removeTarget=t,this.th(e)},e}(Oo),Vo=function(t){function e(e,n,r,i,o){var u=this;return(u=t.call(this,e,\"write_stream_connection_backoff\",\"write_stream_idle\",n,r,o)||this).Qt=i,u.lh=!1,u}return(0,i.__extends)(e,t),Object.defineProperty(e.prototype,\"_h\",{get:function(){return this.lh},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.lh=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},e.prototype.nh=function(){this.lh&&this.fh([])},e.prototype.oh=function(t){return this.Qu.Cu(\"Write\",t)},e.prototype.onMessage=function(t){if(v(!!t.streamToken),this.lastStreamToken=t.streamToken,this.lh){this.Gu.reset();var e=function(t,e){return t&&t.length>0?(v(void 0!==e),t.map(function(t){return function(t,e){var n=t.updateTime?En(t.updateTime):En(e);n.isEqual(L.min())&&(n=En(e));var r=null;return t.transformResults&&t.transformResults.length>0&&(r=t.transformResults),new we(n,r)}(t,e)})):[]}(t.writeResults,t.commitTime),n=En(t.commitTime);return this.listener.dh(n,e)}return v(!t.writeResults||0===t.writeResults.length),this.lh=!0,this.listener.wh()},e.prototype.Eh=function(){var t={};t.database=kn(this.Qt),this.th(t)},e.prototype.fh=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map(function(t){return Ln(e.Qt,t)})};this.th(n)},e}(Oo),Lo=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.Qu=n,i.Qt=r,i.Th=!1,i}return(0,i.__extends)(e,t),e.prototype.Ih=function(){if(this.Th)throw new T(E.FAILED_PRECONDITION,\"The client has already been terminated.\")},e.prototype.pu=function(t,e,n){var r=this;return this.Ih(),this.credentials.getToken().then(function(i){return r.Qu.pu(t,e,n,i)}).catch(function(t){throw t.code===E.UNAUTHENTICATED&&r.credentials.p(),t})},e.prototype.Du=function(t,e,n){var r=this;return this.Ih(),this.credentials.getToken().then(function(i){return r.Qu.Du(t,e,n,i)}).catch(function(t){throw t.code===E.UNAUTHENTICATED&&r.credentials.p(),t})},e.prototype.terminate=function(){this.Th=!1},e}(function(){}),Co=function(){function t(t,e){this._s=t,this.fa=e,this.state=\"Unknown\",this.mh=0,this.Ah=null,this.Rh=!0}return t.prototype.Ph=function(){var t=this;0===this.mh&&(this.yh(\"Unknown\"),this.Ah=this._s.Tr(\"online_state_timeout\",1e4,function(){return t.Ah=null,t.gh(\"Backend didn't respond within 10 seconds.\"),t.yh(\"Offline\"),Promise.resolve()}))},t.prototype.Vh=function(t){\"Online\"===this.state?this.yh(\"Unknown\"):(this.mh++,this.mh>=1&&(this.ph(),this.gh(\"Connection failed 1 times. Most recent error: \"+t.toString()),this.yh(\"Offline\")))},t.prototype.set=function(t){this.ph(),this.mh=0,\"Online\"===t&&(this.Rh=!1),this.yh(t)},t.prototype.yh=function(t){t!==this.state&&(this.state=t,this.fa(t))},t.prototype.gh=function(t){var e=\"Could not reach Cloud Firestore backend. \"+t+\"\\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.\";this.Rh?(f(e),this.Rh=!1):h(\"OnlineStateTracker\",e)},t.prototype.ph=function(){null!==this.Ah&&(this.Ah.cancel(),this.Ah=null)},t}(),Ro=function(t,e,n,r,o){var u=this;this.bh=t,this.Sh=e,this._s=n,this.Dh={},this.Ch=[],this.xh=new Map,this.Nh=new Set,this.$h=[],this.Fh=o,this.Fh.ou(function(t){n.Ps(function(){return(0,i.__awaiter)(u,void 0,void 0,function(){return(0,i.__generator)(this,function(t){switch(t.label){case 0:return Qo(this)?(h(\"RemoteStore\",\"Restarting streams for network reachability change.\"),[4,function(t){return(0,i.__awaiter)(this,void 0,void 0,function(){var e;return(0,i.__generator)(this,function(n){switch(n.label){case 0:return(e=y(t)).Nh.add(4),[4,Mo(e)];case 1:return n.sent(),e.Oh.set(\"Unknown\"),e.Nh.delete(4),[4,Uo(e)];case 2:return n.sent(),[2]}})})}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.Oh=new Co(n,r)};function Uo(t){return(0,i.__awaiter)(this,void 0,void 0,function(){var e,n;return(0,i.__generator)(this,function(r){switch(r.label){case 0:if(!Qo(t))return[3,4];e=0,n=t.$h,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function Mo(t){return(0,i.__awaiter)(this,void 0,void 0,function(){var e,n;return(0,i.__generator)(this,function(r){switch(r.label){case 0:e=0,n=t.$h,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function qo(t,e){var n=y(t);n.xh.has(e.targetId)||(n.xh.set(e.targetId,e),Bo(n)?Go(n):uu(n).Hu()&&jo(n,e))}function Fo(t,e){var n=y(t),r=uu(n);n.xh.delete(e),r.Hu()&&zo(n,e),0===n.xh.size&&(r.Hu()?r.Xu():Qo(n)&&n.Oh.set(\"Unknown\"))}function jo(t,e){t.kh.on(e.targetId),uu(t).uh(e)}function zo(t,e){t.kh.on(e),uu(t).hh(e)}function Go(t){t.kh=new dn({vn:function(e){return t.Dh.vn(e)},Sn:function(e){return t.xh.get(e)||null}}),uu(t).start(),t.Oh.Ph()}function Bo(t){return Qo(t)&&!uu(t).zu()&&t.xh.size>0}function Qo(t){return 0===y(t).Nh.size}function Yo(t){t.kh=void 0}function Ho(t){return(0,i.__awaiter)(this,void 0,void 0,function(){return(0,i.__generator)(this,function(e){return t.xh.forEach(function(e,n){jo(t,e)}),[2]})})}function Ko(t,e){return(0,i.__awaiter)(this,void 0,void 0,function(){return(0,i.__generator)(this,function(n){return Yo(t),Bo(t)?(t.Oh.Vh(e),Go(t)):t.Oh.set(\"Unknown\"),[2]})})}function Xo(t,e,n){return(0,i.__awaiter)(this,void 0,void 0,function(){var r,o,u;return(0,i.__generator)(this,function(s){switch(s.label){case 0:if(t.Oh.set(\"Online\"),!(e instanceof ln&&2===e.state&&e.cause))return[3,6];s.label=1;case 1:return s.trys.push([1,3,,5]),[4,function(t,e){return(0,i.__awaiter)(this,void 0,void 0,function(){var n,r,o,u;return(0,i.__generator)(this,function(i){switch(i.label){case 0:n=e.cause,r=0,o=e.targetIds,i.label=1;case 1:return r<o.length?(u=o[r],t.xh.has(u)?[4,t.Dh.Mh(u,n)]:[3,3]):[3,5];case 2:i.sent(),t.xh.delete(u),t.kh.removeTarget(u),i.label=3;case 3:i.label=4;case 4:return r++,[3,1];case 5:return[2]}})})}(t,e)];case 2:return s.sent(),[3,5];case 3:return r=s.sent(),h(\"RemoteStore\",\"Failed to remove targets %s: %s \",e.targetIds.join(\",\"),r),[4,Wo(t,r)];case 4:return s.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof hn?t.kh.dn(e):e instanceof fn?t.kh.Pn(e):t.kh.Tn(e),n.isEqual(L.min()))return[3,13];s.label=7;case 7:return s.trys.push([7,11,,13]),[4,Gi(t.bh)];case 8:return o=s.sent(),n._(o)>=0?[4,function(t,e){var n=t.kh.Vn(e);return n.$e.forEach(function(n,r){if(n.resumeToken.l()>0){var i=t.xh.get(r);i&&t.xh.set(r,i.Mt(n.resumeToken,e))}}),n.Fe.forEach(function(e){var n=t.xh.get(e);if(n){t.xh.set(e,n.Mt(I.T,n.Ot)),zo(t,e);var r=new re(n.target,e,1,n.sequenceNumber);jo(t,r)}}),t.Dh.Lh(n)}(t,n)]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,13];case 11:return h(\"RemoteStore\",\"Failed to raise snapshot:\",u=s.sent()),[4,Wo(t,u)];case 12:return s.sent(),[3,13];case 13:return[2]}})})}function Wo(t,e,n){return(0,i.__awaiter)(this,void 0,void 0,function(){var r=this;return(0,i.__generator)(this,function(o){switch(o.label){case 0:if(!nr(e))throw e;return t.Nh.add(1),[4,Mo(t)];case 1:return o.sent(),t.Oh.set(\"Offline\"),n||(n=function(){return Gi(t.bh)}),t._s.po(function(){return(0,i.__awaiter)(r,void 0,void 0,function(){return(0,i.__generator)(this,function(e){switch(e.label){case 0:return h(\"RemoteStore\",\"Retrying IndexedDB access\"),[4,n()];case 1:return e.sent(),t.Nh.delete(1),[4,Uo(t)];case 2:return e.sent(),[2]}})})}),[2]}})})}function Zo(t,e){return e().catch(function(n){return Wo(t,n,e)})}function Jo(t){return(0,i.__awaiter)(this,void 0,void 0,function(){var e,n,r,o,u;return(0,i.__generator)(this,function(i){switch(i.label){case 0:e=y(t),n=su(e),r=e.Ch.length>0?e.Ch[e.Ch.length-1].batchId:-1,i.label=1;case 1:if(!function(t){return Qo(t)&&t.Ch.length<10}(e))return[3,7];i.label=2;case 2:return i.trys.push([2,4,,6]),[4,Yi(e.bh,r)];case 3:return null===(o=i.sent())?(0===e.Ch.length&&n.Xu(),[3,7]):(r=o.batchId,function(t,e){t.Ch.push(e);var n=su(t);n.Hu()&&n._h&&n.fh(e.mutations)}(e,o),[3,6]);case 4:return u=i.sent(),[4,Wo(e,u)];case 5:return i.sent(),[3,6];case 6:return[3,1];case 7:return $o(e)&&tu(e),[2]}})})}function $o(t){return Qo(t)&&!su(t).zu()&&t.Ch.length>0}function tu(t){su(t).start()}function eu(t){return(0,i.__awaiter)(this,void 0,void 0,function(){return(0,i.__generator)(this,function(e){return su(t).Eh(),[2]})})}function nu(t){return(0,i.__awaiter)(this,void 0,void 0,function(){var e,n,r,o;return(0,i.__generator)(this,function(i){for(e=su(t),n=0,r=t.Ch;n<r.length;n++)o=r[n],e.fh(o.mutations);return[2]})})}function ru(t,e,n){return(0,i.__awaiter)(this,void 0,void 0,function(){var r,o;return(0,i.__generator)(this,function(i){switch(i.label){case 0:return r=t.Ch.shift(),o=Cr.from(r,e,n),[4,Zo(t,function(){return t.Dh.Bh(o)})];case 1:return i.sent(),[4,Jo(t)];case 2:return i.sent(),[2]}})})}function iu(t,e){return(0,i.__awaiter)(this,void 0,void 0,function(){return(0,i.__generator)(this,function(n){switch(n.label){case 0:return e&&su(t)._h?[4,function(t,e){return(0,i.__awaiter)(this,void 0,void 0,function(){var n,r;return(0,i.__generator)(this,function(i){switch(i.label){case 0:return Fe(r=e.code)&&r!==E.ABORTED?(n=t.Ch.shift(),su(t).Yu(),[4,Zo(t,function(){return t.Dh.qh(n.batchId,e)})]):[3,3];case 1:return i.sent(),[4,Jo(t)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return $o(t)&&tu(t),[2]}})})}function ou(t,e){return(0,i.__awaiter)(this,void 0,void 0,function(){var n;return(0,i.__generator)(this,function(r){switch(r.label){case 0:return n=y(t),e?(n.Nh.delete(2),[4,Uo(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.Nh.add(2),[4,Mo(n)]);case 3:r.sent(),n.Oh.set(\"Unknown\"),r.label=4;case 4:r.label=5;case 5:return[2]}})})}function uu(t){var e=this;return t.Uh||(t.Uh=function(t,e,n){var r=y(t);return r.Ih(),new Po(e,r.Qu,r.credentials,r.Qt,n)}(t.Sh,t._s,{wu:Ho.bind(null,t),Tu:Ko.bind(null,t),ah:Xo.bind(null,t)}),t.$h.push(function(n){return(0,i.__awaiter)(e,void 0,void 0,function(){return(0,i.__generator)(this,function(e){switch(e.label){case 0:return n?(t.Uh.Yu(),Bo(t)?Go(t):t.Oh.set(\"Unknown\"),[3,3]):[3,1];case 1:return[4,t.Uh.stop()];case 2:e.sent(),Yo(t),e.label=3;case 3:return[2]}})})})),t.Uh}function su(t){var e=this;return t.Qh||(t.Qh=function(t,e,n){var r=y(t);return r.Ih(),new Vo(e,r.Qu,r.credentials,r.Qt,n)}(t.Sh,t._s,{wu:eu.bind(null,t),Tu:iu.bind(null,t),wh:nu.bind(null,t),dh:ru.bind(null,t)}),t.$h.push(function(n){return(0,i.__awaiter)(e,void 0,void 0,function(){return(0,i.__generator)(this,function(e){switch(e.label){case 0:return n?(t.Qh.Yu(),[4,Jo(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.Qh.stop()];case 3:e.sent(),t.Ch.length>0&&(h(\"RemoteStore\",\"Stopping write stream with \"+t.Ch.length+\" pending writes\"),t.Ch=[]),e.label=4;case 4:return[2]}})})})),t.Qh}var au=function(){this.Kh=void 0,this.listeners=[]},cu=function(){this.queries=new ri(function(t){return Jt(t)},Zt),this.onlineState=\"Unknown\",this.Wh=new Set};function hu(t,e){return(0,i.__awaiter)(this,void 0,void 0,function(){var n,r,o,u,s,a,c;return(0,i.__generator)(this,function(i){switch(i.label){case 0:if(n=y(t),r=e.query,o=!1,(u=n.queries.get(r))||(o=!0,u=new au),!o)return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),s=u,[4,n.jh(r)];case 2:return s.Kh=i.sent(),[3,4];case 3:return a=i.sent(),c=ar(a,\"Initialization of query '\"+$t(e.query)+\"' failed\"),[2,void e.onError(c)];case 4:return n.queries.set(r,u),u.listeners.push(e),e.Gh(n.onlineState),u.Kh&&e.zh(u.Kh)&&du(n),[2]}})})}function fu(t,e){return(0,i.__awaiter)(this,void 0,void 0,function(){var n,r,o,u,s;return(0,i.__generator)(this,function(i){return n=y(t),r=e.query,o=!1,(u=n.queries.get(r))&&(s=u.listeners.indexOf(e))>=0&&(u.listeners.splice(s,1),o=0===u.listeners.length),o?[2,(n.queries.delete(r),n.Hh(r))]:[2]})})}function lu(t,e){for(var n=y(t),r=!1,i=0,o=e;i<o.length;i++){var u=o[i],s=u.query,a=n.queries.get(s);if(a){for(var c=0,h=a.listeners;c<h.length;c++)h[c].zh(u)&&(r=!0);a.Kh=u}}r&&du(n)}function pu(t,e,n){var r=y(t),i=r.queries.get(e);if(i)for(var o=0,u=i.listeners;o<u.length;o++)u[o].onError(n);r.queries.delete(e)}function du(t){t.Wh.forEach(function(t){t.next()})}var vu=function(){function t(t,e,n){this.query=t,this.Jh=e,this.Yh=!1,this.Xh=null,this.onlineState=\"Unknown\",this.options=n||{}}return t.prototype.zh=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new sn(t.query,t.docs,t.Se,e,t.De,t.fromCache,t.Ce,!0)}var o=!1;return this.Yh?this.Zh(t)&&(this.Jh.next(t),o=!0):this.tl(t,this.onlineState)&&(this.el(t),o=!0),this.Xh=t,o},t.prototype.onError=function(t){this.Jh.error(t)},t.prototype.Gh=function(t){this.onlineState=t;var e=!1;return this.Xh&&!this.Yh&&this.tl(this.Xh,t)&&(this.el(this.Xh),e=!0),e},t.prototype.tl=function(t,e){if(!t.fromCache)return!0;var n=\"Offline\"!==e;return!(this.options.nl&&n||t.docs.et()&&\"Offline\"!==e)},t.prototype.Zh=function(t){if(t.docChanges.length>0)return!0;var e=this.Xh&&this.Xh.hasPendingWrites!==t.hasPendingWrites;return!(!t.Ce&&!e)&&!0===this.options.includeMetadataChanges},t.prototype.el=function(t){t=sn.Ne(t.query,t.docs,t.De,t.fromCache),this.Yh=!0,this.Jh.next(t)},t}(),yu=function(){function t(t,e){this.payload=t,this.byteLength=e}return t.prototype.sl=function(){return\"metadata\"in this.payload},t}(),gu=function(){function t(t){this.Qt=t}return t.prototype.Pc=function(t){return An(this.Qt,t)},t.prototype.yc=function(t){return t.metadata.exists?Vn(this.Qt,t.document,!1):new mt(this.Pc(t.metadata.name),this.gc(t.metadata.readTime))},t.prototype.gc=function(t){return En(t)},t}(),mu=function(){function t(t,e,n){this.il=t,this.bh=e,this.Qt=n,this.queries=[],this.documents=[],this.progress=_u(t)}return t.prototype.rl=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},t.prototype.ol=function(t){for(var e=new Map,n=new gu(this.Qt),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var u=n.Pc(o.metadata.name),s=0,a=o.metadata.queries;s<a.length;s++){var c=a[s],h=(e.get(c)||en()).add(u);e.set(c,h)}}return e},t.prototype.complete=function(){return(0,i.__awaiter)(this,void 0,void 0,function(){var t,e,n,r,o;return(0,i.__generator)(this,function(i){switch(i.label){case 0:return[4,$i(this.bh,new gu(this.Qt),this.documents,this.il.id)];case 1:t=i.sent(),e=this.ol(this.documents),n=0,r=this.queries,i.label=2;case 2:return n<r.length?(o=r[n],[4,to(this.bh,o,e.get(o.name))]):[3,5];case 3:i.sent(),i.label=4;case 4:return n++,[3,2];case 5:return[2,(this.progress.taskState=\"Success\",new Ci(Object.assign({},this.progress),t))]}})})},t}();function _u(t){return{taskState:\"Running\",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}var wu=function(t){this.key=t},bu=function(t){this.key=t},Iu=function(){function t(t,e){this.query=t,this.cl=e,this.al=null,this.Be=!1,this.ul=en(),this.De=en(),this.hl=ee(t),this.ll=new on(this.hl)}return Object.defineProperty(t.prototype,\"_l\",{get:function(){return this.cl},enumerable:!1,configurable:!0}),t.prototype.fl=function(t,e){var n=this,r=e?e.dl:new un,i=e?e.ll:this.ll,o=e?e.De:this.De,u=i,s=!1,a=Gt(this.query)&&i.size===this.query.limit?i.last():null,c=Bt(this.query)&&i.size===this.query.limit?i.first():null;if(t.Xt(function(t,e){var h=i.get(t),f=e instanceof gt?e:null;f&&(f=te(n.query,f)?f:null);var l=!!h&&n.De.has(h.key),p=!!f&&(f.Vt||n.De.has(f.key)&&f.hasCommittedMutations),d=!1;h&&f?h.data().isEqual(f.data())?l!==p&&(r.track({type:3,doc:f}),d=!0):n.wl(h,f)||(r.track({type:2,doc:f}),d=!0,(a&&n.hl(f,a)>0||c&&n.hl(f,c)<0)&&(s=!0)):!h&&f?(r.track({type:0,doc:f}),d=!0):h&&!f&&(r.track({type:1,doc:h}),d=!0,(a||c)&&(s=!0)),d&&(f?(u=u.add(f),o=p?o.add(t):o.delete(t)):(u=u.delete(t),o=o.delete(t)))}),Gt(this.query)||Bt(this.query))for(;u.size>this.query.limit;){var h=Gt(this.query)?u.last():u.first();u=u.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{ll:u,dl:r,lc:s,De:o}},t.prototype.wl=function(t,e){return t.Vt&&e.hasCommittedMutations&&!e.Vt},t.prototype.wi=function(t,e,n){var r=this,i=this.ll;this.ll=t.ll,this.De=t.De;var o=t.dl.ve();o.sort(function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return d()}};return n(t)-n(e)}(t.type,e.type)||r.hl(t.doc,e.doc)}),this.El(n);var u=e?this.Tl():[],s=0===this.ul.size&&this.Be?1:0,a=s!==this.al;return this.al=s,0!==o.length||a?{snapshot:new sn(this.query,t.ll,i,o,t.De,0===s,a,!1),Il:u}:{Il:u}},t.prototype.Gh=function(t){return this.Be&&\"Offline\"===t?(this.Be=!1,this.wi({ll:this.ll,dl:new un,De:this.De,lc:!1},!1)):{Il:[]}},t.prototype.ml=function(t){return!this.cl.has(t)&&!!this.ll.has(t)&&!this.ll.get(t).Vt},t.prototype.El=function(t){var e=this;t&&(t.qe.forEach(function(t){return e.cl=e.cl.add(t)}),t.Ue.forEach(function(t){}),t.Qe.forEach(function(t){return e.cl=e.cl.delete(t)}),this.Be=t.Be)},t.prototype.Tl=function(){var t=this;if(!this.Be)return[];var e=this.ul;this.ul=en(),this.ll.forEach(function(e){t.ml(e.key)&&(t.ul=t.ul.add(e.key))});var n=[];return e.forEach(function(e){t.ul.has(e)||n.push(new bu(e))}),this.ul.forEach(function(t){e.has(t)||n.push(new wu(t))}),n},t.prototype.Al=function(t){this.cl=t.Rc,this.ul=en();var e=this.fl(t.documents);return this.wi(e,!0)},t.prototype.Rl=function(){return sn.Ne(this.query,this.ll,this.De,0===this.al)},t}(),Eu=function(t,e,n){this.query=t,this.targetId=e,this.view=n},Tu=function(t){this.key=t,this.Pl=!1},xu=function(){function t(t,e,n,r,i,o){this.bh=t,this.yl=e,this.gl=n,this.Vl=r,this.currentUser=i,this.pl=o,this.bl={},this.vl=new ri(function(t){return Jt(t)},Zt),this.Sl=new Map,this.Dl=new Set,this.Cl=new ze(q.H),this.xl=new Map,this.Nl=new no,this.$l={},this.Fl=new Map,this.Ol=li.Li(),this.onlineState=\"Unknown\",this.kl=void 0}return Object.defineProperty(t.prototype,\"Ml\",{get:function(){return!0===this.kl},enumerable:!1,configurable:!0}),t}();function Nu(t,e){return(0,i.__awaiter)(this,void 0,void 0,function(){var n,r,o,u,s,a;return(0,i.__generator)(this,function(i){switch(i.label){case 0:return n=es(t),(u=n.vl.get(e))?(r=u.targetId,n.Vl.Fa(r),o=u.view.Rl(),[3,4]):[3,1];case 1:return[4,Hi(n.bh,Xt(e))];case 2:return s=i.sent(),a=n.Vl.Fa(s.targetId),r=s.targetId,[4,Au(n,e,r,\"current\"===a)];case 3:o=i.sent(),n.Ml&&qo(n.yl,s),i.label=4;case 4:return[2,o]}})})}function Au(t,e,n,r){return(0,i.__awaiter)(this,void 0,void 0,function(){var o,u,s,a,c,h;return(0,i.__generator)(this,function(f){switch(f.label){case 0:return t.Ll=function(e,n,r){return function(t,e,n,r){return(0,i.__awaiter)(this,void 0,void 0,function(){var o,u,s;return(0,i.__generator)(this,function(i){switch(i.label){case 0:return(o=e.view.fl(n)).lc?[4,Xi(t.bh,e.query,!1).then(function(t){var n=t.documents;return e.view.fl(n,o)})]:[3,2];case 1:o=i.sent(),i.label=2;case 2:return u=r&&r.$e.get(e.targetId),s=e.view.wi(o,t.Ml,u),[2,(Fu(t,e.targetId,s.Il),s.snapshot)]}})})}(t,e,n,r)},[4,Xi(t.bh,e,!0)];case 1:return o=f.sent(),u=new Iu(e,o.Rc),s=u.fl(o.documents),a=cn.Le(n,r&&\"Offline\"!==t.onlineState),c=u.wi(s,t.Ml,a),Fu(t,n,c.Il),h=new Eu(e,n,u),[2,(t.vl.set(e,h),t.Sl.has(n)?t.Sl.get(n).push(e):t.Sl.set(n,[e]),c.snapshot)]}})})}function Su(t,e){return(0,i.__awaiter)(this,void 0,void 0,function(){var n,r,o;return(0,i.__generator)(this,function(i){switch(i.label){case 0:return n=y(t),r=n.vl.get(e),(o=n.Sl.get(r.targetId)).length>1?[2,(n.Sl.set(r.targetId,o.filter(function(t){return!Zt(t,e)})),void n.vl.delete(e))]:n.Ml?(n.Vl.ka(r.targetId),n.Vl.Da(r.targetId)?[3,2]:[4,Ki(n.bh,r.targetId,!1).then(function(){n.Vl.La(r.targetId),Fo(n.yl,r.targetId),Mu(n,r.targetId)}).catch(ni)]):[3,3];case 1:i.sent(),i.label=2;case 2:return[3,5];case 3:return Mu(n,r.targetId),[4,Ki(n.bh,r.targetId,!0)];case 4:i.sent(),i.label=5;case 5:return[2]}})})}function Du(t,e,n){return(0,i.__awaiter)(this,void 0,void 0,function(){var r,o,u,s;return(0,i.__generator)(this,function(i){switch(i.label){case 0:r=ns(t),i.label=1;case 1:return i.trys.push([1,5,,6]),[4,function(t,e){var n,r=y(t),i=V.now(),o=e.reduce(function(t,e){return t.add(e.key)},en());return r.persistence.runTransaction(\"Locally write mutations\",\"readwrite\",function(t){return r.Tc.Xo(t,o).next(function(o){n=o;for(var u=[],s=0,a=e;s<a.length;s++){var c=a[s],h=Ne(c,n.get(c.key));null!=h&&u.push(new ke(c.key,h,vt(h.proto.mapValue),be.exists(!0)))}return r.zo.Ri(t,i,u,e)})}).then(function(t){var e=t.xs(n);return{batchId:t.batchId,ri:e}})}(r.bh,e)];case 2:return o=i.sent(),r.Vl.Ca(o.batchId),function(t,e,n){var r=t.$l[t.currentUser.A()];r||(r=new ze(_)),r=r.zt(e,n),t.$l[t.currentUser.A()]=r}(r,o.batchId,n),[4,Gu(r,o.ri)];case 3:return i.sent(),[4,Jo(r.yl)];case 4:return i.sent(),[3,6];case 5:return u=i.sent(),s=ar(u,\"Failed to persist write\"),n.reject(s),[3,6];case 6:return[2]}})})}function ku(t,e){return(0,i.__awaiter)(this,void 0,void 0,function(){var n,r;return(0,i.__generator)(this,function(i){switch(i.label){case 0:n=y(t),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,Bi(n.bh,e)];case 2:return r=i.sent(),e.$e.forEach(function(t,e){var r=n.xl.get(e);r&&(v(t.qe.size+t.Ue.size+t.Qe.size<=1),t.qe.size>0?r.Pl=!0:t.Ue.size>0?v(r.Pl):t.Qe.size>0&&(v(r.Pl),r.Pl=!1))}),[4,Gu(n,r,e)];case 3:return i.sent(),[3,6];case 4:return[4,ni(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}})})}function Ou(t,e,n){var r=y(t);if(r.Ml&&0===n||!r.Ml&&1===n){var i=[];r.vl.forEach(function(t,n){var r=n.view.Gh(e);r.snapshot&&i.push(r.snapshot)}),function(t,e){var n=y(t);n.onlineState=e;var r=!1;n.queries.forEach(function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].Gh(e)&&(r=!0)}),r&&du(n)}(r.gl,e),i.length&&r.bl.ah(i),r.onlineState=e,r.Ml&&r.Vl.Qa(e)}}function Pu(t,e,n){return(0,i.__awaiter)(this,void 0,void 0,function(){var r,o,u,s,a,c;return(0,i.__generator)(this,function(i){switch(i.label){case 0:return(r=y(t)).Vl.Ba(e,\"rejected\",n),o=r.xl.get(e),(u=o&&o.key)?(s=(s=new ze(q.H)).zt(u,new mt(u,L.min())),a=en().add(u),c=new an(L.min(),new Map,new Qe(_),s,a),[4,ku(r,c)]):[3,2];case 1:return i.sent(),r.Cl=r.Cl.remove(u),r.xl.delete(e),zu(r),[3,4];case 2:return[4,Ki(r.bh,e,!1).then(function(){return Mu(r,e,n)}).catch(ni)];case 3:i.sent(),i.label=4;case 4:return[2]}})})}function Vu(t,e){return(0,i.__awaiter)(this,void 0,void 0,function(){var n,r,o;return(0,i.__generator)(this,function(i){switch(i.label){case 0:n=y(t),r=e.batch.batchId,i.label=1;case 1:return i.trys.push([1,4,,6]),[4,zi(n.bh,e)];case 2:return o=i.sent(),Uu(n,r,null),Ru(n,r),n.Vl.Na(r,\"acknowledged\"),[4,Gu(n,o)];case 3:return i.sent(),[3,6];case 4:return[4,ni(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}})})}function Lu(t,e,n){return(0,i.__awaiter)(this,void 0,void 0,function(){var r,o;return(0,i.__generator)(this,function(i){switch(i.label){case 0:r=y(t),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,function(t,e){var n=y(t);return n.persistence.runTransaction(\"Reject batch\",\"readwrite-primary\",function(t){var r;return n.zo.Pi(t,e).next(function(e){return v(null!==e),r=e.keys(),n.zo.Ci(t,e)}).next(function(){return n.zo.$i(t)}).next(function(){return n.Tc.Xo(t,r)})})}(r.bh,e)];case 2:return o=i.sent(),Uu(r,e,n),Ru(r,e),r.Vl.Na(e,\"rejected\",n),[4,Gu(r,o)];case 3:return i.sent(),[3,6];case 4:return[4,ni(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}})})}function Cu(t,e){return(0,i.__awaiter)(this,void 0,void 0,function(){var n,r,o,u,s;return(0,i.__generator)(this,function(i){switch(i.label){case 0:Qo((n=y(t)).yl)||h(\"SyncEngine\",\"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.\"),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,function(t){var e=y(n.bh);return e.persistence.runTransaction(\"Get highest unacknowledged batch id\",\"readonly\",function(t){return e.zo.Vi(t)})}()];case 2:return-1===(r=i.sent())?[2,void e.resolve()]:((o=n.Fl.get(r)||[]).push(e),n.Fl.set(r,o),[3,4]);case 3:return u=i.sent(),s=ar(u,\"Initialization of waitForPendingWrites() operation failed\"),e.reject(s),[3,4];case 4:return[2]}})})}function Ru(t,e){(t.Fl.get(e)||[]).forEach(function(t){t.resolve()}),t.Fl.delete(e)}function Uu(t,e,n){var r=y(t),i=r.$l[r.currentUser.A()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.$l[r.currentUser.A()]=i}}function Mu(t,e,n){void 0===n&&(n=null),t.Vl.ka(e);for(var r=0,i=t.Sl.get(e);r<i.length;r++){var o=i[r];t.vl.delete(o),n&&t.bl.Bl(o,n)}t.Sl.delete(e),t.Ml&&t.Nl.Fc(e).forEach(function(e){t.Nl.Fi(e)||qu(t,e)})}function qu(t,e){t.Dl.delete(e.path.rt());var n=t.Cl.get(e);null!==n&&(Fo(t.yl,n),t.Cl=t.Cl.remove(e),t.xl.delete(n),zu(t))}function Fu(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof wu?(t.Nl.nr(o.key,e),ju(t,o)):o instanceof bu?(h(\"SyncEngine\",\"Document no longer in limbo: \"+o.key),t.Nl.ir(o.key,e),t.Nl.Fi(o.key)||qu(t,o.key)):d()}}function ju(t,e){var n=e.key,r=n.path.rt();t.Cl.get(n)||t.Dl.has(r)||(h(\"SyncEngine\",\"New document in limbo: \"+n),t.Dl.add(r),zu(t))}function zu(t){for(;t.Dl.size>0&&t.Cl.size<t.pl;){var e=t.Dl.values().next().value;t.Dl.delete(e);var n=new q(R.ot(e)),r=t.Ol.next();t.xl.set(r,new Tu(n)),t.Cl=t.Cl.zt(n,r),qo(t.yl,new re(Xt(zt(n.path)),r,2,P.q))}}function Gu(t,e,n){return(0,i.__awaiter)(this,void 0,void 0,function(){var r,o,u,s;return(0,i.__generator)(this,function(a){switch(a.label){case 0:return r=y(t),o=[],u=[],s=[],r.vl.et()?[3,3]:(r.vl.forEach(function(t,i){s.push(r.Ll(i,e,n).then(function(t){if(t){r.Ml&&r.Vl.Ba(i.targetId,t.fromCache?\"not-current\":\"current\"),o.push(t);var e=Ui.oc(i.targetId,t);u.push(e)}}))}),[4,Promise.all(s)]);case 1:return a.sent(),r.bl.ah(o),[4,function(t,e){return(0,i.__awaiter)(this,void 0,void 0,function(){var n,r,o,u,s,a,c,f,l;return(0,i.__generator)(this,function(i){switch(i.label){case 0:n=y(t),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,n.persistence.runTransaction(\"notifyLocalViewChanges\",\"readwrite\",function(t){return Zn.forEach(e,function(e){return Zn.forEach(e.ic,function(r){return n.persistence.Ti.nr(t,e.targetId,r)}).next(function(){return Zn.forEach(e.rc,function(r){return n.persistence.Ti.ir(t,e.targetId,r)})})})})];case 2:return i.sent(),[3,4];case 3:if(!nr(r=i.sent()))throw r;return h(\"LocalStore\",\"Failed to update sequence numbers: \"+r),[3,4];case 4:for(o=0,u=e;o<u.length;o++)s=u[o],a=s.targetId,s.fromCache||(c=n.fc.get(a),f=c.Ot,l=c.Lt(f),n.fc=n.fc.zt(a,l));return[2]}})})}(r.bh,u)];case 2:a.sent(),a.label=3;case 3:return[2]}})})}function Bu(t,e){return(0,i.__awaiter)(this,void 0,void 0,function(){var n,r;return(0,i.__generator)(this,function(i){switch(i.label){case 0:return(n=y(t)).currentUser.isEqual(e)?[3,3]:(h(\"SyncEngine\",\"User change. New user:\",e.A()),[4,ji(n.bh,e)]);case 1:return r=i.sent(),n.currentUser=e,function(t,e){t.Fl.forEach(function(t){t.forEach(function(t){t.reject(new T(E.CANCELLED,\"'waitForPendingWrites' promise is rejected due to a user change.\"))})}),t.Fl.clear()}(n),n.Vl.Ua(e,r.mc,r.Ac),[4,Gu(n,r.Ic)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}function Qu(t,e){var n=y(t),r=n.xl.get(e);if(r&&r.Pl)return en().add(r.key);var i=en(),o=n.Sl.get(e);if(!o)return i;for(var u=0,s=o;u<s.length;u++){var a=s[u],c=n.vl.get(a);i=i.Pe(c.view._l)}return i}function Yu(t,e){return(0,i.__awaiter)(this,void 0,void 0,function(){var n,r,o;return(0,i.__generator)(this,function(i){switch(i.label){case 0:return[4,Xi((n=y(t)).bh,e.query,!0)];case 1:return r=i.sent(),o=e.view.Al(r),[2,(n.Ml&&Fu(n,e.targetId,o.Il),o)]}})})}function Hu(t){return(0,i.__awaiter)(this,void 0,void 0,function(){var e;return(0,i.__generator)(this,function(n){return[2,Zi((e=y(t)).bh).then(function(t){return Gu(e,t)})]})})}function Ku(t,e,n,r){return(0,i.__awaiter)(this,void 0,void 0,function(){var o,u;return(0,i.__generator)(this,function(i){switch(i.label){case 0:return[4,function(t,e){var n=y(t),r=y(n.zo);return n.persistence.runTransaction(\"Lookup mutation documents\",\"readonly\",function(t){return r.yi(t,e).next(function(e){return e?n.Tc.Xo(t,e):Zn.resolve(null)})})}((o=y(t)).bh,e)];case 1:return null===(u=i.sent())?[3,6]:\"pending\"!==n?[3,3]:[4,Jo(o.yl)];case 2:return i.sent(),[3,4];case 3:\"acknowledged\"===n||\"rejected\"===n?(Uu(o,e,r||null),Ru(o,e),function(t,e){y(y(t).zo).xi(e)}(o.bh,e)):d(),i.label=4;case 4:return[4,Gu(o,u)];case 5:return i.sent(),[3,7];case 6:h(\"SyncEngine\",\"Cannot apply mutation batch with id: \"+e),i.label=7;case 7:return[2]}})})}function Xu(t,e){return(0,i.__awaiter)(this,void 0,void 0,function(){var n,r,o,u,s,a,c,h;return(0,i.__generator)(this,function(i){switch(i.label){case 0:return es(n=y(t)),ns(n),!0!==e||!0===n.kl?[3,3]:(r=n.Vl.va(),[4,Wu(n,r.it())]);case 1:return o=i.sent(),n.kl=!0,[4,ou(n.yl,!0)];case 2:for(i.sent(),u=0,s=o;u<s.length;u++)a=s[u],qo(n.yl,a);return[3,7];case 3:return!1!==e||!1===n.kl?[3,7]:(c=[],h=Promise.resolve(),n.Sl.forEach(function(t,e){n.Vl.Ma(e)?c.push(e):h=h.then(function(){return Mu(n,e),Ki(n.bh,e,!0)}),Fo(n.yl,e)}),[4,h]);case 4:return i.sent(),[4,Wu(n,c)];case 5:return i.sent(),function(t){var e=y(n);e.xl.forEach(function(t,n){Fo(e.yl,n)}),e.Nl.Oc(),e.xl=new Map,e.Cl=new ze(q.H)}(),n.kl=!1,[4,ou(n.yl,!1)];case 6:i.sent(),i.label=7;case 7:return[2]}})})}function Wu(t,e,n){return(0,i.__awaiter)(this,void 0,void 0,function(){var n,r,o,u,s,a,c,h,f,l,p,d,v,g;return(0,i.__generator)(this,function(i){switch(i.label){case 0:n=y(t),r=[],o=[],u=0,s=e,i.label=1;case 1:return u<s.length?(a=s[u],c=void 0,(h=n.Sl.get(a))&&0!==h.length?[4,Hi(n.bh,Xt(h[0]))]:[3,7]):[3,13];case 2:c=i.sent(),f=0,l=h,i.label=3;case 3:return f<l.length?(p=l[f],d=n.vl.get(p),[4,Yu(n,d)]):[3,6];case 4:(v=i.sent()).snapshot&&o.push(v.snapshot),i.label=5;case 5:return f++,[3,3];case 6:return[3,11];case 7:return[4,Wi(n.bh,a)];case 8:return g=i.sent(),[4,Hi(n.bh,g)];case 9:return c=i.sent(),[4,Au(n,Zu(g),a,!1)];case 10:i.sent(),i.label=11;case 11:r.push(c),i.label=12;case 12:return u++,[3,1];case 13:return[2,(n.bl.ah(o),r)]}})})}function Zu(t){return jt(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,\"F\",t.startAt,t.endAt)}function Ju(t){var e=y(t);return y(y(e.bh).persistence).Uo()}function $u(t,e,n,r){return(0,i.__awaiter)(this,void 0,void 0,function(){var o,u,s;return(0,i.__generator)(this,function(i){switch(i.label){case 0:return(o=y(t)).kl?(h(\"SyncEngine\",\"Ignoring unexpected query state notification.\"),[3,8]):[3,1];case 1:if(!o.Sl.has(e))return[3,8];switch(n){case\"current\":case\"not-current\":return[3,2];case\"rejected\":return[3,5]}return[3,7];case 2:return[4,Zi(o.bh)];case 3:return u=i.sent(),s=an.Me(e,\"current\"===n),[4,Gu(o,u,s)];case 4:return i.sent(),[3,8];case 5:return[4,Ki(o.bh,e,!0)];case 6:return i.sent(),Mu(o,e,r),[3,8];case 7:d(),i.label=8;case 8:return[2]}})})}function ts(t,e,n){return(0,i.__awaiter)(this,void 0,void 0,function(){var r,o,u,s,a,c,f,l,p,d;return(0,i.__generator)(this,function(v){switch(v.label){case 0:if(!(r=es(t)).kl)return[3,10];o=0,u=e,v.label=1;case 1:return o<u.length?(s=u[o],r.Sl.has(s)?(h(\"SyncEngine\",\"Adding an already active target \"+s),[3,5]):[4,Wi(r.bh,s)]):[3,6];case 2:return a=v.sent(),[4,Hi(r.bh,a)];case 3:return c=v.sent(),[4,Au(r,Zu(a),c.targetId,!1)];case 4:v.sent(),qo(r.yl,c),v.label=5;case 5:return o++,[3,1];case 6:f=function(t){return(0,i.__generator)(this,function(e){switch(e.label){case 0:return r.Sl.has(t)?[4,Ki(r.bh,t,!1).then(function(){Fo(r.yl,t),Mu(r,t)}).catch(ni)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})},l=0,p=n,v.label=7;case 7:return l<p.length?(d=p[l],[5,f(d)]):[3,10];case 8:v.sent(),v.label=9;case 9:return l++,[3,7];case 10:return[2]}})})}function es(t){var e=y(t);return e.yl.Dh.Lh=ku.bind(null,e),e.yl.Dh.vn=Qu.bind(null,e),e.yl.Dh.Mh=Pu.bind(null,e),e.bl.ah=lu.bind(null,e.gl),e.bl.Bl=pu.bind(null,e.gl),e}function ns(t){var e=y(t);return e.yl.Dh.Bh=Vu.bind(null,e),e.yl.Dh.qh=Lu.bind(null,e),e}function rs(t,e,n){var r=y(t);(function(t,e,n){return(0,i.__awaiter)(this,void 0,void 0,function(){var r,o,u,s,a,c;return(0,i.__generator)(this,function(i){switch(i.label){case 0:return i.trys.push([0,14,,15]),[4,e.getMetadata()];case 1:return r=i.sent(),[4,function(t,e){var n=y(t),r=En(e.createTime);return n.persistence.runTransaction(\"hasNewerBundle\",\"readonly\",function(t){return n.wo.Os(t,e.id)}).then(function(t){return!!t&&t.createTime._(r)>=0})}(t.bh,r)];case 2:return i.sent()?[4,e.close()]:[3,4];case 3:return[2,(i.sent(),void n.ql(function(t){return{taskState:\"Success\",documentsLoaded:t.totalDocuments,bytesLoaded:t.totalBytes,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}(r)))];case 4:return n.Ul(_u(r)),o=new mu(r,t.bh,e.Qt),[4,e.Ql()];case 5:u=i.sent(),i.label=6;case 6:return u?[4,o.rl(u)]:[3,10];case 7:return(s=i.sent())&&n.Ul(s),[4,e.Ql()];case 8:u=i.sent(),i.label=9;case 9:return[3,6];case 10:return[4,o.complete()];case 11:return a=i.sent(),[4,Gu(t,a.Go,void 0)];case 12:return i.sent(),[4,function(t,e){var n=y(t);return n.persistence.runTransaction(\"Save bundle\",\"readwrite\",function(t){return n.wo.ks(t,e)})}(t.bh,r)];case 13:return i.sent(),n.ql(a.progress),[3,15];case 14:return l(\"SyncEngine\",\"Loading bundle failed with \"+(c=i.sent())),n.Kl(c),[3,15];case 15:return[2]}})})})(r,e,n).then(function(){r.Vl.Wa()})}var is=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return(0,i.__awaiter)(this,void 0,void 0,function(){return(0,i.__generator)(this,function(e){switch(e.label){case 0:return this.Qt=Do(t.yu.t),this.Vl=this.Wl(t),this.persistence=this.jl(t),[4,this.persistence.start()];case 1:return e.sent(),this.Gl=this.zl(t),this.bh=this.Hl(t),[2]}})})},t.prototype.zl=function(t){return null},t.prototype.Hl=function(t){return Fi(this.persistence,new Mi,t.Jl,this.Qt)},t.prototype.jl=function(t){return new ao(ho.ia,this.Qt)},t.prototype.Wl=function(t){return new bo},t.prototype.terminate=function(){return(0,i.__awaiter)(this,void 0,void 0,function(){return(0,i.__generator)(this,function(t){switch(t.label){case 0:return this.Gl&&this.Gl.stop(),[4,this.Vl.ko()];case 1:return t.sent(),[4,this.persistence.ko()];case 2:return t.sent(),[2]}})})},t}(),os=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Yl=e,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return(0,i.__extends)(e,t),e.prototype.initialize=function(e){return(0,i.__awaiter)(this,void 0,void 0,function(){return(0,i.__generator)(this,function(n){switch(n.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return n.sent(),[4,Ji(this.bh)];case 2:return n.sent(),[4,this.Yl.initialize(this,e)];case 3:return n.sent(),[4,ns(this.Yl._a)];case 4:return n.sent(),[4,Jo(this.Yl.yl)];case 5:return n.sent(),[2]}})})},e.prototype.Hl=function(t){return Fi(this.persistence,new Mi,t.Jl,this.Qt)},e.prototype.zl=function(t){var e=this.persistence.Ti.lr;return new _i(e,t._s)},e.prototype.jl=function(t){var e=Li(t.yu.t,t.yu.persistenceKey),n=void 0!==this.cacheSizeBytes?ei.Ys(this.cacheSizeBytes):ei.ti;return new Oi(this.synchronizeTabs,e,t.clientId,n,t._s,Ao(),So(),this.Qt,this.Vl,!!this.forceOwnership)},e.prototype.Wl=function(t){return new bo},e}(is),us=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n,!1)||this).Yl=e,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return(0,i.__extends)(e,t),e.prototype.initialize=function(e){return(0,i.__awaiter)(this,void 0,void 0,function(){var n,r=this;return(0,i.__generator)(this,function(o){switch(o.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return o.sent(),n=this.Yl._a,this.Vl instanceof wo?(this.Vl._a={eu:Ku.bind(null,n),nu:$u.bind(null,n),su:ts.bind(null,n),Uo:Ju.bind(null,n),tu:Hu.bind(null,n)},[4,this.Vl.start()]):[3,3];case 2:o.sent(),o.label=3;case 3:return[4,this.persistence.Ro(function(t){return(0,i.__awaiter)(r,void 0,void 0,function(){return(0,i.__generator)(this,function(e){switch(e.label){case 0:return[4,Xu(this.Yl._a,t)];case 1:return e.sent(),this.Gl&&(t&&!this.Gl.Er?this.Gl.start(this.bh):t||this.Gl.stop()),[2]}})})})];case 4:return o.sent(),[2]}})})},e.prototype.Wl=function(t){var e=Ao();if(!wo.Kn(e))throw new T(E.UNIMPLEMENTED,\"IndexedDB persistence is only available on platforms that support LocalStorage.\");var n=Li(t.yu.t,t.yu.persistenceKey);return new wo(e,t._s,n,t.clientId,t.Jl)},e}(os),ss=function(){function t(){}return t.prototype.initialize=function(t,e){return(0,i.__awaiter)(this,void 0,void 0,function(){var n=this;return(0,i.__generator)(this,function(r){switch(r.label){case 0:return this.bh?[3,2]:(this.bh=t.bh,this.Vl=t.Vl,this.Sh=this.Xl(e),this.yl=this.Zl(e),this.gl=this.t_(e),this._a=this.e_(e,!t.synchronizeTabs),this.Vl.fa=function(t){return Ou(n._a,t,1)},this.yl.Dh.n_=Bu.bind(null,this._a),[4,ou(this.yl,this._a.Ml)]);case 1:r.sent(),r.label=2;case 2:return[2]}})})},t.prototype.t_=function(t){return new cu},t.prototype.Xl=function(t){var e,n=Do(t.yu.t),r=(e=t.yu,new No(e));return function(t,e,n){return new Lo(t,r,n)}(t.credentials,0,n)},t.prototype.Zl=function(t){var e,n,r,i,o,u=this;return e=this.bh,n=this.Sh,r=t._s,i=function(t){return Ou(u._a,t,0)},o=Eo.Kn()?new Eo:new Io,new Ro(e,n,r,i,o)},t.prototype.e_=function(t,e){return function(t,e,n,r,i,o,u){var s=new xu(t,e,n,r,i,o);return u&&(s.kl=!0),s}(this.bh,this.yl,this.gl,this.Vl,t.Jl,t.pl,e)},t.prototype.terminate=function(){return function(t){return(0,i.__awaiter)(this,void 0,void 0,function(){var e;return(0,i.__generator)(this,function(n){switch(n.label){case 0:return e=y(t),h(\"RemoteStore\",\"RemoteStore shutting down.\"),e.Nh.add(5),[4,Mo(e)];case 1:return n.sent(),e.Fh.ko(),e.Oh.set(\"Unknown\"),[2]}})})}(this.yl)},t}();function as(t,e){void 0===e&&(e=10240);var n=0;return{read:function(){return(0,i.__awaiter)(this,void 0,void 0,function(){var r;return(0,i.__generator)(this,function(i){return n<t.byteLength?(r={value:t.slice(n,n+e),done:!1},[2,(n+=e,r)]):[2,{done:!0}]})})},cancel:function(){return(0,i.__awaiter)(this,void 0,void 0,function(){return(0,i.__generator)(this,function(t){return[2]})})},releaseLock:function(){}}}var cs=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.s_(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.s_(this.observer.error,t):console.error(\"Uncaught Error in snapshot listener:\",t)},t.prototype.i_=function(){this.muted=!0},t.prototype.s_=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},t}(),hs=function(){function t(t,e){var n=this;this.r_=t,this.Qt=e,this.metadata=new Wn,this.buffer=new Uint8Array,this.o_=new TextDecoder(\"utf-8\"),this.c_().then(function(t){t&&t.sl()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error(\"The first element of the bundle is not a metadata, it is\\n             \"+JSON.stringify(null==t?void 0:t.payload)))},function(t){return n.metadata.reject(t)})}return t.prototype.close=function(){return this.r_.cancel()},t.prototype.getMetadata=function(){return(0,i.__awaiter)(this,void 0,void 0,function(){return(0,i.__generator)(this,function(t){return[2,this.metadata.promise]})})},t.prototype.Ql=function(){return(0,i.__awaiter)(this,void 0,void 0,function(){return(0,i.__generator)(this,function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.c_())]}})})},t.prototype.c_=function(){return(0,i.__awaiter)(this,void 0,void 0,function(){var t,e,n,r;return(0,i.__generator)(this,function(i){switch(i.label){case 0:return[4,this.a_()];case 1:return null===(t=i.sent())?[2,null]:(e=this.o_.decode(t),n=Number(e),isNaN(n)&&this.u_(\"length string (\"+e+\") is not valid number\"),[4,this.h_(n)]);case 2:return r=i.sent(),[2,new yu(JSON.parse(r),t.length+n)]}})})},t.prototype.l_=function(){return this.buffer.findIndex(function(t){return t===\"{\".charCodeAt(0)})},t.prototype.a_=function(){return(0,i.__awaiter)(this,void 0,void 0,function(){var t,e;return(0,i.__generator)(this,function(n){switch(n.label){case 0:return this.l_()<0?[4,this.__()]:[3,3];case 1:if(n.sent())return[3,3];n.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((t=this.l_())<0&&this.u_(\"Reached the end of bundle when a length string is expected.\"),e=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),e)])}})})},t.prototype.h_=function(t){return(0,i.__awaiter)(this,void 0,void 0,function(){var e;return(0,i.__generator)(this,function(n){switch(n.label){case 0:return this.buffer.length<t?[4,this.__()]:[3,3];case 1:n.sent()&&this.u_(\"Reached the end of bundle when more is expected.\"),n.label=2;case 2:return[3,0];case 3:return e=this.o_.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),e)]}})})},t.prototype.u_=function(t){throw this.r_.cancel(),new Error(\"Invalid bundle format: \"+t)},t.prototype.__=function(){return(0,i.__awaiter)(this,void 0,void 0,function(){var t,e;return(0,i.__generator)(this,function(n){switch(n.label){case 0:return[4,this.r_.read()];case 1:return(t=n.sent()).done||((e=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e),[2,t.done]}})})},t}(),fs=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new T(E.INVALID_ARGUMENT,\"Invalid field name at argument $(i + 1). Field names must not be empty.\");this.f_=new M(t)}return t.prototype.isEqual=function(t){return this.f_.isEqual(t.f_)},t}(),ls=function(t){this._methodName=t},ps=function(t){this.d_=t};function ds(t,e,n){if(!n)throw new T(E.INVALID_ARGUMENT,\"Function \"+t+\"() cannot be called with an empty \"+e+\".\")}function vs(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new T(E.INVALID_ARGUMENT,\"Invalid options passed to function \"+t+'(): You cannot specify both \"merge\" and \"mergeFields\".');return e}function ys(t,e,n,r){if(!0===e&&!0===r)throw new T(E.INVALID_ARGUMENT,t+\" and \"+n+\" cannot be used together.\")}function gs(t){if(!q.wt(t))throw new T(E.INVALID_ARGUMENT,\"Invalid document reference. Document references must have an even number of segments, but \"+t+\" has \"+t.length+\".\")}function ms(t){if(q.wt(t))throw new T(E.INVALID_ARGUMENT,\"Invalid collection reference. Collection references must have an odd number of segments, but \"+t+\" has \"+t.length+\".\")}function _s(t){if(void 0===t)return\"undefined\";if(null===t)return\"null\";if(\"string\"==typeof t)return t.length>20&&(t=t.substring(0,20)+\"...\"),JSON.stringify(t);if(\"number\"==typeof t||\"boolean\"==typeof t)return\"\"+t;if(\"object\"==o(t)){if(t instanceof Array)return\"an array\";var e=function(t){if(t.constructor){var e=/function\\s+([^\\s(]+)\\s*\\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?\"a custom \"+e+\" object\":\"an object\"}return\"function\"==typeof t?\"a function\":d()}function ws(t,e){if(\"_delegate\"in t&&(t=t.d_),!(t instanceof e)){if(e.name===t.constructor.name)throw new T(E.INVALID_ARGUMENT,\"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?\");var n=_s(t);throw new T(E.INVALID_ARGUMENT,\"Expected type '\"+e.name+\"', but it was: \"+n)}return t}function bs(t,e){if(e<=0)throw new T(E.INVALID_ARGUMENT,\"Function \"+t+\"() requires a positive number, but it was: \"+e+\".\")}var Is=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new T(E.INVALID_ARGUMENT,\"Can't provide ssl option if host option is not set\");this.host=\"firestore.googleapis.com\",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new T(E.INVALID_ARGUMENT,\"cacheSizeBytes must be at least 1048576\");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,ys(\"experimentalForceLongPolling\",t.experimentalForceLongPolling,\"experimentalAutoDetectLongPolling\",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},t}(),Es=new Map,Ts=function(){function t(t,e){this.w_=\"(lite)\",this.E_=new Is({}),this.T_=!1,t instanceof s?(this.I_=t,this.m_=new S):(this.A_=t,this.I_=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,[\"projectId\"]))throw new T(E.INVALID_ARGUMENT,'\"projectId\" not provided in firebase.initializeApp.');return new s(t.options.projectId)}(t),this.m_=new D(e))}return Object.defineProperty(t.prototype,\"app\",{get:function(){if(!this.A_)throw new T(E.FAILED_PRECONDITION,\"Firestore was not initialized using the Firebase SDK. 'app' is not available\");return this.A_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"R_\",{get:function(){return this.T_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"P_\",{get:function(){return void 0!==this.y_},enumerable:!1,configurable:!0}),t.prototype.g_=function(t){if(this.T_)throw new T(E.FAILED_PRECONDITION,\"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.\");this.E_=new Is(t),void 0!==t.credentials&&(this.m_=function(t){if(!t)return new S;switch(t.type){case\"gapi\":var e=t.client;return v(!(\"object\"!=o(e)||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new O(e,t.sessionIndex||\"0\");case\"provider\":return t.client;default:throw new T(E.INVALID_ARGUMENT,\"makeCredentialsProvider failed due to invalid credential type\")}}(t.credentials))},t.prototype.V_=function(){return this.E_},t.prototype.p_=function(){return this.T_=!0,this.E_},t.prototype._delete=function(){return this.y_||(this.y_=this.b_()),this.y_},t.prototype.toJSON=function(){return{app:this.A_,t:this.I_,settings:this.E_}},t.prototype.b_=function(){return this,(t=Es.get(this))&&(h(\"ComponentProvider\",\"Removing Datastore\"),Es.delete(this),t.terminate()),Promise.resolve();var t},t}(),xs=function(){function t(t,e,n){this.v_=e,this.S_=n,this.type=\"document\",this.firestore=t}return Object.defineProperty(t.prototype,\"D_\",{get:function(){return this.S_.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"id\",{get:function(){return this.S_.path.tt()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"path\",{get:function(){return this.S_.path.rt()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"parent\",{get:function(){return new As(this.firestore,this.v_,this.S_.path.X())},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this.S_)},t}(),Ns=function(){function t(t,e,n){this.v_=e,this.C_=n,this.type=\"query\",this.firestore=t}return t.prototype.withConverter=function(e){return new t(this.firestore,e,this.C_)},t}(),As=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,zt(r))||this).firestore=e,i.D_=r,i.type=\"collection\",i}return(0,i.__extends)(e,t),Object.defineProperty(e.prototype,\"id\",{get:function(){return this.C_.path.tt()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"path\",{get:function(){return this.C_.path.rt()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"parent\",{get:function(){var t=this.D_.X();return t.et()?null:new xs(this.firestore,null,new q(t))},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this.D_)},e}(Ns);function Ss(t,e){for(var n,r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];if(t instanceof ps&&(t=t.d_),ds(\"collection\",\"path\",e),t instanceof Ts)return ms(n=R.ot.apply(R,(0,i.__spreadArrays)([e],r))),new As(t,null,n);if(!(t instanceof xs||t instanceof As))throw new T(E.INVALID_ARGUMENT,\"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore\");return ms(n=R.ot.apply(R,(0,i.__spreadArrays)([t.path],r)).child(R.ot(e))),new As(t.firestore,null,n)}function Ds(t,e){for(var n,r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];if(t instanceof ps&&(t=t.d_),1===arguments.length&&(e=m.u()),ds(\"doc\",\"path\",e),t instanceof Ts)return gs(n=R.ot.apply(R,(0,i.__spreadArrays)([e],r))),new xs(t,null,new q(n));if(!(t instanceof xs||t instanceof As))throw new T(E.INVALID_ARGUMENT,\"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore\");return gs(n=t.D_.child(R.ot.apply(R,(0,i.__spreadArrays)([e],r)))),new xs(t.firestore,t instanceof As?t.v_:null,new q(n))}function ks(t,e){return t instanceof ps&&(t=t.d_),e instanceof ps&&(e=e.d_),(t instanceof xs||t instanceof As)&&(e instanceof xs||e instanceof As)&&t.firestore===e.firestore&&t.path===e.path&&t.v_===e.v_}function Os(t,e){return t instanceof ps&&(t=t.d_),e instanceof ps&&(e=e.d_),t instanceof Ns&&e instanceof Ns&&t.firestore===e.firestore&&Zt(t.C_,e.C_)&&t.v_===e.v_}var Ps=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new T(E.INVALID_ARGUMENT,\"Latitude must be a number between -90 and 90, but was: \"+t);if(!isFinite(e)||e<-180||e>180)throw new T(E.INVALID_ARGUMENT,\"Longitude must be a number between -180 and 180, but was: \"+e);this.x_=t,this.N_=e}return Object.defineProperty(t.prototype,\"latitude\",{get:function(){return this.x_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"longitude\",{get:function(){return this.N_},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.x_===t.x_&&this.N_===t.N_},t.prototype.toJSON=function(){return{latitude:this.x_,longitude:this.N_}},t.prototype.U=function(t){return _(this.x_,t.x_)||_(this.N_,t.N_)},t}(),Vs=/^__.*__$/,Ls=function(){function t(t,e,n){this.data=t,this.Gt=e,this.fieldTransforms=n}return t.prototype.F_=function(t,e){return null!==this.Gt?new ke(t,this.data,this.Gt,e,this.fieldTransforms):new De(t,this.data,e,this.fieldTransforms)},t}(),Cs=function(){function t(t,e,n){this.data=t,this.Gt=e,this.fieldTransforms=n}return t.prototype.F_=function(t,e){return new ke(t,this.data,this.Gt,e,this.fieldTransforms)},t}();function Rs(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw d()}}exports.Z=Ps;var Us=function(){function t(t,e,n,r,i,o){this.settings=t,this.t=e,this.Qt=n,this.ignoreUndefinedProperties=r,void 0===i&&this.O_(),this.fieldTransforms=i||[],this.Gt=o||[]}return Object.defineProperty(t.prototype,\"path\",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"k_\",{get:function(){return this.settings.k_},enumerable:!1,configurable:!0}),t.prototype.M_=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.t,this.Qt,this.ignoreUndefinedProperties,this.fieldTransforms,this.Gt)},t.prototype.L_=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.M_({path:n,B_:!1});return r.q_(t),r},t.prototype.U_=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.M_({path:n,B_:!1});return r.O_(),r},t.prototype.Q_=function(t){return this.M_({path:void 0,B_:!0})},t.prototype.K_=function(t){return ra(t,this.settings.methodName,this.settings.W_||!1,this.path,this.settings.j_)},t.prototype.contains=function(t){return void 0!==this.Gt.find(function(e){return t.nt(e)})||void 0!==this.fieldTransforms.find(function(e){return t.nt(e.field)})},t.prototype.O_=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.q_(this.path.get(t))},t.prototype.q_=function(t){if(0===t.length)throw this.K_(\"Document fields must not be empty\");if(Rs(this.k_)&&Vs.test(t))throw this.K_('Document fields cannot begin and end with \"__\"')},t}(),Ms=function(){function t(t,e,n){this.t=t,this.ignoreUndefinedProperties=e,this.Qt=n||Do(t)}return t.prototype.G_=function(t,e,n,r){return void 0===r&&(r=!1),new Us({k_:t,methodName:e,j_:n,path:M.ct(),B_:!1,W_:r},this.t,this.Qt,this.ignoreUndefinedProperties)},t}();function qs(t){var e=t.p_(),n=Do(t.I_);return new Ms(t.I_,!!e.ignoreUndefinedProperties,n)}function Fs(t,e,n,r,i,o){void 0===o&&(o={});var u=t.G_(o.merge||o.mergeFields?2:0,e,n,i);$s(\"Data must be an object, but it was:\",u,r);var s,a,c=Zs(r,u);if(o.merge)s=new G(u.Gt),a=u.fieldTransforms;else if(o.mergeFields){for(var h=[],f=0,l=o.mergeFields;f<l.length;f++){var p=ta(e,l[f],n);if(!u.contains(p))throw new T(E.INVALID_ARGUMENT,\"Field '\"+p+\"' is specified in your field mask but missing from your input data.\");ia(h,p)||h.push(p)}s=new G(h),a=u.fieldTransforms.filter(function(t){return s.Tt(t.field)})}else s=null,a=u.fieldTransforms;return new Ls(new pt(c),s,a)}var js=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),e.prototype.z_=function(t){if(2!==t.k_)throw 1===t.k_?t.K_(this._methodName+\"() can only appear at the top level of your update data\"):t.K_(this._methodName+\"() cannot be used with set() unless you pass {merge:true}\");return t.Gt.push(t.path),null},e.prototype.isEqual=function(t){return t instanceof e},e}(ls);function zs(t,e,n){return new Us({k_:3,j_:e.settings.j_,methodName:t._methodName,B_:n},e.t,e.Qt,e.ignoreUndefinedProperties)}var Gs=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),e.prototype.z_=function(t){return new _e(t.path,new fe)},e.prototype.isEqual=function(t){return t instanceof e},e}(ls),Bs=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).H_=n,r}return(0,i.__extends)(e,t),e.prototype.z_=function(t){var e=zs(this,t,!0),n=this.H_.map(function(t){return Ws(t,e)}),r=new le(n);return new _e(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(ls),Qs=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).H_=n,r}return(0,i.__extends)(e,t),e.prototype.z_=function(t){var e=zs(this,t,!0),n=this.H_.map(function(t){return Ws(t,e)}),r=new de(n);return new _e(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(ls),Ys=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).J_=n,r}return(0,i.__extends)(e,t),e.prototype.z_=function(t){var e=new ye(t.Qt,ue(t.Qt,this.J_));return new _e(t.path,e)},e.prototype.isEqual=function(t){return this===t},e}(ls);function Hs(t,e,n,r){var i=t.G_(1,e,n);$s(\"Data must be an object, but it was:\",i,r);var o=[],u=new dt;j(r,function(t,r){var s=na(e,t,n);r instanceof ps&&(r=r.d_);var a=i.U_(s);if(r instanceof js)o.push(s);else{var c=Ws(r,a);null!=c&&(o.push(s),u.set(s,c))}});var s=new G(o);return new Cs(u.Pt(),s,i.fieldTransforms)}function Ks(t,e,n,r,i,o){var u=t.G_(1,e,n),s=[ta(e,r,n)],a=[i];if(o.length%2!=0)throw new T(E.INVALID_ARGUMENT,\"Function \"+e+\"() needs to be called with an even number of arguments that alternate between field names and values.\");for(var c=0;c<o.length;c+=2)s.push(ta(e,o[c])),a.push(o[c+1]);for(var h=[],f=new dt,l=s.length-1;l>=0;--l)if(!ia(h,s[l])){var p=s[l],d=a[l];d instanceof ps&&(d=d.d_);var v=u.U_(p);if(d instanceof js)h.push(p);else{var y=Ws(d,v);null!=y&&(h.push(p),f.set(p,y))}}var g=new G(h);return new Cs(f.Pt(),g,u.fieldTransforms)}function Xs(t,e,n,r){return void 0===r&&(r=!1),Ws(n,t.G_(r?4:3,e))}function Ws(t,e){if(t instanceof ps&&(t=t.d_),Js(t))return $s(\"Unsupported field value:\",e,t),Zs(t,e);if(t instanceof ls)return function(t,e){if(!Rs(e.k_))throw e.K_(t._methodName+\"() can only be used with update() and set()\");if(!e.path)throw e.K_(t._methodName+\"() is not currently supported inside arrays\");var n=t.z_(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.Gt.push(e.path),t instanceof Array){if(e.settings.B_&&4!==e.k_)throw e.K_(\"Nested arrays are not supported\");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var u=Ws(o[i],e.Q_(r));null==u&&(u={nullValue:\"NULL_VALUE\"}),n.push(u),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(t instanceof ps&&(t=t.d_),null===t)return{nullValue:\"NULL_VALUE\"};if(\"number\"==typeof t)return ue(e.Qt,t);if(\"boolean\"==typeof t)return{booleanValue:t};if(\"string\"==typeof t)return{stringValue:t};if(t instanceof Date){var n=V.fromDate(t);return{timestampValue:wn(e.Qt,n)}}if(t instanceof V)return n=new V(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:wn(e.Qt,n)};if(t instanceof Ps)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof x)return{bytesValue:bn(e.Qt,t.I)};if(t instanceof xs){n=e.t;var r=t.firestore.I_;if(!r.isEqual(n))throw e.K_(\"Document reference is for database \"+r.projectId+\"/\"+r.database+\" but should be for database \"+n.projectId+\"/\"+n.database);return{referenceValue:Tn(t.firestore.I_||e.t,t.S_.path)}}throw e.K_(\"Unsupported field value: \"+_s(t))}(t,e)}function Zs(t,e){var n={};return z(t)?e.path&&e.path.length>0&&e.Gt.push(e.path):j(t,function(t,r){var i=Ws(r,e.L_(t));null!=i&&(n[t]=i)}),{mapValue:{fields:n}}}function Js(t){return!(\"object\"!=o(t)||null===t||t instanceof Array||t instanceof Date||t instanceof V||t instanceof Ps||t instanceof x||t instanceof xs||t instanceof ls)}function $s(t,e,n){if(!Js(n)||!function(t){return\"object\"==o(t)&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){var r=_s(n);throw\"an object\"===r?e.K_(t+\" a custom object\"):e.K_(t+\" \"+r)}}function ta(t,e,n){if(e instanceof ps&&(e=e.d_),e instanceof fs)return e.f_;if(\"string\"==typeof e)return na(t,e);throw ra(\"Field path arguments must be of type string or FieldPath.\",t,!1,void 0,n)}var ea=new RegExp(\"[~\\\\*/\\\\[\\\\]]\");function na(t,e,n){if(e.search(ea)>=0)throw ra(\"Invalid field path (\"+e+\"). Paths must not contain '~', '*', '/', '[', or ']'\",t,!1,void 0,n);try{return(new(fs.bind.apply(fs,(0,i.__spreadArrays)([void 0],e.split(\".\"))))).f_}catch(r){throw ra(\"Invalid field path (\"+e+\"). Paths must not be empty, begin with '.', end with '.', or contain '..'\",t,!1,void 0,n)}}function ra(t,e,n,r,i){var o=r&&!r.et(),u=void 0!==i,s=\"Function \"+e+\"() called with invalid data\";n&&(s+=\" (via `toFirestore()`)\");var a=\"\";return(o||u)&&(a+=\" (found\",o&&(a+=\" in field \"+r),u&&(a+=\" in document \"+i),a+=\")\"),new T(E.INVALID_ARGUMENT,(s+=\". \")+t+a)}function ia(t,e){return t.some(function(t){return t.isEqual(e)})}var oa=function(){function t(t){this.Sh=t,this.Y_=new Map,this.mutations=[],this.X_=!1,this.Z_=null,this.tf=new Set}return t.prototype.ef=function(t){return(0,i.__awaiter)(this,void 0,void 0,function(){var e,n=this;return(0,i.__generator)(this,function(r){switch(r.label){case 0:if(this.nf(),this.mutations.length>0)throw new T(E.INVALID_ARGUMENT,\"Firestore transactions require all reads to be executed before all writes.\");return[4,function(t,e){return(0,i.__awaiter)(this,void 0,void 0,function(){var n,r,o,u,s,a;return(0,i.__generator)(this,function(i){switch(i.label){case 0:return n=y(t),r=kn(n.Qt)+\"/documents\",o={documents:e.map(function(t){return Nn(n.Qt,t)})},[4,n.Du(\"BatchGetDocuments\",r,o)];case 1:return u=i.sent(),s=new Map,u.forEach(function(t){var e=function(t,e){return\"found\"in e?function(t,e){v(!!e.found),e.found.name,e.found.updateTime;var n=An(t,e.found.name),r=En(e.found.updateTime),i=new pt({mapValue:{fields:e.found.fields}});return new gt(n,r,i,{})}(t,e):\"missing\"in e?function(t,e){v(!!e.missing),v(!!e.readTime);var n=An(t,e.missing),r=En(e.readTime);return new mt(n,r)}(t,e):d()}(n.Qt,t);s.set(e.key.toString(),e)}),a=[],[2,(e.forEach(function(t){var e=s.get(t.toString());v(!!e),a.push(e)}),a)]}})})}(this.Sh,t)];case 1:return[2,((e=r.sent()).forEach(function(t){t instanceof mt||t instanceof gt?n.sf(t):d()}),e)]}})})},t.prototype.set=function(t,e){this.write(e.F_(t,this.jt(t))),this.tf.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.F_(t,this.rf(t)))}catch(t){this.Z_=t}this.tf.add(t.toString())},t.prototype.delete=function(t){this.write(new Ue(t,this.jt(t))),this.tf.add(t.toString())},t.prototype.commit=function(){return(0,i.__awaiter)(this,void 0,void 0,function(){var t,e=this;return(0,i.__generator)(this,function(n){switch(n.label){case 0:if(this.nf(),this.Z_)throw this.Z_;return t=this.Y_,this.mutations.forEach(function(e){t.delete(e.key.toString())}),t.forEach(function(t,n){var r=q._t(n);e.mutations.push(new Me(r,e.jt(r)))}),[4,function(t,e){return(0,i.__awaiter)(this,void 0,void 0,function(){var n,r,o;return(0,i.__generator)(this,function(i){switch(i.label){case 0:return n=y(t),r=kn(n.Qt)+\"/documents\",o={writes:e.map(function(t){return Ln(n.Qt,t)})},[4,n.pu(\"Commit\",r,o)];case 1:return i.sent(),[2]}})})}(this.Sh,this.mutations)];case 1:return n.sent(),this.X_=!0,[2]}})})},t.prototype.sf=function(t){var e;if(t instanceof gt)e=t.version;else{if(!(t instanceof mt))throw d();e=L.min()}var n=this.Y_.get(t.key.toString());if(n){if(!e.isEqual(n))throw new T(E.ABORTED,\"Document version changed between two reads.\")}else this.Y_.set(t.key.toString(),e)},t.prototype.jt=function(t){var e=this.Y_.get(t.toString());return!this.tf.has(t.toString())&&e?be.updateTime(e):be.Kt()},t.prototype.rf=function(t){var e=this.Y_.get(t.toString());if(!this.tf.has(t.toString())&&e){if(e.isEqual(L.min()))throw new T(E.INVALID_ARGUMENT,\"Can't update a document that doesn't exist.\");return be.updateTime(e)}return be.exists(!0)},t.prototype.write=function(t){this.nf(),this.mutations.push(t)},t.prototype.nf=function(){},t}(),ua=function(){function t(t,e,n,r){this._s=t,this.Sh=e,this.updateFunction=n,this.Es=r,this.cf=5,this.Gu=new ko(this._s,\"transaction_retry\")}return t.prototype.run=function(){this.af()},t.prototype.af=function(){var t=this;this.Gu.Lu(function(){return(0,i.__awaiter)(t,void 0,void 0,function(){var t,e,n=this;return(0,i.__generator)(this,function(r){return t=new oa(this.Sh),(e=this.uf(t))&&e.then(function(e){n._s.Ps(function(){return t.commit().then(function(){n.Es.resolve(e)}).catch(function(t){n.hf(t)})})}).catch(function(t){n.hf(t)}),[2]})})})},t.prototype.uf=function(t){try{var e=this.updateFunction(t);return!Z(e)&&e.catch&&e.then?e:(this.Es.reject(Error(\"Transaction callback must return a Promise\")),null)}catch(t){return this.Es.reject(t),null}},t.prototype.hf=function(t){var e=this;this.cf>0&&this.lf(t)?(this.cf-=1,this._s.Ps(function(){return e.af(),Promise.resolve()})):this.Es.reject(t)},t.prototype.lf=function(t){if(\"FirebaseError\"===t.name){var e=t.code;return\"aborted\"===e||\"failed-precondition\"===e||!Fe(e)}return!1},t}(),sa=function(){function t(t,e,n){var r=this;this.credentials=t,this._s=e,this.yu=n,this.user=N.UNAUTHENTICATED,this.clientId=m.u(),this._f=function(){},this.C=new Wn,this.credentials.v(function(t){h(\"FirestoreClient\",\"Received user=\",t.uid),r.user=t,r._f(t),r.C.resolve()})}return t.prototype.getConfiguration=function(){return(0,i.__awaiter)(this,void 0,void 0,function(){return(0,i.__generator)(this,function(t){switch(t.label){case 0:return[4,this.C.promise];case 1:return[2,(t.sent(),{_s:this._s,yu:this.yu,clientId:this.clientId,credentials:this.credentials,Jl:this.user,pl:100})]}})})},t.prototype.ff=function(t){var e=this;this._f=t,this.C.promise.then(function(){return e._f(e.user)})},t.prototype.df=function(){if(this._s.wf)throw new T(E.FAILED_PRECONDITION,\"The client has already been terminated.\")},t.prototype.terminate=function(){var t=this;this._s.Ef();var e=new Wn;return this._s.Tf(function(){return(0,i.__awaiter)(t,void 0,void 0,function(){var t,n;return(0,i.__generator)(this,function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),this.If?[4,this.If.terminate()]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.mf?[4,this.mf.terminate()]:[3,4];case 3:r.sent(),r.label=4;case 4:return this.credentials.S(),e.resolve(),[3,6];case 5:return t=r.sent(),n=ar(t,\"Failed to shutdown persistence\"),e.reject(n),[3,6];case 6:return[2]}})})}),e.promise},t}();function aa(t,e){return(0,i.__awaiter)(this,void 0,void 0,function(){var n,r,o=this;return(0,i.__generator)(this,function(u){switch(u.label){case 0:return t._s.Af(),h(\"FirestoreClient\",\"Initializing OfflineComponentProvider\"),[4,t.getConfiguration()];case 1:return n=u.sent(),[4,e.initialize(n)];case 2:return u.sent(),r=n.Jl,t.ff(function(n){r.isEqual(n)||(r=n,t._s.po(function(){return(0,i.__awaiter)(o,void 0,void 0,function(){return(0,i.__generator)(this,function(t){switch(t.label){case 0:return[4,ji(e.bh,n)];case 1:return t.sent(),[2]}})})}))}),e.persistence.Po(function(){return t.terminate()}),t.mf=e,[2]}})})}function ca(t,e){return(0,i.__awaiter)(this,void 0,void 0,function(){var n,r;return(0,i.__generator)(this,function(o){switch(o.label){case 0:return t._s.Af(),[4,ha(t)];case 1:return n=o.sent(),h(\"FirestoreClient\",\"Initializing OnlineComponentProvider\"),[4,t.getConfiguration()];case 2:return r=o.sent(),[4,e.initialize(n,r)];case 3:return o.sent(),t.ff(function(n){return t._s.po(function(){return function(t,e){return(0,i.__awaiter)(this,void 0,void 0,function(){var n,r;return(0,i.__generator)(this,function(i){switch(i.label){case 0:return(n=y(t))._s.Af(),h(\"RemoteStore\",\"RemoteStore received new credentials\"),r=Qo(n),n.Nh.add(3),[4,Mo(n)];case 1:return i.sent(),r&&n.Oh.set(\"Unknown\"),[4,n.Dh.n_(e)];case 2:return i.sent(),n.Nh.delete(3),[4,Uo(n)];case 3:return i.sent(),[2]}})})}(e.yl,n)})}),t.If=e,[2]}})})}function ha(t){return(0,i.__awaiter)(this,void 0,void 0,function(){return(0,i.__generator)(this,function(e){switch(e.label){case 0:return t.mf?[3,2]:(h(\"FirestoreClient\",\"Using default OfflineComponentProvider\"),[4,aa(t,new is)]);case 1:e.sent(),e.label=2;case 2:return[2,t.mf]}})})}function fa(t){return(0,i.__awaiter)(this,void 0,void 0,function(){return(0,i.__generator)(this,function(e){switch(e.label){case 0:return t.If?[3,2]:(h(\"FirestoreClient\",\"Using default OnlineComponentProvider\"),[4,ca(t,new ss)]);case 1:e.sent(),e.label=2;case 2:return[2,t.If]}})})}function la(t){return ha(t).then(function(t){return t.persistence})}function pa(t){return ha(t).then(function(t){return t.bh})}function da(t){return fa(t).then(function(t){return t.yl})}function va(t){return fa(t).then(function(t){return t._a})}function ya(t){return(0,i.__awaiter)(this,void 0,void 0,function(){var e,n;return(0,i.__generator)(this,function(r){switch(r.label){case 0:return[4,fa(t)];case 1:return e=r.sent(),[2,((n=e.gl).jh=Nu.bind(null,e._a),n.Hh=Su.bind(null,e._a),n)]}})})}function ga(t,e,n){var r=this;void 0===n&&(n={});var o=new Wn;return t._s.Ps(function(){return(0,i.__awaiter)(r,void 0,void 0,function(){var r;return(0,i.__generator)(this,function(i){switch(i.label){case 0:return r=function(t,e,n,r,i){var o=new cs({next:function(o){e.Ps(function(){return fu(t,u)});var s=o.docs.has(n);!s&&o.fromCache?i.reject(new T(E.UNAVAILABLE,\"Failed to get document because the client is offline.\")):s&&o.fromCache&&r&&\"server\"===r.source?i.reject(new T(E.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to \"server\" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),u=new vu(zt(n.path),o,{includeMetadataChanges:!0,nl:!0});return hu(t,u)},[4,ya(t)];case 1:return[2,r.apply(void 0,[i.sent(),t._s,e,n,o])]}})})}),o.promise}function ma(t,e,n){var r=this;void 0===n&&(n={});var o=new Wn;return t._s.Ps(function(){return(0,i.__awaiter)(r,void 0,void 0,function(){var r;return(0,i.__generator)(this,function(i){switch(i.label){case 0:return r=function(t,e,n,r,i){var o=new cs({next:function(n){e.Ps(function(){return fu(t,u)}),n.fromCache&&\"server\"===r.source?i.reject(new T(E.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to \"server\" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),u=new vu(n,o,{includeMetadataChanges:!0,nl:!0});return hu(t,u)},[4,ya(t)];case 1:return[2,r.apply(void 0,[i.sent(),t._s,e,n,o])]}})})}),o.promise}var _a=function(){function t(){var t=this;this.Rf=Promise.resolve(),this.Pf=[],this.yf=!1,this.gf=[],this.Vf=null,this.pf=!1,this.bf=[],this.Gu=new ko(this,\"async_queue_retry\"),this.vf=function(){var e=So();e&&h(\"AsyncQueue\",\"Visibility state changed to \"+e.visibilityState),t.Gu.qu()};var e=So();e&&\"function\"==typeof e.addEventListener&&e.addEventListener(\"visibilitychange\",this.vf)}return Object.defineProperty(t.prototype,\"wf\",{get:function(){return this.yf},enumerable:!1,configurable:!0}),t.prototype.Ps=function(t){this.enqueue(t)},t.prototype.Tf=function(t){this.Sf(),this.Df(t)},t.prototype.Ef=function(){if(!this.yf){this.yf=!0;var t=So();t&&\"function\"==typeof t.removeEventListener&&t.removeEventListener(\"visibilitychange\",this.vf)}},t.prototype.enqueue=function(t){return this.Sf(),this.yf?new Promise(function(t){}):this.Df(t)},t.prototype.po=function(t){var e=this;this.Ps(function(){return e.Pf.push(t),e.Cf()})},t.prototype.Cf=function(){return(0,i.__awaiter)(this,void 0,void 0,function(){var t,e=this;return(0,i.__generator)(this,function(n){switch(n.label){case 0:if(0===this.Pf.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.Pf[0]()];case 2:return n.sent(),this.Pf.shift(),this.Gu.reset(),[3,4];case 3:if(!nr(t=n.sent()))throw t;return h(\"AsyncQueue\",\"Operation failed with retryable error: \"+t),[3,4];case 4:this.Pf.length>0&&this.Gu.Lu(function(){return e.Cf()}),n.label=5;case 5:return[2]}})})},t.prototype.Df=function(t){var e=this,n=this.Rf.then(function(){return e.pf=!0,t().catch(function(t){throw e.Vf=t,e.pf=!1,f(\"INTERNAL UNHANDLED ERROR: \",function(t){var e=t.message||\"\";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+\"\\n\"+t.stack),e}(t)),t}).then(function(t){return e.pf=!1,t})});return this.Rf=n,n},t.prototype.Tr=function(t,e,n){var r=this;this.Sf(),this.bf.indexOf(t)>-1&&(e=0);var i=sr.Ts(this,t,e,n,function(t){return r.xf(t)});return this.gf.push(i),i},t.prototype.Sf=function(){this.Vf&&d()},t.prototype.Af=function(){},t.prototype.Nf=function(){return(0,i.__awaiter)(this,void 0,void 0,function(){var t;return(0,i.__generator)(this,function(e){switch(e.label){case 0:return[4,t=this.Rf];case 1:e.sent(),e.label=2;case 2:if(t!==this.Rf)return[3,0];e.label=3;case 3:return[2]}})})},t.prototype.$f=function(t){for(var e=0,n=this.gf;e<n.length;e++)if(n[e].fs===t)return!0;return!1},t.prototype.Ff=function(t){var e=this;return this.Nf().then(function(){e.gf.sort(function(t,e){return t.ds-e.ds});for(var n=0,r=e.gf;n<r.length;n++){var i=r[n];if(i.Rs(),\"all\"!==t&&i.fs===t)break}return e.Nf()})},t.prototype.Of=function(t){this.bf.push(t)},t.prototype.xf=function(t){var e=this.gf.indexOf(t);this.gf.splice(e,1)},t}();function wa(t){return function(t,e){if(\"object\"!=o(t)||null===t)return!1;for(var n=t,r=0,i=[\"next\",\"error\",\"complete\"];r<i.length;r++){var u=i[r];if(u in n&&\"function\"==typeof n[u])return!0}return!1}(t)}var ba=function(){function t(){this.kf={},this.Mf=new Wn,this.Lf={taskState:\"Running\",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}return t.prototype.onProgress=function(t,e,n){this.kf={next:t,error:e,complete:n}},t.prototype.catch=function(t){return this.Mf.promise.catch(t)},t.prototype.then=function(t,e){return this.Mf.promise.then(t,e)},t.prototype.ql=function(t){this.Ul(t),this.kf.complete&&this.kf.complete(),this.Mf.resolve(t)},t.prototype.Kl=function(t){this.Lf.taskState=\"Error\",this.kf.next&&this.kf.next(this.Lf),this.kf.error&&this.kf.error(t),this.Mf.reject(t)},t.prototype.Ul=function(t){this.Lf=t,this.kf.next&&this.kf.next(t)},t}(),Ia=-1,Ea=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).Bf=new _a,r.w_=\"name\"in e?e.name:\"[DEFAULT]\",r}return(0,i.__extends)(e,t),e.prototype.b_=function(){return this.qf||xa(this),this.qf.terminate()},e}(Ts);function Ta(t){return t.qf||xa(t),t.qf.df(),t.qf}function xa(t){var e=t.p_(),n=function(t,e,n){return new u(t,e,n.host,n.ssl,n.experimentalForceLongPolling,n.experimentalAutoDetectLongPolling)}(t.I_,t.w_,e);t.qf=new sa(t.m_,t.Bf,n)}function Na(t,e,n){var r=this,o=new Wn;return t._s.enqueue(function(){return(0,i.__awaiter)(r,void 0,void 0,function(){var r;return(0,i.__generator)(this,function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),[4,aa(t,n)];case 1:return i.sent(),[4,ca(t,e)];case 2:return i.sent(),o.resolve(),[3,4];case 3:if(!function(t){return\"FirebaseError\"===t.name?t.code===E.FAILED_PRECONDITION||t.code===E.UNIMPLEMENTED:!(\"undefined\"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(r=i.sent()))throw r;return console.warn(\"Error enabling offline persistence. Falling back to persistence disabled: \"+r),o.reject(r),[3,4];case 4:return[2]}})})}).then(function(){return o.promise})}function Aa(t){if(t.R_||t.P_)throw new T(E.FAILED_PRECONDITION,\"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.\")}exports.X=Ea,exports.Y=Ia;var Sa=function(){function t(){}return t.prototype.Uf=function(t,e){switch(void 0===e&&(e=\"none\"),tt(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Y(t.integerValue||t.doubleValue);case 3:return this.Qf(t.timestampValue);case 4:return this.Kf(t,e);case 5:return t.stringValue;case 6:return this.Wf(H(t.bytesValue));case 7:return this.jf(t.referenceValue);case 8:return this.Gf(t.geoPointValue);case 9:return this.zf(t.arrayValue,e);case 10:return this.Hf(t.mapValue,e);default:throw d()}},t.prototype.Hf=function(t,e){var n=this,r={};return j(t.fields||{},function(t,i){r[t]=n.Uf(i,e)}),r},t.prototype.Gf=function(t){return new Ps(Y(t.latitude),Y(t.longitude))},t.prototype.zf=function(t,e){var n=this;return(t.values||[]).map(function(t){return n.Uf(t,e)})},t.prototype.Kf=function(t,e){switch(e){case\"previous\":var n=X(t);return null==n?null:this.Uf(n,e);case\"estimate\":return this.Qf(W(t));default:return null}},t.prototype.Qf=function(t){var e=Q(t);return new V(e.seconds,e.nanos)},t.prototype.Jf=function(t,e){var n=R.ot(t);v(Xn(n));var r=new s(n.get(1),n.get(3)),i=new q(n.Y(5));return r.isEqual(e)||f(\"Document \"+i+\" contains a document reference within a different database (\"+r.projectId+\"/\"+r.database+\") which is not supported. It will be treated as a reference in the current database (\"+e.projectId+\"/\"+e.database+\") instead.\"),i},t}(),Da=function(){function t(t,e,n,r,i){this.Yf=t,this.Xf=e,this.S_=n,this.Zf=r,this.v_=i}return Object.defineProperty(t.prototype,\"id\",{get:function(){return this.S_.path.tt()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"ref\",{get:function(){return new xs(this.Yf,this.v_,this.S_)},enumerable:!1,configurable:!0}),t.prototype.exists=function(){return null!==this.Zf},t.prototype.data=function(){if(this.Zf){if(this.v_){var t=new ka(this.Yf,this.Xf,this.S_,this.Zf,null);return this.v_.fromFirestore(t)}return this.Xf.Uf(this.Zf.bt())}},t.prototype.get=function(t){if(this.Zf){var e=this.Zf.data().field(Oa(\"DocumentSnapshot.get\",t));if(null!==e)return this.Xf.Uf(e)}},t}(),ka=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),e.prototype.data=function(){return t.prototype.data.call(this)},e}(Da);function Oa(t,e){return\"string\"==typeof e?na(t,e):e instanceof ps?e.d_.f_:e.f_}function Pa(t){if(Bt(t)&&0===t.xt.length)throw new T(E.UNIMPLEMENTED,\"limitToLast() queries require specifying at least one orderBy() clause\")}var Va=function(){};function La(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++){t=i[r].td(t)}return t}var Ca=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).ed=e,i.nd=n,i.sd=r,i.type=\"where\",i}return(0,i.__extends)(e,t),e.prototype.td=function(t){var e=qs(t.firestore),n=function(t,e,n,r,i,o,u){var s;if(i.ut()){if(\"array-contains\"===o||\"array-contains-any\"===o)throw new T(E.INVALID_ARGUMENT,\"Invalid Query. You can't perform '\"+o+\"' queries on FieldPath.documentId().\");if(\"in\"===o||\"not-in\"===o){za(u,o);for(var a=[],c=0,h=u;c<h.length;c++){var f=h[c];a.push(ja(r,t,f))}s={arrayValue:{values:a}}}else s=ja(r,t,u)}else\"in\"!==o&&\"not-in\"!==o&&\"array-contains-any\"!==o||za(u,o),s=Xs(n,\"where\",u,\"in\"===o||\"not-in\"===o);var l=xt.create(i,o,s);return function(t,e){if(e.Ct()){var n=Yt(t);if(null!==n&&!n.isEqual(e.field))throw new T(E.INVALID_ARGUMENT,\"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '\"+n.toString()+\"' and '\"+e.field.toString()+\"'\");var r=Qt(t);null!==r&&Ga(t,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(e.op){case\"!=\":return[\"!=\",\"not-in\"];case\"array-contains\":return[\"array-contains\",\"array-contains-any\",\"not-in\"];case\"in\":return[\"array-contains-any\",\"in\",\"not-in\"];case\"array-contains-any\":return[\"array-contains\",\"array-contains-any\",\"in\",\"not-in\"];case\"not-in\":return[\"array-contains\",\"array-contains-any\",\"in\",\"not-in\",\"!=\"];default:return[]}}());if(null!==i)throw i===e.op?new T(E.INVALID_ARGUMENT,\"Invalid query. You cannot use more than one '\"+e.op.toString()+\"' filter.\"):new T(E.INVALID_ARGUMENT,\"Invalid query. You cannot use '\"+e.op.toString()+\"' filters with '\"+i.toString()+\"' filters.\")}(t,l),l}(t.C_,0,e,t.firestore.I_,this.ed,this.nd,this.sd);return new Ns(t.firestore,t.v_,function(t,e){var n=t.filters.concat([e]);return new Ft(t.path,t.collectionGroup,t.xt.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t.C_,n))},e}(Va),Ra=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).ed=e,r.rd=n,r.type=\"orderBy\",r}return(0,i.__extends)(e,t),e.prototype.td=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new T(E.INVALID_ARGUMENT,\"Invalid query. You must not call startAt() or startAfter() before calling orderBy().\");if(null!==t.endAt)throw new T(E.INVALID_ARGUMENT,\"Invalid query. You must not call endAt() or endBefore() before calling orderBy().\");var r=new Rt(e,n);return function(t,e){if(null===Qt(t)){var n=Yt(t);null!==n&&Ga(t,n,e.field)}}(t,r),r}(t.C_,this.ed,this.rd);return new Ns(t.firestore,t.v_,function(t,e){var n=t.xt.concat([e]);return new Ft(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t.C_,e))},e}(Va),Ua=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.od=n,i.ad=r,i}return(0,i.__extends)(e,t),e.prototype.td=function(t){return new Ns(t.firestore,t.v_,Wt(t.C_,this.od,this.ad))},e}(Va),Ma=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.ud=n,i.hd=r,i}return(0,i.__extends)(e,t),e.prototype.td=function(t){var e=Fa(t,this.type,this.ud,this.hd);return new Ns(t.firestore,t.v_,function(t,e){return new Ft(t.path,t.collectionGroup,t.xt.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t.C_,e))},e}(Va),qa=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.ud=n,i.hd=r,i}return(0,i.__extends)(e,t),e.prototype.td=function(t){var e=Fa(t,this.type,this.ud,this.hd);return new Ns(t.firestore,t.v_,function(t,e){return new Ft(t.path,t.collectionGroup,t.xt.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t.C_,e))},e}(Va);function Fa(t,e,n,r){if(n[0]instanceof ps&&(n[0]=n[0].d_),n[0]instanceof Da)return function(t,e,n,r,i){if(!r)throw new T(E.NOT_FOUND,\"Can't use a DocumentSnapshot that doesn't exist for \"+n+\"().\");for(var o=[],u=0,s=Kt(t);u<s.length;u++){var a=s[u];if(a.field.ut())o.push(st(e,r.key));else{var c=r.field(a.field);if(K(c))throw new T(E.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field \"'+a.field+'\" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var h=a.field.rt();throw new T(E.INVALID_ARGUMENT,\"Invalid query. You are trying to start or end a query using a document for which the field '\"+h+\"' (used as the orderBy) does not exist.\")}o.push(c)}}return new Lt(o,i)}(t.C_,t.firestore.I_,e,n[0].Zf,r);var i=qs(t.firestore);return function(t,e,n,r,i,u){var s=t.xt;if(i.length>s.length)throw new T(E.INVALID_ARGUMENT,\"Too many arguments provided to \"+r+\"(). The number of arguments must be less than or equal to the number of orderBy() clauses\");for(var a=[],c=0;c<i.length;c++){var h=i[c];if(s[c].field.ut()){if(\"string\"!=typeof h)throw new T(E.INVALID_ARGUMENT,\"Invalid query. Expected a string for document ID in \"+r+\"(), but got a \"+o(h));if(!Ht(t)&&-1!==h.indexOf(\"/\"))throw new T(E.INVALID_ARGUMENT,\"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to \"+r+\"() must be a plain document ID, but '\"+h+\"' contains a slash.\");var f=t.path.child(R.ot(h));if(!q.wt(f))throw new T(E.INVALID_ARGUMENT,\"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to \"+r+\"() must result in a valid document path, but '\"+f+\"' is not because it contains an odd number of segments.\");var l=new q(f);a.push(st(e,l))}else{var p=Xs(n,r,h);a.push(p)}}return new Lt(a,u)}(t.C_,t.firestore.I_,i,e,n,r)}function ja(t,e,n){if(n instanceof ps&&(n=n.d_),\"string\"==typeof n){if(\"\"===n)throw new T(E.INVALID_ARGUMENT,\"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.\");if(!Ht(e)&&-1!==n.indexOf(\"/\"))throw new T(E.INVALID_ARGUMENT,\"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '\"+n+\"' contains a '/' character.\");var r=e.path.child(R.ot(n));if(!q.wt(r))throw new T(E.INVALID_ARGUMENT,\"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '\"+r+\"' is not because it has an odd number of segments (\"+r.length+\").\");return st(t,new q(r))}if(n instanceof xs)return st(t,n.S_);throw new T(E.INVALID_ARGUMENT,\"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: \"+_s(n)+\".\")}function za(t,e){if(!Array.isArray(t)||0===t.length)throw new T(E.INVALID_ARGUMENT,\"Invalid Query. A non-empty array is required for '\"+e.toString()+\"' filters.\");if(t.length>10)throw new T(E.INVALID_ARGUMENT,\"Invalid Query. '\"+e.toString()+\"' filters support a maximum of 10 elements in the value array.\")}function Ga(t,e,n){if(!n.isEqual(e))throw new T(E.INVALID_ARGUMENT,\"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '\"+e.toString()+\"' and so you must also use '\"+e.toString()+\"' as your first argument to orderBy(), but your first orderBy() is on field '\"+n.toString()+\"' instead.\")}function Ba(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var Qa=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return(0,i.__extends)(e,t),e.prototype.Wf=function(t){return new x(t)},e.prototype.jf=function(t){var e=this.Jf(t,this.firestore.I_);return new xs(this.firestore,null,e)},e}(Sa),Ya=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),Ha=function(t){function e(e,n,r,i,o,u){var s=this;return(s=t.call(this,e,n,r,i,u)||this).Yf=e,s.ld=e,s.metadata=o,s}return(0,i.__extends)(e,t),e.prototype.exists=function(){return t.prototype.exists.call(this)},e.prototype.data=function(t){if(void 0===t&&(t={}),this.Zf){if(this.v_){var e=new Ka(this.Yf,this.Xf,this.S_,this.Zf,this.metadata,null);return this.v_.fromFirestore(e,t)}return this.Xf.Uf(this.Zf.bt(),t.serverTimestamps)}},e.prototype.get=function(t,e){if(void 0===e&&(e={}),this.Zf){var n=this.Zf.data().field(Oa(\"DocumentSnapshot.get\",t));if(null!==n)return this.Xf.Uf(n,e.serverTimestamps)}},e}(Da),Ka=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),e.prototype.data=function(e){return void 0===e&&(e={}),t.prototype.data.call(this,e)},e}(Ha),Xa=function(){function t(t,e,n,r){this.Yf=t,this.Xf=e,this._d=r,this.metadata=new Ya(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(t.prototype,\"docs\",{get:function(){var t=[];return this.forEach(function(e){return t.push(e)}),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"size\",{get:function(){return this._d.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"empty\",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this._d.docs.forEach(function(r){t.call(e,new Ka(n.Yf,n.Xf,r.key,r,new Ya(n._d.De.has(r.key),n._d.fromCache),n.query.v_))})},t.prototype.docChanges=function(t){void 0===t&&(t={});var e=!!t.includeMetadataChanges;if(e&&this._d.xe)throw new T(E.INVALID_ARGUMENT,\"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().\");return this.fd&&this.dd===e||(this.fd=function(t,e){if(t._d.Se.et()){var n=0;return t._d.docChanges.map(function(e){var r=new Ka(t.Yf,t.Xf,e.doc.key,e.doc,new Ya(t._d.De.has(e.doc.key),t._d.fromCache),t.query.v_);return e.doc,{type:\"added\",doc:r,oldIndex:-1,newIndex:n++}})}var r=t._d.Se;return t._d.docChanges.filter(function(t){return e||3!==t.type}).map(function(e){var n=new Ka(t.Yf,t.Xf,e.doc.key,e.doc,new Ya(t._d.De.has(e.doc.key),t._d.fromCache),t.query.v_),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:Wa(e.type),doc:n,oldIndex:i,newIndex:o}})}(this,e),this.dd=e),this.fd},t}();function Wa(t){switch(t){case 0:return\"added\";case 2:case 3:return\"modified\";case 1:return\"removed\";default:return d()}}function Za(t,e){return t instanceof Ha&&e instanceof Ha?t.Yf===e.Yf&&t.S_.isEqual(e.S_)&&(null===t.Zf?null===e.Zf:t.Zf.isEqual(e.Zf))&&t.v_===e.v_:t instanceof Xa&&e instanceof Xa&&t.Yf===e.Yf&&Os(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._d.isEqual(e._d)}var Ja=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return(0,i.__extends)(e,t),e.prototype.Wf=function(t){return new x(t)},e.prototype.jf=function(t){var e=this.Jf(t,this.firestore.I_);return new xs(this.firestore,null,e)},e}(Sa);function $a(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=ws(t,xs);var o=ws(t.firestore,Ea),u=qs(o);return e instanceof ps&&(e=e.d_),ec(o,[(\"string\"==typeof e||e instanceof fs?Ks(u,\"updateDoc\",t.S_,e,n,r):Hs(u,\"updateDoc\",t.S_,e)).F_(t.S_,be.exists(!0))])}function tc(t){for(var e,n,r,u=[],s=1;s<arguments.length;s++)u[s-1]=arguments[s];t instanceof ps&&(t=t.d_);var a={includeMetadataChanges:!1},c=0;\"object\"!=o(u[c])||wa(u[c])||(a=u[c],c++);var h,f,l,p={includeMetadataChanges:a.includeMetadataChanges};if(wa(u[c])){var d=u[c];u[c]=null===(e=d.next)||void 0===e?void 0:e.bind(d),u[c+1]=null===(n=d.error)||void 0===n?void 0:n.bind(d),u[c+2]=null===(r=d.complete)||void 0===r?void 0:r.bind(d)}if(t instanceof xs)f=ws(t.firestore,Ea),l=zt(t.S_.path),h={next:function(e){u[c]&&u[c](nc(f,t,e))},error:u[c+1],complete:u[c+2]};else{var v=ws(t,Ns);f=ws(v.firestore,Ea),l=v.C_;var y=new Ja(f);h={next:function(t){u[c]&&u[c](new Xa(f,y,v,t))},error:u[c+1],complete:u[c+2]},Pa(t.C_)}return function(t,e,n,r){var o=this,u=new cs(h),s=new vu(e,u,n);return t._s.Ps(function(){return(0,i.__awaiter)(o,void 0,void 0,function(){var e;return(0,i.__generator)(this,function(n){switch(n.label){case 0:return e=hu,[4,ya(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}})})}),function(){u.i_(),t._s.Ps(function(){return(0,i.__awaiter)(o,void 0,void 0,function(){var e;return(0,i.__generator)(this,function(n){switch(n.label){case 0:return e=fu,[4,ya(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}})})})}}(Ta(f),l,p)}function ec(t,e){return function(t,e){var n=this,r=new Wn;return t._s.Ps(function(){return(0,i.__awaiter)(n,void 0,void 0,function(){var n;return(0,i.__generator)(this,function(i){switch(i.label){case 0:return n=Du,[4,va(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(Ta(t),e)}function nc(t,e,n){var r=n.docs.get(e.S_),i=new Ja(t);return new Ha(t,i,e.S_,r,new Ya(n.hasPendingWrites,n.fromCache),e.v_)}var rc=function(){function t(t,e){this.Yf=t,this.wd=e,this.Ed=[],this.Td=!1,this.Id=qs(t)}return t.prototype.set=function(t,e,n){this.md();var r=ic(t,this.Yf),i=Ba(r.v_,e,n),o=Fs(this.Id,\"WriteBatch.set\",r.S_,i,null!==r.v_,n);return this.Ed.push(o.F_(r.S_,be.Kt())),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this.md();var o,u=ic(t,this.Yf);return e instanceof ps&&(e=e.d_),o=\"string\"==typeof e||e instanceof fs?Ks(this.Id,\"WriteBatch.update\",u.S_,e,n,r):Hs(this.Id,\"WriteBatch.update\",u.S_,e),this.Ed.push(o.F_(u.S_,be.exists(!0))),this},t.prototype.delete=function(t){this.md();var e=ic(t,this.Yf);return this.Ed=this.Ed.concat(new Ue(e.S_,be.Kt())),this},t.prototype.commit=function(){return this.md(),this.Td=!0,this.Ed.length>0?this.wd(this.Ed):Promise.resolve()},t.prototype.md=function(){if(this.Td)throw new T(E.FAILED_PRECONDITION,\"A write batch can no longer be used after commit() has been called.\")},t}();function ic(t,e){if(t instanceof ps&&(t=t.d_),t.firestore!==e)throw new T(E.INVALID_ARGUMENT,\"Provided document reference is from a different Firestore instance.\");return t}var oc=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).Yf=e,r}return(0,i.__extends)(e,t),e.prototype.get=function(e){var n=this,r=ic(e,this.Yf),i=new Ja(this.Yf);return t.prototype.get.call(this,e).then(function(t){return new Ha(n.Yf,i,r.S_,t.Zf,new Ya(!1,!1),r.v_)})},e}(function(){function t(t,e){this.Yf=t,this.Ad=e,this.Id=qs(t)}return t.prototype.get=function(t){var e=this,n=ic(t,this.Yf),r=new Qa(this.Yf);return this.Ad.ef([n.S_]).then(function(t){if(!t||1!==t.length)return d();var i=t[0];if(i instanceof mt)return new Da(e.Yf,r,n.S_,null,n.v_);if(i instanceof gt)return new Da(e.Yf,r,i.key,i,n.v_);throw d()})},t.prototype.set=function(t,e,n){var r=ic(t,this.Yf),i=Ba(r.v_,e,n),o=Fs(this.Id,\"Transaction.set\",r.S_,i,null!==r.v_,n);return this.Ad.set(r.S_,o),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o,u=ic(t,this.Yf);return e instanceof ps&&(e=e.d_),o=\"string\"==typeof e||e instanceof fs?Ks(this.Id,\"Transaction.update\",u.S_,e,n,r):Hs(this.Id,\"Transaction.update\",u.S_,e),this.Ad.update(u.S_,o),this},t.prototype.delete=function(t){var e=ic(t,this.Yf);return this.Ad.delete(e.S_),this},t}());function uc(){if(\"undefined\"==typeof Uint8Array)throw new T(E.UNIMPLEMENTED,\"Uint8Arrays are not available in this environment.\")}function sc(){if(\"undefined\"==typeof atob)throw new T(E.UNIMPLEMENTED,\"Blobs are unavailable in Firestore in this environment.\")}var ac=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),e.fromBase64String=function(t){return sc(),new e(x.fromBase64String(t))},e.fromUint8Array=function(t){return uc(),new e(x.fromUint8Array(t))},e.prototype.toBase64=function(){return sc(),this.d_.toBase64()},e.prototype.toUint8Array=function(){return uc(),this.d_.toUint8Array()},e.prototype.isEqual=function(t){return this.d_.isEqual(t.d_)},e.prototype.toString=function(){return\"Blob(base64: \"+this.toBase64()+\")\"},e}(ps),cc=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){Aa(t=ws(t,Ea));var n=Ta(t),r=t.p_(),i=new ss;return Na(n,i,new os(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t.d_,{forceOwnership:e})},t.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){Aa(t=ws(t,Ea));var e=Ta(t),n=t.p_(),r=new ss;return Na(e,r,new us(r,n.cacheSizeBytes))}(t.d_)},t.prototype.clearIndexedDbPersistence=function(t){return function(t){var e=this;if(t.R_&&!t.P_)throw new T(E.FAILED_PRECONDITION,\"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.\");var n=new Wn;return t.Bf.Tf(function(){return(0,i.__awaiter)(e,void 0,void 0,function(){var e;return(0,i.__generator)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(t){return(0,i.__awaiter)(this,void 0,void 0,function(){var e;return(0,i.__generator)(this,function(n){switch(n.label){case 0:return $n.Kn()?(e=t+\"main\",[4,$n.delete(e)]):[2,Promise.resolve()];case 1:return n.sent(),[2]}})})}(Li(t.I_,t.w_))];case 1:return r.sent(),n.resolve(),[3,3];case 2:return e=r.sent(),n.reject(e),[3,3];case 3:return[2]}})})}),n.promise}(t.d_)},t}(),hc=function(t){function e(e,n,r){var i=this;return(i=t.call(this,n)||this).Rd=r,i.INTERNAL={delete:function(){return i.terminate()}},e instanceof s||(i.Pd=e),i}return(0,i.__extends)(e,t),Object.defineProperty(e.prototype,\"I_\",{get:function(){return this.d_.I_},enumerable:!1,configurable:!0}),e.prototype.settings=function(t){t.merge&&delete(t=Object.assign(Object.assign({},this.d_.V_()),t)).merge,this.d_.g_(t)},e.prototype.useEmulator=function(t,e){!function(t,e,n){var r=(t=ws(t,Ts)).V_();\"firestore.googleapis.com\"!==r.host&&r.host!==e&&l(\"Host has been set in both settings() and useEmulator(), emulator host will be used\"),t.g_(Object.assign(Object.assign({},r),{host:e+\":\"+n,ssl:!1}))}(this.d_,t,e)},e.prototype.enableNetwork=function(){return function(t){var e=this;return t._s.enqueue(function(){return(0,i.__awaiter)(e,void 0,void 0,function(){var e,n;return(0,i.__generator)(this,function(r){switch(r.label){case 0:return[4,la(t)];case 1:return e=r.sent(),[4,da(t)];case 2:return n=r.sent(),[2,(e.yo(!0),function(t){var e=y(n);return e.Nh.delete(0),Uo(e)}())]}})})})}(Ta(ws(this.d_,Ea)))},e.prototype.disableNetwork=function(){return function(t){var e=this;return t._s.enqueue(function(){return(0,i.__awaiter)(e,void 0,void 0,function(){var e,n;return(0,i.__generator)(this,function(r){switch(r.label){case 0:return[4,la(t)];case 1:return e=r.sent(),[4,da(t)];case 2:return n=r.sent(),[2,(e.yo(!1),function(t){return(0,i.__awaiter)(this,void 0,void 0,function(){var e;return(0,i.__generator)(this,function(n){switch(n.label){case 0:return(e=y(t)).Nh.add(0),[4,Mo(e)];case 1:return n.sent(),e.Oh.set(\"Offline\"),[2]}})})}(n))]}})})})}(Ta(ws(this.d_,Ea)))},e.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&ys(\"synchronizeTabs\",e=!!t.synchronizeTabs,\"experimentalForceOwningTab\",n=!!t.experimentalForceOwningTab),e?this.Rd.enableMultiTabIndexedDbPersistence(this):this.Rd.enableIndexedDbPersistence(this,n)},e.prototype.clearPersistence=function(){return this.Rd.clearIndexedDbPersistence(this)},e.prototype.terminate=function(){return this.Pd&&(this.Pd._removeServiceInstance(\"firestore\"),this.Pd._removeServiceInstance(\"firestore-exp\")),this.d_._delete()},e.prototype.waitForPendingWrites=function(){return function(t){var e=this,n=new Wn;return t._s.Ps(function(){return(0,i.__awaiter)(e,void 0,void 0,function(){var e;return(0,i.__generator)(this,function(r){switch(r.label){case 0:return e=Cu,[4,va(t)];case 1:return[2,e.apply(void 0,[r.sent(),n])]}})})}),n.promise}(Ta(ws(this.d_,Ea)))},e.prototype.onSnapshotsInSync=function(t){return function(t,e){return function(t,e){var n=this,r=new cs(e);return t._s.Ps(function(){return(0,i.__awaiter)(n,void 0,void 0,function(){var e;return(0,i.__generator)(this,function(n){switch(n.label){case 0:return e=function(t,e){y(t).Wh.add(e),e.next()},[4,ya(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}})})}),function(){r.i_(),t._s.Ps(function(){return(0,i.__awaiter)(n,void 0,void 0,function(){var e;return(0,i.__generator)(this,function(n){switch(n.label){case 0:return e=function(t,e){y(t).Wh.delete(e)},[4,ya(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}})})})}}(Ta(t=ws(t,Ea)),wa(e)?e:{next:e})}(this.d_,t)},Object.defineProperty(e.prototype,\"app\",{get:function(){if(!this.Pd)throw new T(E.FAILED_PRECONDITION,\"Firestore was not initialized using the Firebase SDK. 'app' is not available\");return this.Pd},enumerable:!1,configurable:!0}),e.prototype.collection=function(t){try{return new xc(this,Ss(this.d_,t))}catch(t){throw gc(t,\"collection()\",\"Firestore.collection()\")}},e.prototype.doc=function(t){try{return new yc(this,Ds(this.d_,t))}catch(t){throw gc(t,\"doc()\",\"Firestore.doc()\")}},e.prototype.collectionGroup=function(t){try{return new Ic(this,function(t,e){if(t=ws(t,Ts),ds(\"collectionGroup\",\"collection id\",e),e.indexOf(\"/\")>=0)throw new T(E.INVALID_ARGUMENT,\"Invalid collection ID '\"+e+\"' passed to function collectionGroup(). Collection IDs must not contain '/'.\");return new Ns(t,null,function(t){return new Ft(R.ct(),t)}(e))}(this.d_,t))}catch(t){throw gc(t,\"collectionGroup()\",\"Firestore.collectionGroup()\")}},e.prototype.runTransaction=function(t){var e=this;return function(t,e){return function(t,e){var n=this,r=new Wn;return t._s.Ps(function(){return(0,i.__awaiter)(n,void 0,void 0,function(){var n;return(0,i.__generator)(this,function(i){switch(i.label){case 0:return[4,function(t){return fa(t).then(function(t){return t.Sh})}(t)];case 1:return n=i.sent(),new ua(t._s,n,e,r).run(),[2]}})})}),r.promise}(Ta(t),function(n){return e(new oc(t,n))})}(this.d_,function(n){return t(new pc(e,n))})},e.prototype.batch=function(){var t=this;return Ta(this.d_),new dc(new rc(this.d_,function(e){return ec(t.d_,e)}))},e.prototype.loadBundle=function(t){throw new T(E.FAILED_PRECONDITION,'\"loadBundle()\" does not exist, have you imported \"firebase/firestore/bundle\"?')},e.prototype.namedQuery=function(t){throw new T(E.FAILED_PRECONDITION,'\"namedQuery()\" does not exist, have you imported \"firebase/firestore/bundle\"?')},e}(ps),fc=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return(0,i.__extends)(e,t),e.prototype.Wf=function(t){return new ac(new x(t))},e.prototype.jf=function(t){var e=this.Jf(t,this.firestore.I_);return yc.yd(e,this.firestore,null)},e}(Sa);function lc(t){var e;e=t,a.setLogLevel(e)}exports.Q=hc,exports.U=cc,exports.L=ac;var pc=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).Yf=e,r.Xf=new fc(e),r}return(0,i.__extends)(e,t),e.prototype.get=function(t){var e=this,n=Nc(t);return this.d_.get(n).then(function(t){return new wc(e.Yf,new Ha(e.Yf.d_,e.Xf,t.S_,t.Zf,t.metadata,n.v_))})},e.prototype.set=function(t,e,n){var r=Nc(t);return n?(vs(\"Transaction.set\",n),this.d_.set(r,e,n)):this.d_.set(r,e),this},e.prototype.update=function(t,e,n){for(var r,o=[],u=3;u<arguments.length;u++)o[u-3]=arguments[u];var s=Nc(t);return 2===arguments.length?this.d_.update(s,e):(r=this.d_).update.apply(r,(0,i.__spreadArrays)([s,e,n],o)),this},e.prototype.delete=function(t){var e=Nc(t);return this.d_.delete(e),this},e}(ps),dc=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),e.prototype.set=function(t,e,n){var r=Nc(t);return n?(vs(\"WriteBatch.set\",n),this.d_.set(r,e,n)):this.d_.set(r,e),this},e.prototype.update=function(t,e,n){for(var r,o=[],u=3;u<arguments.length;u++)o[u-3]=arguments[u];var s=Nc(t);return 2===arguments.length?this.d_.update(s,e):(r=this.d_).update.apply(r,(0,i.__spreadArrays)([s,e,n],o)),this},e.prototype.delete=function(t){var e=Nc(t);return this.d_.delete(e),this},e.prototype.commit=function(){return this.d_.commit()},e}(ps),vc=function(t){function e(e,n,r){var i=this;return(i=t.call(this,r)||this).Yf=e,i.Xf=n,i}return(0,i.__extends)(e,t),e.prototype.fromFirestore=function(t,e){var n=new Ka(this.Yf.d_,this.Xf,t.S_,t.Zf,t.metadata,null);return this.d_.fromFirestore(new bc(this.Yf,n),null!=e?e:{})},e.prototype.toFirestore=function(t,e){return e?this.d_.toFirestore(t,e):this.d_.toFirestore(t)},e.gd=function(t,n){var r=e.Vd,i=r.get(t);i||(i=new WeakMap,r.set(t,i));var o=i.get(n);return o||(o=new e(t,new fc(t),n),i.set(n,o)),o},e}(ps);exports.G=dc,exports.j=pc,vc.Vd=new WeakMap;var yc=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).firestore=e,r.Xf=new fc(e),r}return(0,i.__extends)(e,t),e.pd=function(t,n,r){if(t.length%2!=0)throw new T(E.INVALID_ARGUMENT,\"Invalid document reference. Document references must have an even number of segments, but \"+t.rt()+\" has \"+t.length);return new e(n,new xs(n.d_,r,new q(t)))},e.yd=function(t,n,r){return new e(n,new xs(n.d_,r,t))},Object.defineProperty(e.prototype,\"id\",{get:function(){return this.d_.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"parent\",{get:function(){return new xc(this.firestore,this.d_.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"path\",{get:function(){return this.d_.path},enumerable:!1,configurable:!0}),e.prototype.collection=function(t){try{return new xc(this.firestore,Ss(this.d_,t))}catch(t){throw gc(t,\"collection()\",\"DocumentReference.collection()\")}},e.prototype.isEqual=function(t){return t instanceof ps&&(t=t.d_),t instanceof xs&&ks(this.d_,t)},e.prototype.set=function(t,e){e=vs(\"DocumentReference.set\",e);try{return function(t,e,n){t=ws(t,xs);var r=ws(t.firestore,Ea),i=Ba(t.v_,e,n);return ec(r,[Fs(qs(r),\"setDoc\",t.S_,i,null!==t.v_,n).F_(t.S_,be.Kt())])}(this.d_,t,e)}catch(t){throw gc(t,\"setDoc()\",\"DocumentReference.set()\")}},e.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?$a(this.d_,t):$a.apply(void 0,(0,i.__spreadArrays)([this.d_,t,e],n))}catch(t){throw gc(t,\"updateDoc()\",\"DocumentReference.update()\")}},e.prototype.delete=function(){return ec(ws((t=this.d_).firestore,Ea),[new Ue(t.S_,be.Kt())]);var t},e.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=mc(e),i=_c(e,function(e){return new wc(t.firestore,new Ha(t.firestore.d_,t.Xf,e.S_,e.Zf,e.metadata,t.d_.v_))});return tc(this.d_,r,i)},e.prototype.get=function(t){var e=this;return(\"cache\"===(null==t?void 0:t.source)?function(t){t=ws(t,xs);var e=ws(t.firestore,Ea),n=Ta(e),r=new Ja(e);return function(t,e){var n=this,r=new Wn;return t._s.Ps(function(){return(0,i.__awaiter)(n,void 0,void 0,function(){var n;return(0,i.__generator)(this,function(o){switch(o.label){case 0:return n=function(t,e,n){return(0,i.__awaiter)(this,void 0,void 0,function(){var r,o;return(0,i.__generator)(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,function(t,e){var n=y(t);return n.persistence.runTransaction(\"read document\",\"readonly\",function(t){return n.Tc.Ho(t,e)})}(t,e)];case 1:return(o=i.sent())instanceof gt?n.resolve(o):o instanceof mt?n.resolve(null):n.reject(new T(E.UNAVAILABLE,\"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)\")),[3,3];case 2:return r=i.sent(),o=ar(r,\"Failed to get document '\"+e+\" from cache\"),n.reject(o),[3,3];case 3:return[2]}})})},[4,pa(t)];case 1:return[2,n.apply(void 0,[o.sent(),e,r])]}})})}),r.promise}(n,t.S_).then(function(n){return new Ha(e,r,t.S_,n,new Ya(n instanceof gt&&n.Vt,!0),t.v_)})}(this.d_):\"server\"===(null==t?void 0:t.source)?function(t){t=ws(t,xs);var e=ws(t.firestore,Ea);return ga(Ta(e),t.S_,{source:\"server\"}).then(function(n){return nc(e,t,n)})}(this.d_):function(t){t=ws(t,xs);var e=ws(t.firestore,Ea);return ga(Ta(e),t.S_).then(function(n){return nc(e,t,n)})}(this.d_)).then(function(t){return new wc(e.firestore,new Ha(e.firestore.d_,e.Xf,t.S_,t.Zf,t.metadata,e.d_.v_))})},e.prototype.withConverter=function(t){return new e(this.firestore,this.d_.withConverter(vc.gd(this.firestore,t)))},e}(ps);function gc(t,e,n){return t.message=t.message.replace(e,n),t}function mc(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(\"object\"==o(r)&&!wa(r))return r}return{}}function _c(t,e){var n,r,i;return{next:function(t){i.next&&i.next(e(t))},error:null===(n=(i=wa(t[0])?t[0]:wa(t[1])?t[1]:\"function\"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}exports.H=yc;var wc=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).Yf=e,r}return(0,i.__extends)(e,t),Object.defineProperty(e.prototype,\"ref\",{get:function(){return new yc(this.Yf,this.d_.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"id\",{get:function(){return this.d_.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"metadata\",{get:function(){return this.d_.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"exists\",{get:function(){return this.d_.exists()},enumerable:!1,configurable:!0}),e.prototype.data=function(t){return this.d_.data(t)},e.prototype.get=function(t,e){return this.d_.get(t,e)},e.prototype.isEqual=function(t){return Za(this.d_,t.d_)},e}(ps),bc=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),e.prototype.data=function(t){return this.d_.data(t)},e}(wc),Ic=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).firestore=e,r.Xf=new fc(e),r}return(0,i.__extends)(e,t),e.prototype.where=function(t,n,r){try{return new e(this.firestore,La(this.d_,function(t,e,n){var r=e,i=Oa(\"where\",t);return new Ca(i,r,n)}(t,n,r)))}catch(t){throw gc(t,/(orderBy|where)\\(\\)/,\"Query.$1()\")}},e.prototype.orderBy=function(t,n){try{return new e(this.firestore,La(this.d_,function(t,e){void 0===e&&(e=\"asc\");var n=e,r=Oa(\"orderBy\",t);return new Ra(r,n)}(t,n)))}catch(t){throw gc(t,/(orderBy|where)\\(\\)/,\"Query.$1()\")}},e.prototype.limit=function(t){try{return new e(this.firestore,La(this.d_,function(t){return bs(\"limit\",t),new Ua(\"limit\",t,\"F\")}(t)))}catch(t){throw gc(t,\"limit()\",\"Query.limit()\")}},e.prototype.limitToLast=function(t){try{return new e(this.firestore,La(this.d_,function(t){return bs(\"limitToLast\",t),new Ua(\"limitToLast\",t,\"L\")}(t)))}catch(t){throw gc(t,\"limitToLast()\",\"Query.limitToLast()\")}},e.prototype.startAt=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,La(this.d_,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Ma(\"startAt\",t,!0)}.apply(void 0,t)))}catch(t){throw gc(t,\"startAt()\",\"Query.startAt()\")}},e.prototype.startAfter=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,La(this.d_,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Ma(\"startAfter\",t,!1)}.apply(void 0,t)))}catch(t){throw gc(t,\"startAfter()\",\"Query.startAfter()\")}},e.prototype.endBefore=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,La(this.d_,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new qa(\"endBefore\",t,!0)}.apply(void 0,t)))}catch(t){throw gc(t,\"endBefore()\",\"Query.endBefore()\")}},e.prototype.endAt=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,La(this.d_,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new qa(\"endAt\",t,!1)}.apply(void 0,t)))}catch(t){throw gc(t,\"endAt()\",\"Query.endAt()\")}},e.prototype.isEqual=function(t){return Os(this.d_,t.d_)},e.prototype.get=function(t){var e=this;return(\"cache\"===(null==t?void 0:t.source)?function(t){t=ws(t,Ns);var e=ws(t.firestore,Ea),n=Ta(e),r=new Ja(e);return function(t,e){var n=this,r=new Wn;return t._s.Ps(function(){return(0,i.__awaiter)(n,void 0,void 0,function(){var n;return(0,i.__generator)(this,function(o){switch(o.label){case 0:return n=function(t,e,n){return(0,i.__awaiter)(this,void 0,void 0,function(){var r,o,u,s,a;return(0,i.__generator)(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,Xi(t,e,!0)];case 1:return a=i.sent(),r=new Iu(e,a.Rc),o=r.fl(a.documents),u=r.wi(o,!1),n.resolve(u.snapshot),[3,3];case 2:return s=i.sent(),a=ar(s,\"Failed to execute query '\"+e+\" against cache\"),n.reject(a),[3,3];case 3:return[2]}})})},[4,pa(t)];case 1:return[2,n.apply(void 0,[o.sent(),e,r])]}})})}),r.promise}(n,t.C_).then(function(n){return new Xa(e,r,t,n)})}(this.d_):\"server\"===(null==t?void 0:t.source)?function(t){t=ws(t,Ns);var e=ws(t.firestore,Ea),n=Ta(e),r=new Ja(e);return ma(n,t.C_,{source:\"server\"}).then(function(n){return new Xa(e,r,t,n)})}(this.d_):function(t){t=ws(t,Ns);var e=ws(t.firestore,Ea),n=Ta(e),r=new Ja(e);return Pa(t.C_),ma(n,t.C_).then(function(n){return new Xa(e,r,t,n)})}(this.d_)).then(function(t){return new Tc(e.firestore,new Xa(e.firestore.d_,e.Xf,e.d_,t._d))})},e.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=mc(e),i=_c(e,function(e){return new Tc(t.firestore,new Xa(t.firestore.d_,t.Xf,t.d_,e._d))});return tc(this.d_,r,i)},e.prototype.withConverter=function(t){return new e(this.firestore,this.d_.withConverter(vc.gd(this.firestore,t)))},e}(ps),Ec=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).Yf=e,r}return(0,i.__extends)(e,t),Object.defineProperty(e.prototype,\"type\",{get:function(){return this.d_.type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"doc\",{get:function(){return new bc(this.Yf,this.d_.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"oldIndex\",{get:function(){return this.d_.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"newIndex\",{get:function(){return this.d_.newIndex},enumerable:!1,configurable:!0}),e}(ps),Tc=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).Yf=e,r}return(0,i.__extends)(e,t),Object.defineProperty(e.prototype,\"query\",{get:function(){return new Ic(this.Yf,this.d_.query)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"metadata\",{get:function(){return this.d_.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"size\",{get:function(){return this.d_.size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"empty\",{get:function(){return this.d_.empty},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"docs\",{get:function(){var t=this;return this.d_.docs.map(function(e){return new bc(t.Yf,e)})},enumerable:!1,configurable:!0}),e.prototype.docChanges=function(t){var e=this;return this.d_.docChanges(t).map(function(t){return new Ec(e.Yf,t)})},e.prototype.forEach=function(t,e){var n=this;this.d_.forEach(function(r){t.call(e,new bc(n.Yf,r))})},e.prototype.isEqual=function(t){return Za(this.d_,t.d_)},e}(ps),xc=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).firestore=e,r.d_=n,r}return(0,i.__extends)(e,t),Object.defineProperty(e.prototype,\"id\",{get:function(){return this.d_.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"path\",{get:function(){return this.d_.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"parent\",{get:function(){var t=this.d_.parent;return t?new yc(this.firestore,t):null},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){try{return new yc(this.firestore,void 0===t?Ds(this.d_):Ds(this.d_,t))}catch(t){throw gc(t,\"doc()\",\"CollectionReference.doc()\")}},e.prototype.add=function(t){var e=this;return function(t,e){var n=ws(t.firestore,Ea),r=Ds(t),i=Ba(t.v_,e);return ec(n,[Fs(qs(t.firestore),\"addDoc\",r.S_,i,null!==t.v_,{}).F_(r.S_,be.exists(!1))]).then(function(){return r})}(this.d_,t).then(function(t){return new yc(e.firestore,t)})},e.prototype.isEqual=function(t){return ks(this.d_,t.d_)},e.prototype.withConverter=function(t){return new e(this.firestore,this.d_.withConverter(vc.gd(this.firestore,t)))},e}(Ic);function Nc(t){return t instanceof ps&&(t=t.d_),ws(t,xs)}exports.i=xc,exports.s=Tc,exports.e=Ic,exports.t=bc,exports.a=wc;var Ac=function(t){function e(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.call(this,new(fs.bind.apply(fs,(0,i.__spreadArrays)([void 0],e))))||this}return(0,i.__extends)(e,t),e.documentId=function(){return new e(M.ht().rt())},e.prototype.isEqual=function(t){return t instanceof ps&&(t=t.d_),t instanceof fs&&this.d_.f_.isEqual(t.f_)},e}(ps),Sc=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,i.__extends)(e,t),e.serverTimestamp=function(){var t=new Gs(\"serverTimestamp\");return t._methodName=\"FieldValue.serverTimestamp\",new e(t)},e.delete=function(){var t=new js(\"deleteField\");return t._methodName=\"FieldValue.delete\",new e(t)},e.arrayUnion=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Bs(\"arrayUnion\",t)}.apply(void 0,t);return r._methodName=\"FieldValue.arrayUnion\",new e(r)},e.arrayRemove=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Qs(\"arrayRemove\",t)}.apply(void 0,t);return r._methodName=\"FieldValue.arrayRemove\",new e(r)},e.increment=function(t){var n=function(t){return new Ys(\"increment\",t)}(t);return n._methodName=\"FieldValue.increment\",new e(n)},e.prototype.isEqual=function(t){return this.d_.isEqual(t.d_)},e}(ps);function Dc(t){return function(t,e){var n=Ta(t=ws(t,Ea)),r=new ba;return function(t,e,n,r){var o=this,u=function(t,e){return function(t,e){return new hs(t,e)}(function(t,e){if(t instanceof Uint8Array)return as(t,e);if(t instanceof ArrayBuffer)return as(new Uint8Array(t),e);if(t instanceof ReadableStream)return t.getReader();throw new Error(\"Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream\")}(\"string\"==typeof t?(new TextEncoder).encode(t):t),e)}(n,Do(e));t._s.Ps(function(){return(0,i.__awaiter)(o,void 0,void 0,function(){var e;return(0,i.__generator)(this,function(n){switch(n.label){case 0:return e=rs,[4,va(t)];case 1:return e.apply(void 0,[n.sent(),u,r]),[2]}})})})}(n,t.I_,e,r),r}(this.d_,t)}function kc(t){var e,n,r=this;return(e=this.d_,n=t,function(t,e){var n=this;return t._s.enqueue(function(){return(0,i.__awaiter)(n,void 0,void 0,function(){var n;return(0,i.__generator)(this,function(r){switch(r.label){case 0:return n=function(t,e){var n=y(t);return n.persistence.runTransaction(\"Get named query\",\"readonly\",function(t){return n.wo.Ms(t,e)})},[4,pa(t)];case 1:return[2,n.apply(void 0,[r.sent(),e])]}})})})}(Ta(e=ws(e,Ea)),n).then(function(t){return t?new Ns(e,null,t.query):null})).then(function(t){return t?new Ic(r,t):null})}exports.c=Sc,exports.o=Ac;"},"sourceMaps":null,"error":null,"hash":"0c3aeaa50c2df4431a56ebd03e6c3034","cacheData":{"env":{}}}